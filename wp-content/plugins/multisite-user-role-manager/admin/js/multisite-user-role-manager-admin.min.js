var WPMUURM_JS=function(e){"use strict";var r=".wpmuurm-wrapper",n=".notifications",o={},s=function(){e(function(){t()})},t=function(){e.fn.editable.defaults.mode="inline",e("a.wpmuurm-launch").length&&e("a.wpmuurm-launch").on("click",function(e){e.preventDefault(),c()}),i(),l(),a(),u(),d()},i=function(){e(r).on("click",".remove-blog",function(r){r.preventDefault();var n=e(this).closest("tr"),o=e(n).data("blog-id");n.addClass("confirm-remove"),e(this).after(f("ajax-spinner")),e(n).find(".spinner").css("visibility","visible"),wp.ajax.send("reassign_user_blog_posts",{data:{blog_id:o,user_id:wpmuurm.user_id,nonce:wpmuurm.nonce},beforeSend:m,error:b,success:function(r){var o=f("user-blog-remove-confirm");n.after(o(r)),e(n).find(".spinner").remove()}})})},a=function(){e(r).on("click",".confirm-user-blog-removal",function(r){r.preventDefault();var n=e(this).closest("tr"),o=e(n).data("blog-id");e(this).after(f("ajax-spinner")),e(n).find(".spinner").css("visibility","visible");var s=!1;e("select.ressaign_to",n).length&&(s=e("select.ressaign_to",n).val()),wp.ajax.send("remove_user_from_blog",{data:{blog_id:o,reassign_id:s,user_id:wpmuurm.user_id,nonce:wpmuurm.nonce},beforeSend:m,error:b,success:function(){n.prev("tr.blog-"+o).remove(),n.remove(),p()}})})},l=function(){e(r).on("click",".cancel-user-blog-removal",function(r){r.preventDefault();var n=e(this).closest("tr");e("tr.blog-"+n.data("blog-id")).removeClass("confirm-remove"),n.remove()})},u=function(){e(".add-user-to-blog-wrapper",r).on("change","select.add-to-blog-blogs",function(){var r=e(".add-user-to-blog-wrapper select.add-to-blog-roles"),n=e(".add-user-to-blog-wrapper a.add-to-blog-submit");return e(r,n).attr("disabled",!0),e(this).val().length?(r.after(f("ajax-spinner")),r.next(".spinner").css({visibility:"visible","float":"none"}),void wp.ajax.send("get_blog_roles",{data:{blog_id:e(this).val(),nonce:wpmuurm.nonce},beforeSend:m,error:b,success:function(o){var s=f("blog-roles-options");e(r).html(s(o)),e(r,n).attr("disabled",!1),r.next(".spinner").remove()}})):void r.next(".spinner").remove()})},d=function(){e(".add-user-to-blog-wrapper",r).on("click","a.add-to-blog-submit",function(r){r.preventDefault();var n=e(".add-user-to-blog-wrapper select.add-to-blog-blogs"),o=e(".add-user-to-blog-wrapper select.add-to-blog-roles");e(n).attr("disabled",!0),e(o).attr("disabled",!0),e(this).after(f("ajax-spinner")),e(this).next(".spinner").css({visibility:"visible","float":"none"}),wp.ajax.send("add_user_to_blog",{data:{blog_id:n.val(),role:o.val(),user_id:wpmuurm.user_id,nonce:wpmuurm.nonce},beforeSend:m,error:b,success:function(){c(),p()}})})},c=function(){wp.ajax.send("get_user_blogs",{data:{user_id:wpmuurm.user_id,nonce:wpmuurm.nonce},beforeSend:m,error:b,success:function(n){var o=e(r+" table tbody"),s=f("user-blog-roles-row");o.html("");for(var t=0;t<n.length;t++)o.append(s(n[t])),e("[roles-editable]:last",o).editable({url:"/wp-admin/admin-ajax.php",value:n[t].user_roles[0],type:"checklist",pk:1,title:"Select roles",source:n[t].blog_roles,params:{action:"set_user_blog_roles",user_id:wpmuurm.user_id,blog_id:n[t].blog.userblog_id,nonce:wpmuurm.nonce}});p()}})},p=function(){var n=e(".add-user-to-blog-wrapper",r);n.html(f("ajax-spinner")),e(".spinner",n).css({visibility:"visible","float":"left"}),wp.ajax.send("get_blogs_wo_user",{data:{user_id:wpmuurm.user_id,nonce:wpmuurm.nonce},beforeSend:m,error:b,success:function(r){var o=f("add-user-to-blog");e(n).html(o(r))}})},b=function(r){var o=f("notification");_.each(r,function(r){e(n).append(o(r))})},m=function(){e(n).html("")},f=function(e){return"undefined"==typeof o[e]&&(o[e]=wp.template(e)),o[e]};return s()}(jQuery);
