<?php // Before trying to crack the plugin, please consider buying a pro license at https://www.mapsmarker.com/order - we have put hundreds of hours into the development of the plugin and without honest customers we will not be able to continue the development and support. Thanks for your understanding and your honesty!
if (basename($_SERVER["SCRIPT_\106ILEN\101\115\105"]) == "leaflet-core\056\160hp") { exit ("Pleas\145\040\144o not acces\163\040this file dir\145\143\164ly. Than\153\163\041<br/><\141\040\150ref='h\164\164\160s://www.\155\141psmarker.c\157\155\057go'>w\167\167\056mapsm\141\162\153er.com<\057\141>"); } if (is_admin()) { include_once (ABSPATH."wp-adm\151\156".DIRECTORY_SEPARATOR."includes".DIRECTORY_SEPARATOR."\160\154ugin.php"); if (is_plugin_active("\154eaflet-map\163\055\155arker/lea\146\154\145t-maps-mar\153\145\162.php")) { if (!is_multisite()) { deactivate_plugins("\154\145aflet-maps-mark\145\162\057leaflet-m\141\160\163-marker.ph\160",$silent=FALSE,$network_wide=NULL); activate_plugin("\154eaflet-maps-ma\162\153\145r-pro/leaf\154\145\164-maps-mar\153\145\162.php",$redirect="\160\154\165gins.php?act\151\166\141te=true",$network_wide=FALSE,$silent=FALSE); } else { include_once (ABSPATH."\167p-includes".DIRECTORY_SEPARATOR."\160\154uggable.php"); if (is_network_admin()) { deactivate_plugins("leafl\145\164\055maps-marker\057\154\145aflet-map\163\055\155arker.ph\160",$silent=FALSE,$network_wide=TRUE); activate_plugin("\154\145aflet-maps-mark\145\162\055pro/leaflet\055\155\141ps-marker\056\160\150p",$redirect=FALSE,$network_wide=TRUE,$silent=FALSE); } else { deactivate_plugins("\154eaflet-maps-mark\145\162\057leaflet-ma\160\163\055marker.ph\160",$silent=FALSE,$network_wide=NULL); activate_plugin("leafl\145\164\055maps-marker-\160\162\157/leaflet-map\163\055\155arker.php",$redirect="\160lugins.php?acti\166\141\164e=true",$network_wide=FALSE,$silent=FALSE); } } } } $l0=wp_upload_dir(); define( "O0" ,"e\070\060\0650549941i"); define( "LEAFLET_WP_ADMIN_URL" ,get_admin_url()); define( "LEAFLET_PLUGIN_URL" ,plugin_dir_url( __FILE__)); define( "LEAFLET_PLUGIN_DIR" ,plugin_dir_path( __FILE__)); define( "LEAFLET_PLUGIN_ICONS_URL" ,$l0["\142aseurl"]."/leaflet-\155\141\160s-marker-ic\157\156\163"); define( "LEAFLET_PLUGIN_ICONS_DIR" ,$l0["ba\163\145\144ir"].DIRECTORY_SEPARATOR."\154\145aflet-maps-mar\153\145\162-icons"); define( "LEAFLET_PLUGIN_QR_URL" ,$l0["baseurl"]."\057\154\145aflet-maps-\155\141\162ker-qr-code\163"); define( "LEAFLET_PLUGIN_QR_DIR" ,$l0["\142\141sedir"].DIRECTORY_SEPARATOR."\154eaflet-maps-m\141\162\153er-qr-codes"); define( "l1" ,get_admin_url()); define( "O1" ,plugin_dir_url( __FILE__)); define( "l2" ,plugin_dir_path( __FILE__)); define( "O2" ,$l0["base\165\162l"]."/leaflet-maps-\155\141\162ker-icons"); define( "l3" ,$l0["\142\141sedir"].DIRECTORY_SEPARATOR."\154\145\141flet-maps-ma\162\153\145r-icons"); function O3() { if ((substr($_SERVER["REMOTE_ADDR"],0,4) == "12\067.") || ($_SERVER["\122EMOTE_ADDR"] == "\072:1")) { return TRUE; } else { return FALSE; } } class l4 { function __construct() { $O4=get_option("\154\145afletmapsmarke\162\137\157ptions"); require_once LEAFLET_PLUGIN_DIR."inc".DIRECTORY_SEPARATOR."class-mmp-global\163\056\160hp"; require_once LEAFLET_PLUGIN_DIR."inc".DIRECTORY_SEPARATOR."\143\154ass-mmp-rewri\164\145\056php"; require_once LEAFLET_PLUGIN_DIR."\151\156\143".DIRECTORY_SEPARATOR."class-google-pla\143\145\163-geocoding.p\150\160"; require_once LEAFLET_PLUGIN_DIR."inc".DIRECTORY_SEPARATOR."class-\155\155\160api.php"; require_once LEAFLET_PLUGIN_DIR."inc".DIRECTORY_SEPARATOR."\143\154ass-restapi.p\150\160"; require_once LEAFLET_PLUGIN_DIR."\151\156\143".DIRECTORY_SEPARATOR."\143\154ass-mmp-recent-m\141\162\153ers-list-w\151\144get.php"; require_once LEAFLET_PLUGIN_DIR."\151\156c".DIRECTORY_SEPARATOR."\143\154ass-mmp-latest-\155\141\162ker-map-wid\147\145t.php"; if (is_admin()) { require_once LEAFLET_PLUGIN_DIR."\151\156\143".DIRECTORY_SEPARATOR."\160lugin-update-\143\150\145cker".DIRECTORY_SEPARATOR."p\154\165\147in-update-chec\153\145\162.php"; } if ( isset ($O4["m\151\163\143_tinymce_butt\157\156"]) && $O4["\155\151\163c_tinymce_bu\164\164\157n"] == "enable\144") { require_once LEAFLET_PLUGIN_DIR."inc".DIRECTORY_SEPARATOR."\164\151\156ymce-plugin.p\150\160"; } add_action("\151nit",array( &$this,"\154\155\155\137load_translat\151\157\156_files"),1); add_action("a\144\155\151n_init",array( &$this,"\154mm_load_settings_c\154\141\163s"),2); add_action("admin_init",array( &$this,"\154mm_install_and_u\160\144\141tes"),3); if ( isset ($O4["google_api_dere\147\151\163ter_scripts"]) && $O4["\147\157ogle_api_dereg\151\163\164er_scripts"] == "e\156abled") { add_action("\167p_enqueue_scri\160\164\163",array( &$this,"lmm_deregist\145\162\137scripts"),4); add_action("wp_head",array( &$this,"\154mm_deregi\163\164\145\162_scripts"),5); add_action("ini\164",array( &$this,"lmm_deregister_s\143\162\151pts"),6); add_action("\167p_footer",array( &$this,"\154mm_deregister_\163\143\162ipts"),7); add_action("\167\160_print_scri\160\164\163",array( &$this,"\154mm_deregiste\162\137\163cripts"),8); } add_action("wp_en\161\165\145ue_scripts",array( &$this,"l\155\155\137frontend_enque\165\145\137scripts"),011); add_action("wp_pri\156\164\137styles",array( &$this,"lmm_frontend_\145\156\161ueue_styles\150\145\145ts"),012); add_action("\141\144min_menu",array( &$this,"\154mm_admin_menu"),013); add_action("\141dmin_init",array( &$this,"lmm_pl\165\147in_meta_links"),014); add_action("wp_ajax_mapsma\162\153\145r_ajax_acti\157\156\163_back\145\156\144",array( &$this,"\154mm_aj\141\170\137actions_backen\144"),015); add_action("\167\160_ajax_mapsmarke\162\137\141jax_actions\137\146rontend",array( &$this,"\154mm_ajax_actions_\146\162\157ntend"),016); add_action("\167p_ajax_nopri\166\137\155apsmarker_\141\152\141x_actions\137\146\162ontend",array( &$this,"\154\155\155_ajax_actions\137\146\162ontend"),017); add_action("\141\144min_bar_menu",array( &$this,"\154mm_add_admin_\142\141\162_menu"),0225); if (!empty($O4)) { if (!empty($O4["\163hortcode"])) { add_shortcode($O4["\163hortcode"],array( &$this,"lmm_showmap")); } if ( isset ($O4["\155isc\137\141\144d_georss_to_h\145\141\144"]) && $O4["misc_add_geo\162\163\163_to_head"] == "\145\156abled") { add_action("wp_head",array( &$this,"\154\155\155_add_georss_\164\157\137head")); } } add_filter("widget_text","\144\157\137shortcode"); if ( isset ($O4["\155isc_global_ad\155\151\156_notices"]) && $O4["\155\151\163c_global_adm\151\156\137notices"] == "\163how") { add_action("\141dmin_notices",array( &$this,"lmm_compatibili\164\171\137checks")); } if ( isset ($O4["\155\151sc_plugin_lang\165\141\147e"]) && $O4["mi\163\143\137plugin_langu\141\147\145"] != "\141utomatic") { add_filter("\160\154ugin_locale",array( &$this,"l\155\155\137set_plugin_loca\154\145"),"lmm"); } add_action("widgets_\151nit",create_function("","return register_\167\151\144get(\042MMP_Rece\156\164\137Markers_Li\163\164\137Widget\042\051\073")); add_action("\167\151dgets_init",create_function("","\162\145\164urn registe\162\137\167idget(\042\115\115P_Latest_M\141\162\153er_Map_Wi\144\147\145t\042)\073")); if ( isset ($O4["misc_adm\151\156\137dashboard\137\167\151dget"]) && $O4["\155isc_admin_d\141\163\150board_widge\164"] == "\145\156\141bled") { if (!is_multisite()) { add_action("\167\160_dashboard_setup",array( &$this,"lmm_register\137widgets")); } else { add_action("wp_network_d\141\163\150board_setu\160",array( &$this,"\154\155m_register_wi\144\147\145ts")); add_action("\167p_dashboard_s\145\164\165p",array( &$this,"\154mm_register_widget\163")); } } if ( isset ($O4["\155isc_pointers"]) && $O4["\155\151sc_pointers"] == "enabled") { $version_before_update=get_option("leaf\154\145tmapsmarker_v\145\162\163ion_pro_b\145\146\157re_updat\145"); if ($version_before_update != "\060") { add_action("admin_enqu\145\165\145_scripts",array( &$this,"\154\155\155_update_poi\156\164\145r_admin_scri\160\164\163"),01751); } } add_action("\141dmin_enqueue_sc\162\151\160ts",array( &$this,"lmm_feature_poin\164\145\162_admin_scri\160\164\163"),01752); if (is_multisite()) { add_action("delete_blog",array( &$this,"lmm_delete\137\155\165ltisite_blog")); } add_action("template_include",array( &$this,"\154\155m_template_ch\145\143\153_shortcode")); add_action("plugin_row_meta",array( &$this,"\154\155m_plugins_page\137\141\144d_links"),012,2); add_filter("upload_mimes",array( &$this,"\154mm_permit_mime\137\164\171pes_on_uploa\144")); add_filter("\160\157st_mime_types",array( &$this,"\154mm_modify_post_m\151\155\145_types")); if ( isset ($O4["xml_sit\145\155\141ps_status"]) && $O4["x\155\154\137sitemaps_stat\165\163"] == "\145nabled") { add_action("\163m_buildmap",array( &$this,"\154\155m_add_kml_to_sit\145\155\141p")); } if (defined( "POLYLANG_VERSION")) { add_filter("\147\145nerate_rewrit\145\137\162ules",array("\115MP_Rewrite","\163\145\164_pll_rewrite_r\165\154\145s")); add_filter("\160\154l_rewrite_rul\145\163",array("MMP_Rewr\151\164\145","pll_f\151\154\164er_rewrite_rul\145\163")); } else { add_action("init",array("MMP\137\122\145write","\163\145t_rewrite_rules")); } add_filter("\161uery_vars",array("MMP_R\145\167\162ite","\141\144\144\137query_vars")); add_action("\164\145mplate_redi\162\145\143t",array("\115MP_Rewrite","\162edirect_to_endpoi\156\164")); } public static function lmm_activate() { global $wp_version; if (version_compare($wp_version,"\063\056\063","<")) { exit ("\133\115aps Marker Pro\040\055\040installat\151\157\156 failed!]\072\040\127ordPress\040\126\145rsion 3.\063\040or higher i\163\040needed for\040\164his plugin\040\164o run prope\162\154y (you are \165\163ing versi\157\156\040".$wp_version.") - pl\145\141\163e upgrade yo\165\162\040WordPress\040\151\156stallati\157\156\041"); } if (version_compare(phpversion(),"\065\0562","\074")) { exit ("\133Maps Marker\040\120\162o - instal\154\141\164ion failed]\072\040PHP 5.2 or h\151\147\150er is ne\145\144\145d for th\151\163\040plug\151\156\040to run\040\160roperly \050\171ou are usi\156\147\040PHP ".phpversion().")\040\055\040please con\164\141\143t your host\145\162\040to upgrad\145\040\171our PHP i\156\163\164allation\041"); } mmp_rewrite::set_rewrite_rules(); flush_rewrite_rules(TRUE); } public static function lmm_deactivate() { wp_clear_scheduled_hook("\154mm_wp_session_ga\162\142\141ge_collectio\156"); } function lmm_deregister_scripts() { global $wp_scripts; if ( isset ($wp_scripts->registered) && is_array($wp_scripts->registered)) { foreach ($wp_scripts->registered as $script) { if (strpos($script->src ,"maps.google.\143\157m/maps/api/js") !== FALSE) { wp_dequeue_script($script->handle); } if (strpos($script->src ,"\155\141ps.googleapis\056\143om/maps/api/j\163") !== FALSE) { wp_dequeue_script($script->handle); } } } } function lmm_ajax_actions_backend() { include ("\151\156\143".DIRECTORY_SEPARATOR."\141\152ax-actions-ba\143\153\145nd.php"); } function lmm_ajax_actions_frontend() { include ("\151\156c".DIRECTORY_SEPARATOR."\141\152\141x-actions-fr\157\156\164end.php"); } function lmm_modify_post_mime_types($post_mime_types) { $post_mime_types["applicati\157\156/gpx+xml"]=array(__("G\120\130 track","lmm"),__("\115\141\156age GPX t\162\141\143ks","lmm"),_n_noop("GPX track <spa\156\040class=\042\143\157\165nt\042\076\050%s)</span>","\107\120X tracks <span\040\143\154ass=\042\143\157\165nt\042>(%\163\051\074/span>","lmm")); return $post_mime_types; } function lmm_permit_mime_types_on_upload($l5) { $l5["\170\155l"]="\141\160plication/xml"; $l5["gpx"]="applicatio\156\057gpx+xml"; return $l5; } function lmm_plugins_page_add_links($links,$file) { $plugin="\154eaflet-\155\141\160s-marker-pro\057\154\145aflet-maps\055\155arker.php"; $O5=get_option("\154eafl\145\164\155apsmarker_ve\162\163\151on_pro"); if ($file == $plugin) { $l6="<a style=\042text\055\144\145coration:non\145\073\042 title=\042".esc_attr__("\115apsM\141\162\153er affiliate\040\160\162ogram - \163\151gn up now \141\156\144 receive \143\157\155mission\163\040up to 50%!","\154mm")."\042\040\150\162ef=\042h\164\164\160s://affilia\164\145\163.mapsmar\153\145\162.com/\042\040\164arget=\042\137\142\154ank\042\076\074img sr\143\075\042".O1."\151nc/img/icon-affil\151\141\164es.png\042\040\167idth=\042\061\066\042 hei\147\150\164=\04216\042\040alt=\042".esc_attr__("MapsM\141\162ker affiliate pr\157\147\162am - sign u\160\040\156ow and re\143\145\151ve commis\163\151\157ns up t\157\04050%!","lmm")."\042\076\074/a>"; $O6="<a style=\042\164\145\170t-decoratio\156\072\156one;\042\040\164itle=\042".esc_attr__("\115\141psMarker rese\154\154\145r program - \162\145\055sell \167\151\164h a 20%\040\144iscount!","lmm")."\042\040\150\162ef=\042ht\164\160\163://www.mapsma\162\153\145r.\143\157m/reseller\042\040\164arget=\042\137\142lank\042\076\074img \163\162\143=\042".O1."inc/\151\155\147/icon-resell\145\162\163.png\042\040\167\151dth=\042\061\066\042 hei\147\150\164=\04216\042\040\141lt=\042".esc_attr__("\115apsMarker rese\154\154\145r program -\040\162\145-sell wit\150\040a 20% disco\165\156\164!","\154\155m")."\042\076\074/a>"; $l7="\074a style=\042\164\145xt-decoration\072\156\157ne;\042\040\150ref=\042ht\164\160\163://www.ma\160\163\155arker.c\157\155\057review\163\042 target=\042\137\142lank\042\040\164itle=\042".esc_attr__("\160\154ease rate this p\154\165\147in on word\160\162\145ss.org","\154mm")."\042\076<img src=\042".O1."inc/img/icon\055\163tar.png\042 \167\151\144th=\0421\066\042\040height=\042\061\066\042 al\164\075\042".esc_attr__("\160lease rate t\150\151\163 plugin on w\157\162\144press.org","\154\155\155")."\042\076\074/a>"; $O7="\074\141 href=\042ht\164\160\163://translate\056\155\141psmarker.\143\157\155/projects\057\154\155m\042 \164\141\162get=\042\137\142lank\042\040\164itle=\042".esc_attr__("translations","lmm")."\042><img src=\042".O1."inc/img/ic\157\156\055translatio\156\163\056png\042 \167\151\144th=\0421\066\042 height=\042\061\066\042 alt=\042".esc_attr__("\164ranslations","\154\155m")."\042></a>"; $l8="\074a href=\042\150\164\164ps://www.map\163\155\141rker.com/ha\143\153\145rone\042\040\164arget=\042\137\142\154ank\042\040\164itle=\042".esc_attr__("Bount\171\040\110unters wante\144\041\040Find sec\165\162ity bugs to e\141\162\156 cash a\156\144 licenses","lmm")."\042><img src=\042".O1."\151nc/img/icon\055\150\141ckerone.png\042\040\167idth=\042\061\066\042 heig\150\164\075\04216\042\040\141lt=\042\150\141\143kerone\042\076</a>"; $O8="\074\141 href=\042\150\164\164ps://faceb\157\157\153.com/m\141\160\163marker\042\040\164arget=\042\137\142\154ank\042\040\164itle=\042".esc_attr__("\106ollow MapsMark\145\162\040on Faceboo\153","lmm")."\042>\074\151\155g src=\042".O1."\151nc/img/icon-\146\141\143ebook.png\042\040\167idth=\042\061\066\042 heigh\164\075\04216\042\040\141\154t=\042".esc_attr__("\106ollow MapsMarker \157\156\040Facebook","lmm")."\042></a>"; $l9="\074\141 href=\042\150\164\164ps://twit\164\145\162.com/maps\155\141\162ker\042\040\164arget=\042\137\142\154ank\042\040\164itle=\042".esc_attr__("Follow @Map\163\115\141rker on Twit\164\145\162","\154mm")."\042><img src=\042".O1."\151nc/img/icon-t\167\151\164ter.png\042\040\167\151dth=\042\061\066\042 heig\150\164\075\04216\042\040\141lt=\042".esc_attr__("\106ollow @MapsMarker\040\157\156 Twitter","lmm")."\042></a>"; $O9="\074\141\040href=\042\150\164\164ps://www.m\141\160\163marker.c\157\155\057+\042 \164\141\162get=\042\137\142lank\042 t\151\164\154e=\042".esc_attr__("Fol\154\157\167 MapsMarker o\156\040\107oogle+","lmm")."\042><img src=\042".O1."\151nc/img/icon-googl\145\055\160lus.png\042\040\167idth=\042\061\066\042 height\075\04216\042 alt\075\042".esc_attr__("\106ollow MapsMa\162\153\145r on Google+","lmm")."\042></a>"; $la="\074\141 href=\042\150\164\164ps://feeds.f\145\145\144burner.co\155\057\115apsMarker\042\040target=\042\137\142\154ank\042 title=\042\122SS\042><i\155\147\040src=\042".O1."\151\156\143/img/icon-r\163\163\056png\042 \167\151\144th=\04216\042\040height=\042\061\066\042 alt=\042\162\163s\042><\057\141>"; $Oa="<a href=\042\150\164\164p://feedburn\145\162\056google.com\057\146\142/a/mailv\145\162\151fy?uri=M\141\160\163Marker\042\040\164arget=\042\137\142lank\042\040\164itle=\042\122\123S (via Emai\154\051\042><img\040\163\162c=\042".O1."\151\156\143/img/icon-rs\163\055\145mail.png\042\040\167idth=\0421\066\042 height=\042\061\066\042 alt=\042\162\163s-email\042\076</a>"; if ((lb($Ob=FALSE,$lc=TRUE) === TRUE) && (lb() === FALSE)) { $Oc="<br/><\057\164\144></tr><tr><t\144\040\143olspan=\042\063\042 style=\042\142\157rder-bottom\072\061px solid #cc\143\073padding:0;\042\076\074div st\171\154e=\042\160\141\144ding: \063\160\170 5px;b\141\143\153ground-\143\157\154or: #F\106\105\102E8;bord\145\162: 1px soli\144\040#CC0000;co\154\157r: #333;\042\076<strong>".__("\127\141rning: your ac\143\145\163s to update\163\040\141nd suppor\164\040\146or Maps \115\141\162ker Pro h\141\163\040expire\144\041","l\155\155")."\074\057strong><br/\076"; $ld=get_option("lea\146\154\145tmapsmarker_\166\145\162sion_pro_lat\145\163\164"); if (($ld != NULL) && ($ld>$O5)) { $Oc.=__("Latest availab\154e ve\162\163\151on:","lmm")." <a href='https\072\057/www.mapsmarker\056\143\157m/v".$ld."p' tar\147\145\164='_blank' \164\151\164le='".esc_attr__("\143lick to show r\145\154\145ase notes","lmm")."'>".$ld."\074\057a> "."\050<a href='www.ma\160\163\155arker.com/c\150\141ngelog/pro/' \164\141\162get='_bla\156\153\047>".__("show all availab\154\145\040changelog\163","\154mm")."</a>)<br/>"; } $Oc.=sprintf(__("\131ou can continue\040\165sing versio\156\040\045s without \141\156y limitations\056\040Nevertheless\040\171\157u will \156\157\164\040\142e able to\040\147et updat\145\163\040includ\151\156\147 bugfix\145\163\054 ne\167\040features a\156\144\040optimi\172\141tions as \167\145ll as acce\163\163 to our su\160\160ort s\171\163tem. ","\154mm"),$O5)."<br/>".sprintf(__("\074\141 href=\042\045\163\042>Please\040\162\145new your ac\143\145\163s to up\144\141\164es and s\165\160\160ort to \153\145ep your pl\165\147in up-to\055\144ate and sa\146\145\074/a>.","\154mm"),l1."\141\144min.php?page=le\141\146\154etmapsmarke\162\137\154icense")."</div>"; } else { $Oc=""; } $links[]=$l6."\046\156bsp;".$O6."\046\156bsp;".$l7."\046nbsp;".$O7."&nbsp;".$l8."&nbsp;".$O8."&nbsp;".$l9."\046\156bsp;".$O9."&n\142\163\160;".$la."\046\156bsp;".$Oa.$Oc; } return $links; } function lmm_delete_multisite_blog($blog_id) { switch_to_blog($blog_id); $GLOBALS["\167pdb"]->query("\104ROP TABLE `".$GLOBALS["wpdb"]->prefix."leafletm\141\160\163marker_laye\162\163\140"); $GLOBALS["wpdb"]->query("DROP TA\102\114\105 `".$GLOBALS["\167pdb"]->prefix."leafletmapsm\141\162\153er_markers`"); $l0=wp_upload_dir(); $icons_directory=$l0["base\144\151\162"].DIRECTORY_SEPARATOR."\154\145aflet-maps-marker\055\151\143ons".DIRECTORY_SEPARATOR; if (is_dir($icons_directory)) { foreach (glob($icons_directory."\052\056*") as $v) { unlink($v); } rmdir($icons_directory); } } function lmm_update_pointer_admin_scripts() { $dismissed_pointers=explode(",",( string) get_user_meta(get_current_user_id(),"dismissed_wp_\160\157inters",TRUE)); $dismissed_pointers=array_flip($dismissed_pointers); $Od=FALSE; $lmm_version_new=get_option("\154eafletmapsma\162\153\145r_version_p\162\157"); $le="\154mmvp".str_replace(".","",$lmm_version_new); if (! isset ($dismissed_pointers[$le])) { $current_dismissed_wp_pointers=get_user_meta(get_current_user_id(),"dismi\163\163\145d_wp_point\145\162\163"); $replace_lmmv=preg_replace("\057\050lmmv(p)?(\134\144\051\053(,)?)/",NULL,$current_dismissed_wp_pointers["0"]); $replace_without_end_comma=preg_replace("\057(,)\044/",NULL,$replace_lmmv); update_user_meta(get_current_user_id(),"dismissed_wp_po\151\156\164ers",$replace_without_end_comma); $Od=TRUE; add_action("\141dmin_\160\162\151nt_footer_scri\160\164\163",array($this,"\154\155m_update_poin\164\145\162_footer_scrip\164")); } if ($Od) { wp_enqueue_script("\167p-pointer"); wp_enqueue_style("\167p-pointer"); } } function lmm_update_pointer_footer_script() { $O4=get_option("leafletmapsmar\153\145r_options"); $lmm_version_new=get_option("\154eafletmap\163\155\141rker_versi\157\156\137pro"); $le="lm\155\166\160".str_replace("\056","",$lmm_version_new); $Oe="\074h3>".sprintf(esc_attr__("Maps \115\141rker Pro plu\147\151\156 update to \166\0451s wa\163\040\163uccessfu\154","\154\155\155"),$lmm_version_new)."</h3>"; if (get_option("leafle\164\155\141psmarker_upd\141\164\145_info") == "s\150\157\167") { $changelog_url="\074a href=\042".l1."\141\144min.php?page=leafl\145\164\155apsmarker\137\155\141rkers"."\042 st\171\154\145=\042text-\144\145\143oration:none\073\042\076".__("\143hangelog","\154\155m")."</a>"; } else { $changelog_url="\074a href=\042\150\164tps://www.maps\155\141\162ker.com/v".$lmm_version_new."p\042\040\163tyle=\042te\170\164\055decoration\072\156\157ne;\042\040\164\141rget=\042\137\142lank\042>".__("changelog","\154mm")."\074/a>"; } $blogpost_url="\074\141\040href=\042\150\164\164ps://www.ma\160\163\155arker.com/\166".$lmm_version_new."\160\042 targ\145\164\075\042_bl\141\156\153\042 s\164\171\154e=\042t\145\170\164-decorat\151\157\156:none;\042\076\155apsmarke\162\056com</a>"; $Oe.="\074p>".sprintf(esc_attr__("Please see the %1\163\040\146or new featu\162\145\163 or the blo\147\040\160ost on %\062\163\040for mor\145\040\144etails","l\155\155"),$changelog_url,$blogpost_url)."\074\057p>"; ?><?php echo "\015\012\011\011\074script typ\145\075\042text/java\163\143\162ipt\042\076\057/ <![CDATA[\015\012\011\011\152\121\165ery(doc\165\155ent).ready\050\146\165nction\050\044) \173\015\012\011\011\011\151\146(typeof\050\152Query().p\157\151\156ter) !\075\040'undefine\144\047) \173\015\012\011\011\011\011\044('#top\154\145vel_page_\154\145afletmaps\155\141rker_mark\145\162s').point\145\162(\173\015\012\011\011\011\011\011conte\156\164: '"; ?><?php echo $Oe; ?><?php echo "',\015\012\011\011\011\011\011\160\157sition: \173\015\012\011\011\011\011\011\011\145\144\147e: 'lef\164\047\054\015\012\011\011\011\011\011\011align:\040\047center\047\015\012\011\011\011\011\011}\054\015\012\011\011\011\011\011\143\154ose: func\164\151\157n() \173\015\012\011\011\011\011\011\011\044\056post(\040\141jaxurl,\040\173\015\012\011\011\011\011\011\011\011poi\156\164er: '"; ?><?php echo $le; ?><?php echo "\047,\015\012\011\011\011\011\011\011\011action: 'd\151\163\155iss-wp-p\157\151\156ter'\015\012\011\011\011\011\011\011});\015\012\011\011\011\011\011}\015\012\011\011\011\011\175\051.pointer\050\047open');\015\012\011\011\011\175\015\012\011\011\175);\015\012\011\011// ]]\076\074/script>\015\012\011\011"; ?><?php } function lmm_feature_pointer_admin_scripts() { $dismissed_pointers=explode("\054",( string) get_user_meta(get_current_user_id(),"dismissed_wp_poi\156\164\145rs",TRUE)); $dismissed_pointers=array_flip($dismissed_pointers); $Od=FALSE; if (! isset ($dismissed_pointers["lmmesw"])) { $Od=TRUE; add_action("a\144\155in_print_footer_\163\143\162ipts",array($this,"\154\155m_feature_po\151\156\164er_footer_sc\162\151\160t")); } if ($Od) { wp_enqueue_script("wp-pointer"); wp_enqueue_style("\167\160-pointer"); } } function lmm_feature_pointer_footer_script() { include ("inc".DIRECTORY_SEPARATOR."feature-poin\164\145\162s.php"); } function lmm_register_widgets() { $O4=get_option("leafletmapsmarke\162\137\157ptions"); if ($O4["\155\151\163c_whitelabel\137\142\141ckend"] == "\145\156\141bled") { $lf=__("M\141\160\163 - recent ma\162\153\145rs","lmm"); } else { $lf=__("\115aps Marker P\162\157\040- recent m\141\162\153ers","\154mm"); } wp_add_dashboard_widget("\154\155m-admin-dash\142\157\141rd-widget",$lf,array( &$this,"lmm_dashb\157\141\162d_widget"),array( &$this,"lmm_\144\141shboard_widg\145\164\137control")); } function lmm_dashboard_widget() { global $wpdb; $O4=get_option("leafletma\160\163\155arker_opt\151\157\156s"); if ($O4["defaults_m\141\162\153er_custom_ic\157\156\137url_dir"] == "no") { $defaults_marker_icon_dir=l3; $defaults_marker_icon_url=O2; } else { $defaults_marker_icon_dir=htmlspecialchars($O4["\144efaults_marker_ic\157\156\137dir"]); $defaults_marker_icon_url=esc_url($O4["\144efaults_marker\137\151\143on_url"]); } $table_name_markers=$wpdb->prefix."\154eafletmapsmarker\137\155\141rkers"; $widgets=get_option("dashboard_widget\137\157\160tions"); $widget_id="lmm-admin-das\150\142\157ard-widget"; $number_of_markers= isset ($widgets[$widget_id]) && isset ($widgets[$widget_id]["\151tems"]) ? absint($widgets[$widget_id]["ite\155\163"]): 4; if ((lb($Ob=FALSE,$lc=TRUE) === TRUE) && (lb() === FALSE)) { $O5=get_option("\154eafletma\160\163\155arker_versi\157\156\137pro"); echo "<\144\151\166 style=\042\160\141dding: 3p\170\040\065px;back\147\162\157und-colo\162\072 #FFEBE8;b\157\162\144er: 1p\170\040solid #CC0\060\0600;borde\162\055radius: 3p\170\073\143olor: \043\06333;\042><\163\164rong>".__("W\141\162\156ing: your ac\143\145\163s to update\163\040\141nd suppo\162\164\040for Map\163\040\115arker P\162\157\040has ex\160\151\162ed!","lmm")."</strong\076\074\142r/>"; $ld=get_option("\154\145afletmapsma\162\153\145r_version_p\162\157_latest"); if (($ld != NULL) && ($ld>$O5)) { echo __("\114\141\164est avail\141\142\154e version:","lmm")." <a href='https:/\057\167\167w.mapsmarke\162\056\143om/v".$ld."p' target=\047\137\142lank' title=\047".esc_attr__("\143\154\151ck to show \162\145\154ease notes","\154mm")."'>".$ld."</a> "."(\074\141\040href='https:/\057\167\167w.mapsmarke\162\056\143om/changel\157\147\057pro/' ta\162\147\145t='_blank\047\076".__("\163how all avail\141\142\154e changelogs","lmm")."\074/a>)<br/>"; } echo sprintf(__("You can conti\156\165\145 using ver\163\151\157n %s withou\164\040any limitati\157\156\163. Neve\162\164heless you \167\151\154l not \142\145\040able \164\157\040get u\160\144\141tes inc\154\165\144ing bu\147\146\151xes, n\145\167\040featur\145\163 and opti\155\151\172ations\040\141s well as\040\141ccess to \157\165\162 supp\157\162\164 syst\145\155\056 ","\154\155\155"),$O5)."<br/>".sprintf(__("\074a href=\042\045\163\042>Please\040\162\145new your \141\143\143ess to u\160\144\141tes and s\165\160\160ort to \153\145\145p your \160\154\165gin u\160\055\164o-date\040\141nd safe</a\076\056","lmm"),l1."\141dmin.php?pa\147\145\075leafletmaps\155\141\162ker_licens\145")."\074\057div>"; echo "<hr\040\163\164yle=\042\142\157\162der:0;heigh\164\072\061px;back\147\162\157und-color:\043\1448d8d8;\042\057\076"; } $Of=$wpdb->get_results($wpdb->prepare( "SELECT `id`,`m\141\162\153ername`,`ic\157\156\140,`createdon`\054\140createdby` \106\122\117M `$table_name_markers` ORDER BY `creat\145\144\157n` desc LIMI\124\040\045d" ,$number_of_markers),ARRAY_A); if ($Of != NULL) { echo "\074table style=\042\155\141rgin-bottom:\065\160\170;\042>\074\164\162>"; foreach ($Of as $row) { $icon=($row["\151con"] == NULL) ? O1."leaflet-dist/ima\147es/marker.png": $defaults_marker_icon_url."\057".esc_html($row["\151\143on"]); echo "\074\164d><a href=\042".l1."a\144\155\151n.php?page=le\141\146\154etmapsmarke\162\137marker&id=".$row["\151d"]."\042 title=\042".esc_attr__("edit marker","\154\155m")."\042><im\147\040\163rc=\042".$icon."\042\040width=\042".intval($O4["\144\145faults_marker\137\151\143on_iconsize\137\170"])."\042\040\150\145ight=\042".intval($O4["def\141\165\154ts_marker_ico\156\137\151consize_y"])."\042\076</a>"; echo "<td style=\042\166\145rtical-align\072\164\157p;line-h\145\151\147ht:1.2em;\042\076"; echo "\074\141\040href=\042".l1."\141dmin.php?pag\145\075\154eafletmaps\155\141\162ker_marker&\151\144\075".$row["\151d"]."\042 ti\164\154\145=\042".esc_attr__("\145dit marker","\154mm")."\042>".htmlspecialchars(stripslashes($row["mar\153\145\162name"]))."\074/a><br/>".__("created\040\157\156","\154mm")." ".date("Y-m-d - h:m",strtotime($row["\143\162eatedon"]))."\054 ".__("created by","\154\155m")." ".esc_html($row["creat\145\144\142y"]); echo "\074\057td></tr>"; } echo "</tabl\145\076"; } else { echo "\074p style=\042m\141\162\147in-bottom:5\160\170\073\042>".__("\116o marker cr\145\141\164ed yet","\154mm")."</p>"; } if (! isset ($widgets[$widget_id]["bl\157\147\160osts"])) { $lg=1; } else if ( isset ($widgets[$widget_id]["blogposts"]) && ($widgets[$widget_id]["\142logposts"] == 1)) { $lg=0; } else { $lg=1; } function lmm_spc_custom_name($Og) { return "\155\141psmarker-d\141\163\150board-widget\055\162\163s-item-\143\141\143he"; } if (($lg == 1) && ($O4["\155isc_whitelab\145\154\137backend"] == "d\151\163\141bled")) { require_once (ABSPATH.WPINC.DIRECTORY_SEPARATOR."\143\154ass-simplepie.\160\150\160"); $lh=new simplepie(); if (file_exists($defaults_marker_icon_dir.DIRECTORY_SEPARATOR."readme-ic\157\156\163.txt")) { $lh->enable_cache(TRUE); $lh->set_cache_location($location=$defaults_marker_icon_dir); $lh->set_cache_name_function("\154mm_spc_cust\157\155\137name"); $lh->set_cache_duration(0250600); } else { $lh->enable_cache(FALSE); } $lh->set_feed_url("\150ttp://feeds.feedb\165\162\156er.com/Map\163\115\141rkerPro"); $lh->set_stupidly_fast(TRUE); $lh->enable_order_by_date(TRUE); $lh->init(); $lh->handle_content_type(); echo "<h\162\040style=\042b\157\162\144er:0;height:1\160\170\073backgroun\144\055\143olor:#d8\144\070\1448;\042\057\076<p style=\042\155\141rgin:0\056\065em 0;font\055\167\145ight:b\157\154d;\042>".__("La\164\145\163t blog posts f\162\157\155 www.mapsm\141\162\153er.com","\154\155m")."</p>"; if ($lh->get_items() == NULL) { $blogpost_url="\074a href=\042\150\164\164ps://www.ma\160\163\155arker.com/ne\167\163\042 target=\042\137\142lank\042\076\150ttps://ww\167\056mapsmarker\056\143om/news</\141\076"; echo sprintf(__("Feed could not be \162\145\164rieved, pl\145\141se try aga\151\156\040later or\040\162\145ad the\040\154atest blog \160\157\163ts at %\163","\154mm"),$blogpost_url); } foreach ($lh->get_items(0,3) as $item) { echo "<p style=\042\155\141rgin:0.5em 0;\042\076".$item->get_date("\152 F Y").": <\141\040\150ref=\042".$item->get_permalink()."?r\145\146\075dashboard\042\076".str_replace("div>","\163\160\141n>",$item->get_title())."\074/a></p>".PHP_EOL; } echo "\074hr style=\042\142\157rder:0;h\145\151\147ht:1px;back\147\162\157und-color:\043\1448d8d8;\042\057\076\012\011\011\011\011<div sty\154\145=\042dis\160\154ay:inline-\142\154\157ck;\042\076\074a style=\042\164ext-decora\164\151\157n:none\073\042 href=\042http\163\072//\167\167\167.mapsm\141\162\153er.co\155\042 target=\042\137\142lank\042\076<img src=\042".O1."inc/img/icon-we\142\163\151te-home.png\042\040width=\04216\042\040height=\042\061\066\042 alt=\042\155\141psmark\145\162\056com\042\076\040MapsMar\153\145\162.com</a\076\074/div>&nb\163\160\073\012\011\011\011\011<d\151\166\040style=\042\144isplay:inl\151\156e-block;\042\076\074a sty\154\145\075\042\164\145xt-decora\164\151\157n:none\073\042 title=\042".esc_attr__("\115\141psMarker affiliat\145\040\160rogram - s\151\147\156 up now and\040\162\145ceive co\155\155\151ssions u\160\040\164o 50%!","\154\155\155")."\042\040\150ref=\042\150\164\164ps://affil\151\141\164es.mapsmar\153\145\162.com/\042\040\164\141rget=\042\137\142lank\042>\074\151mg src=\042".O1."inc\057\151\155g/icon-affili\141\164\145s.png\042 \167\151\144th=\042\061\066\042 height\075\042\0616\042\040\141\154t=\042".esc_attr__("MapsMarker affi\154\151\141te program - \163\151\147n up now an\144\040\162eceive \143\157\155missions \165\160\040to 50%\041","lmm")."\042\076\040".__("\101\146\146iliates","\154mm")."</a></d\151\166\076&nbsp;\012\011\011\011\011<div st\171\154\145=\042di\163\160\154ay:inline\055\142lock;\042\076\074a style=\042\164\145xt-decor\141\164\151on:non\145\073\042 title\075\042".esc_attr__("\115\141psMarker res\145\154\154er program -\040\162\145-sell wit\150\040\141 20% di\163\143\157unt!","lmm")."\042\040\150ref=\042h\164\164\160s://www.maps\155\141\162ker.com/r\145\163eller\042 t\141\162\147et=\042\137\142\154ank\042\076\074img src=\042".O1."inc\057\151\155g/icon-resell\145\162\163.png\042\040\167\151dth=\042\061\066\042 heig\150\164\075\04216\042\040\141lt=\042".esc_attr__("Map\163\115\141rker reselle\162\040\160rogram - re\055\163\145ll with \141\040\0620% disco\165\156\164!","lmm")."\042\076\040".__("Resel\154\145\162s","\154\155m")."</a></d\151\166\076&nbsp;\012\011\011\011\011<div s\164\171\154e=\042di\163\160\154ay:inline\055\142\154ock;\042\076\074a style\075\042text-decor\141\164\151on:non\145\073\042 href\075\042https://\167\167\167.mapsm\141\162\153er.com\057\162eviews\042\040\164arget=\042\137\142lank\042\040\164itle=\042".esc_attr__("pleas\145\040\162ate this plug\151\156\040on wordpr\145\163\163.org","\154\155m")."\042><\151\155\147 src=\042".O1."inc/img/icon-s\164\141\162.png\042\040\167\151dth=\042\061\066\042 height=\042\061\066\042 \141\154\164=\042".esc_attr__("\160lease rate t\150\151\163 plugin on \167\157\162dpress.org","\154\155m")."\042\076\040".__("\162ate plugin","lmm")."\074/a></div>&nbsp;\012\011\011\011\011<d\151\166\040style=\042\144\151splay:inl\151\156\145-block;\042\076\074a hre\146\075\042ht\164\160\163://tra\156\163\154ate.map\163\155\141rker.c\157\155\057projec\164\163\057lmm\042\040\164arget=\042\137\142lank\042\076\074img sr\143\075\042".O1."in\143\057img/icon-\164\162\141nslations.pn\147\042\040width=\042\061\066\042 heig\150\164\075\04216\042\040alt=\042tr\141\156\163latio\156\163\042> ".__("t\162\141\156slations","lmm")."</\141\076\074/div>&nbsp;\012\011\011\011\011<div\040\163\164yle=\042\144\151\163play:inl\151\156\145-block;\042\076\074a href\075\042\150ttps:/\057\167ww.mapsmar\153\145\162.com/h\141\143\153erone\042\040\164arget=\042\137\142lank\042\040\164itle=\042".esc_attr__("\102\157unty Hunters w\141\156\164ed! Find s\145\143\165rity bugs \164\157\040earn cas\150\040\141nd lice\156\163\145s","lmm")."\042\076\074\151mg src=\042".O1."inc/img/\151\143\157n-hackerone.\160\156\147\042 wid\164\150=\04216\042\040\150eight=\0421\066\042 alt=\042h\141\143\153erone\042\076\040hackero\156\145\074/a></di\166\076&nbsp;\012\011\011\011\011<di\166\040style=\042\144\151splay:inl\151\156\145-block\073\042><a href=\042\150ttps://twi\164\164\145r.com/\155\141psmarker\042\040\164arget=\042\137blank\042\076\074img src=\042".O1."\151\156c/img/icon-tw\151\164\164er.png\042\040\167idth=\04216\042\040height=\042\061\066\042 alt=\042\164\167itter\042\076\040Twitter</\141\076</div>&nbs\160\073\012\011\011\011\011<div st\171\154\145=\042d\151\163\160lay:in\154\151\156e-block\073\042><a href\075\042https://f\141\143\145book.c\157\155\057mapsm\141\162\153er\042\040\164arget=\042\137\142lank\042\076\074img sr\143\075\042".O1."inc/img/icon-fac\145\142\157ok.png\042\040\167idth=\0421\066\042 height=\042\061\066\042 alt=\042\146\141cebook\042\076\040Facebo\157\153\074/a></d\151\166\076&nbsp;\012\011\011\011\011\074\144iv style=\042\144isplay:inl\151\156\145-block\073\042><a href=\042\150\164tps://\167\167w.mapsmark\145\162\056com/+\042\040target=\042\137\142lank\042\076\074img src=\042".O1."\151\156c/img/icon-\147\157\157gle-plus.png\042\040\167idth=\042\061\066\042 heig\150\164\075\04216\042\040\141lt=\042\147\157ogle+\042\076\040Google+</a\076\074/div>&nbsp\073\012\011\011\011\011\074div styl\145\075\042displ\141\171\072inline\055\142lock;\042\076\074a style=\042\164\145xt-dec\157\162ation:non\145\073\042 href\075\042https://\167\167\167.mapsm\141\162ker.com\057\143hangelog/\160\162o\042 ta\162\147et=\042_\142\154ank\042>\074\151mg src=\042".O1."\151nc/img/icon-\143\150\141ngelog-heade\162\056\160ng\042 \167\151\144th=\042\061\066\042 height\075\04216\042 al\164\075\042chang\145\154\157g\042>\040".__("\103\150angelog","\154\155m")."</a></div\076\046\156bsp;\012\011\011\011\011<div s\164\171\154e=\042d\151\163\160lay:inlin\145\055\142lock;\042\076\074a href=\042\150ttps://fee\144\163\056feedbur\156\145\162.com/M\141\160\163Marker\042\040\164arget=\042\137\142lank\042\076\074img src\075\042".O1."\151\156\143/img/icon-rs\163\056\160ng\042 w\151\144\164h=\04216\042 \150\145\151ght=\042\061\066\042 alt=\042\162\163s\042>\040\122SS</a></d\151\166\076&nbsp;\012\011\011\011\011\074\144iv style=\042\144\151splay:\151\156\154ine-blo\143\153\073\042>\074\141 href=\042\150\164tp://fee\144\142\165rner.g\157\157gle.com/fb\057\141/mailver\151\146\171?uri=M\141\160sMarker\042\040\164arget=\042\137blank\042\076\074img src\075\042".O1."inc/img/icon-rss-e\155\141\151l.png\042\040\167\151dth=\042\061\066\042 heigh\164\075\04216\042\040\141\154t=\042\162\163\163-email\042\076\040".__("E-Mail","lmm")."\074/a></div>"; } } function lmm_dashboard_widget_control() { $O4=get_option("leafletmapsmark\145\162_options"); $widget_id="lmm-ad\155\151\156-dashboard-w\151\144\147et"; $form_id="lm\155\055\141dmin-dashboar\144\055\167idget-cont\162\157\154"; $update=FALSE; if (!$widget_options=get_option("das\150\142\157ard_widget_op\164\151\157ns")) $widget_options=array(); if (! isset ($widget_options[$widget_id])) { $widget_options[$widget_id]=array("bl\157\147\160osts" => 0,"\151tems" => 5); $update=TRUE; } if ("POST" == $_SERVER["\122EQUEST_METHO\104"] && isset ($_POST[$form_id])) { $number=($_POST[$form_id]["\151tems"] == NULL) ? "3": absint($_POST[$form_id]["items"]); $Oh= isset ($_POST[$form_id]["\142logposts"]) ? "1": "\060"; $widget_options[$widget_id]["\151\164ems"]=$number; $widget_options[$widget_id]["blogposts"]=$Oh; $update=TRUE; } if ($update) update_option("\144ashboard_\167\151\144get_option\163",$widget_options); $number= isset ($widget_options[$widget_id]["ite\155\163"]) ? ( integer) $widget_options[$widget_id]["items"]: ""; echo "\074p><label for=\042\154\155m-admin-dash\142\157\141rd-widget-\156\165\155ber\042\076".__("\116\165mber of markers \164\157\040show:")."\040</label>"; echo "<input id=\042\154\155m-admin-dashbo\141\162\144-widget-\156\165\155ber\042\040\156\141me=\042".$form_id."\133items]\042\040\164\171pe=\042\164\145\170t\042 va\154\165\145=\042".$number."\042\040\163\151ze=\0422\042\040\057></p>"; if ($O4["\155isc_whitelabel_b\141\143\153end"] == "disabled") { echo "<p><lab\145\154\040for=\042\154\155\155-admin-das\150\142\157ard-wid\147\145\164-blogpost\163\042\076".__("\110\151\144e blog posts \141\156\144 link secti\157\156\072")."\040\074/label>"; echo "\074\151nput id=\042\154\155\155-admin-das\150\142\157ard-widge\164\055\142logposts\042\040name=\042".$form_id."[blogposts]\042\040\164ype=\042c\150\145\143kbox\042 ".checked($widget_options[$widget_id]["blogposts"],1,FALSE)."\057></p>"; } } function lmm_load_translation_files() { load_plugin_textdomain("lmm",FALSE,dirname(plugin_basename( __FILE__))."\057\154anguages/"); } function lmm_set_plugin_locale($lang) { $O4=get_option("leafletma\160\163\155arker_option\163"); global $locale; if ($O4["misc_plugin\137\154\141nguage_ar\145\141"] == "backend") { return is_admin() ? $O4["misc_plugin_l\141\156\147uage"]: $locale; } else if ($O4["mis\143\137\160lugin_languag\145\137\141rea"] == "fro\156\164\145nd") { return is_admin() ? $locale: $O4["misc_\160\154\165gin_language"]; } else if ($O4["mis\143\137\160lugin_languag\145\137\141rea"] == "bot\150") { return $O4["misc_plugin_lang\165\141\147e"]; } else { return $locale; } } function lmm_compatibility_checks() { include ("inc".DIRECTORY_SEPARATOR."compatibility-ch\145\143\153s.php"); } function lmm_help() { include ("leaflet\055\150elp-credits.php"); } function lmm_settings() { global $Oi; $Oi->display_page(); } function lmm_list_layers() { include ("leaflet-lis\164\055layers.php"); } function lmm_list_markers() { include ("leaflet-list-mark\145\162\163.php"); } function lmm_layer() { include ("lea\146\154\145t-layer.php"); } function lmm_marker() { include ("l\145\141\146let-marker.ph\160"); } function lmm_import_export() { include ("\154\145aflet-import-exp\157\162\164.php"); } function lmm_tools() { include ("leaflet-tools\056\160hp"); } function lmm_apis() { if (!current_user_can("\141\143tivate_plugi\156\163")) { return; } settings_errors(); require_once l2."inc".DIRECTORY_SEPARATOR."admin-header\056php"; require_once l2."i\156\143".DIRECTORY_SEPARATOR."adm\151\156\055content-apis.\160\150\160"; require_once l2."inc".DIRECTORY_SEPARATOR."class-ap\151\055\153eys-table.ph\160"; $lj=new mmp_api_keys_table(); $lj->prepare_items(); $lj->display(); require_once l2."\151\156c".DIRECTORY_SEPARATOR."admin-f\157\157\164er.php"; } function lmm_add_georss_to_head() { $georss_to_head="<link rel=\042\141\154ternate\042\040\164ype=\042app\154\151\143ation/rss+\170\155\154\042 ti\164\154\145=\042".get_bloginfo("name")." GeoRSS-Feed\042\040\150ref=\042".mmp_globals::translate_permalink(mmp_rewrite::get_base_url().mmp_rewrite::get_slug()."\057\147eorss/layer/al\154\057")."\042 />".PHP_EOL; echo $georss_to_head; } function lmm_showmap($atts) { require ("inc".DIRECTORY_SEPARATOR."\163howmap_prepar\145\056\160hp"); $Oj=apply_filters("\155\155p_map_conte\156\164",$Oj,$atts); return $Oj; } function lmm_load_settings_class() { if (is_admin()) { require_once (plugin_dir_path( __FILE__)."inc".DIRECTORY_SEPARATOR."\143\154\141ss-leaflet-o\160\164\151ons.php"); global $Oi; $Oi=new class_leaflet_options(); } } function lmm_admin_menu() { global $wp_version; if (version_compare($wp_version,"\063.8-alpha","\076")) { $lk="-w\150\151\164e"; } else { $lk=""; } $O4=get_option("\154\145afletmapsmarker_\157\160\164ions"); if (!empty($O4)) { $capabilities=$O4["c\141\160\141bilities_view\137\157\164hers"]; $Ok="\141ctivate_plugi\156\163"; $ll=$O4["capabilitie\163\137\145dit_others"]; } else { $capabilities="\145dit_posts"; $Ok="\141\143tivate_plugins"; $ll="\141\143tivate_plugins"; } if (!empty($O4)) { if ($O4["misc_whitelabel_b\141\143\153end"] == "enabled") { $lm=esc_attr__("Map\163","lmm"); $Ok="a\143\164\151vate_plugin\163"; $ll=$O4["c\141\160\141bilities_edit\137\157\164hers"]; } else { $lm="<span style=\042\146\157nt-size:92%;\042\076\115aps Mark\145\162\040Pro</spa\156\076"; $Ok=$O4["c\141\160\141bilities_vie\167\137\157thers"]; $ll=$O4["\143apabilities_\145\144\151t_others"]; } } else { $lm="Maps M\141\162\153er Pro"; $Ok="activate_plugins"; $ll="activate_plugins"; } $page=add_menu_page($lm,$lm,$capabilities,"\154\145afletmapsmark\145\162\137markers",array( &$this,"lmm_list_markers"),O1."inc/img/\151\143\157n-menu-pag\145".$lk.".png","25.071"); if (!empty($O4)) { $page2=add_submenu_page("\154\145afletmapsmark\145\162\137markers",$lm." - ".__("List all markers","\154mm"),"\074\151\155g src=\042".O1."inc/img/icon-m\145\156\165-list".$lk.".png\042\076\040".__("\114\151\163t all marker\163","\154\155\155"),$O4["\143apabiliti\145\163\137view_others"],"leafletma\160\163\155arker_markers",array( &$this,"\154\155\155_list_markers")); $page3=add_submenu_page("leafletmapsm\141\162\153er_markers",$lm." - ".__("add/edit marker","lmm"),"<img src=\042".O1."inc/img/i\143\157\156-menu-add".$lk.".png\042> ".__("\101\144d new marker","lmm"),$O4["\143\141\160abilities_view\137\157\164hers"],"\154\145afletmapsmarker_ma\162\153\145r",array( &$this,"\154mm_marker")); $page4=add_submenu_page("le\141\146\154etmapsmarker_\155\141\162kers",$lm." \055\040".__("\114ist all laye\162\163","\154mm"),"\074\151mg src=\042".O1."inc/img\057\151\143on-menu-list".$lk."\056\160ng\042> ".__("\114ist all layers","\154mm"),$O4["\143apabilities_view_\157\164\150ers"],"lea\146\154\145tmapsmarker_la\171\145\162s",array( &$this,"lm\155\137\154ist_layers")); $page5=add_submenu_page("le\141\146\154etmapsmarker_\155\141\162kers",$lm." - ".__("\141dd/edit lay\145\162","lmm"),"\074\151\155g src=\042".O1."in\143\057\151mg/icon-menu-\141\144\144".$lk."\056\160ng\042> ".__("\101\144d new layer","lmm"),$O4["\143\141pabilities_vi\145\167\137others"],"leafletmapsmar\153\145\162_layer",array( &$this,"lmm_\154\141\171er")); $page8=add_submenu_page("\154\145\141fletmapsmarke\162\137\155arkers",$lm." - ".__("Support","lm\155"),"\074img src=\042".O1."\151\156\143/img/icon-menu\055\150\145lp".$lk.".png\042\076\040".__("\123\165pport","\154\155m"),$Ok,"\154eafletmapsmarker\137\150\145lp",array( &$this,"\154mm_help")); } else { $page=""; $page2=""; $page3=""; $page4=""; $page5=""; $page8=""; } if (!empty($O4)) { $page3b=add_submenu_page("\154\145afletmapsmarke\162\137\155arkers",$lm." - ".__("Import/Export","\154mm"),"<hr n\157\163\150ade size=\042\061\042 styl\145\075\042margin-\164\157\160:0px;\042\057\076<img src=\042".O1."inc/img/ic\157\156\055menu-impor\164\055\145xport".$lk."\056\160ng\042> ".__("Imp\157\162\164/Export","\154\155m"),$O4["capabilities_v\151\145w_others"],"\154eafletmapsmark\145\162\137import_exp\157\162\164",array( &$this,"lmm_import_expo\162\164")); } else { $page3b=""; } $page6=add_submenu_page("leafletmapsmarker\137\155\141rkers",$lm." - ".__("\124\157\157ls","lmm"),"\074\151mg src=\042".O1."inc/i\155\147\057icon-menu-to\157\154\163".$lk.".png\042\076\040".__("\124ools","lmm"),$ll,"leafletmapsmark\145\162\137tools",array( &$this,"lmm_\164\157\157ls")); $page7=add_submenu_page("leafletmapsmarke\162\137\155arkers",$lm." - ".__("Settings","lmm"),"\074img src=\042".O1."inc/img/ic\157\156\055menu-setti\156\147\163".$lk."\056\160\156g\042> ".__("\123\145ttings","\154\155\155"),"activate_plu\147\151\156s","\154\145\141fletmapsmarker\137\163\145ttings",array( &$this,"\154mm_settings")); $page11=add_submenu_page("\154eafletmapsmarker_\155\141\162kers",$lm."\040- ".__("Map\163\040\115arker APIs","\154\155m"),"<\151\155\147 src=\042".O1."\151nc/img/icon-menu-\141\160\151".$lk."\056\160ng\042> ".__("Map\163\040\115arker APIs","\154\155m"),$Ok,"\154eafletmapsmark\145\162\137apis",array( &$this,"\154mm_apis")); if (!empty($O4)) { $page10=add_submenu_page("leafletma\160\163\155arker_mark\145\162\163",$lm." - ".__("Licen\163\145\040settings","lmm"),"<hr noshade si\172\145\075\0421\042\040\163tyle=\042\155\141rgin-top:0px\073\042/><img src=\042".O1."\151nc/img/icon-\155\145\156u-settings".$lk."\056png\042> ".__("\114\151cense settings","lmm"),$Ok,"\154eafletmapsma\162\153\145r_license","maps_marker_p\162\157\137license_acti\166\141\164ion_page"); } else { $page10=""; } add_action("admin_p\162\151\156t_scripts-".$page3,array( &$this,"\154mm_admin_enqueue_\163\143\162ipts"),7); add_action("\141\144\155in_print_sc\162\151\160ts-".$page5,array( &$this,"lm\155\137\141dmin_enqueue_sc\162\151\160ts"),8); add_action("admin\137\160\162int_scripts-".$page2,array( &$this,"lmm_admin_s\145\154\145ctjs"),011); add_action("ad\155\151\156_print_style\163\055".$page3,array( &$this,"lm\155\137\141dmin_selectj\163"),011); add_action("admi\156\137\160rint_styles-".$page5,array( &$this,"\154\155m_admin_selectjs"),011); add_action("admin_print_s\143\162\151pts-".$page7,array( &$this,"lm\155\137\141dmin_selectjs"),011); add_action("\141\144\155in_print_scr\151\160\164s-".$page4,array( &$this,"\154\155m_admin_selectj\163"),011); add_action("\141\144min_print_scri\160\164\163-".$page11,array( &$this,"\154\155m_admin_select\152\163"),011); add_action("\141dmin_print_s\143\162\151pts-".$page3,array( &$this,"\154mm_admin\137\141\152ax_actionsjs\137\142\141ckend"),012); add_action("admi\156\137\160rint_scripts-".$page5,array( &$this,"lmm_admin_ajax_a\143\164\151onsjs_back\145\156\144"),012); add_action("admin_print_sty\154\145\163-".$page3,array( &$this,"\154\155\155_admin_enq\165\145\165e_styles\150eets_lea\146\154\145t"),023); add_action("\141\144\155in_print_styl\145\163\055".$page5,array( &$this,"\154mm_admin_e\156\161\165eue_styleshe\145\164\163_leaflet"),023); add_action("\141\144\155in_print_sty\154\145\163-".$page,array( &$this,"lmm_admin_e\156\161\165eue_styleshe\145\164\163"),021); add_action("\141dmin_print_st\171\154\145s-".$page2,array( &$this,"lmm_admin_enq\165\145\165e_styleshee\164\163"),022); add_action("admin_pri\156\164\137styles-".$page3,array( &$this,"\154mm_admin_e\156\161\165eue_stylesh\145\145\164s"),023); add_action("admin_pr\151\156\164_styles-".$page3b,array( &$this,"\154\155m_admin_enqu\145\165\145_stylesheet\163"),023); add_action("admi\156\137\160rint_\163\164\171les-".$page4,array( &$this,"l\155\155\137admin_enque\165\145\137stylesheets"),024); add_action("ad\155\151\156_print_styles\055".$page5,array( &$this,"lmm_admin_enq\165\145\165e_styleshe\145\164\163"),025); add_action("\141dmin_print_\163\164\171les-".$page6,array( &$this,"\154mm_admin_en\161\165\145ue_styleshee\164\163"),026); add_action("a\144\155\151n_print_style\163\055".$page7,array( &$this,"\154mm_admin_enqueue\137\163\164ylesheets"),027); add_action("admin_print_st\171\154es-".$page8,array( &$this,"\154\155m_admin_enq\165\145\165e_styleshe\145\164\163"),030); add_action("\141\144min_print_styles-".$page10,array( &$this,"\154mm_admin_enq\165\145\165e_styleshe\145\164\163"),031); add_action("admin\137\160\162int_styles-".$page11,array( &$this,"lmm_admin_enqueu\145\137\163tylesheets"),032); add_action("admin_en\161\165\145ue_scripts",array( &$this,"lmm_admin_e\156\161\165eue_styleshe\145\164\163_adminbar"),031); add_action("\141dmin_print_sc\162\151\160ts-".$page,array( &$this,"\154\155m_add_contextua\154\137\150elp")); add_action("\141\144min_print_scri\160\164\163-".$page2,array( &$this,"lmm_add_contextu\141\154\137help")); add_action("admin_print\137\163\143ripts-".$page3,array( &$this,"\154\155\155_add_contex\164\165\141l_help")); add_action("\141dmin_print_script\163\055".$page3b,array( &$this,"lmm_add_contextu\141\154\137help")); add_action("adm\151\156\137print_script\163\055".$page4,array( &$this,"lmm_a\144\144_contextual_help")); add_action("\141\144\155in_print_sc\162\151\160ts-".$page5,array( &$this,"\154\155m_add_contextual_h\145\154\160")); add_action("\141\144min_print\137\163cripts-".$page6,array( &$this,"\154\155m_add_contextu\141\154\137help")); add_action("admin_print_scri\160\164\163-".$page7,array( &$this,"\154\155\155_add_co\156\164\145xtual_help")); add_action("adm\151n_print_scrip\164\163\055".$page8,array( &$this,"lmm_ad\144\137\143ontextual_help")); add_action("\141\144min_print_sc\162\151\160ts-".$page10,array( &$this,"\154mm_add_contextual\137\150\145lp")); add_action("a\144\155\151n_print_scr\151\160\164s-".$page11,array( &$this,"\154\155m_add_contextu\141\154\137help")); add_action("\141dmin_print_sc\162\151\160ts-".$page7,array( &$this,"\154\155m_admin_boo\164\163\164rap_tabs"),011); } function lmm_add_admin_bar_menu() { global $wp_version; $O4=get_option("\154eafletmapsmarker_\157\160\164ions"); $Om=( isset ($_GET["\160age"]) ? $_GET["\160age"]: ""); if ($Om == "\154\145\141fletmapsmar\153\145\162_marker") { $ln="#"; } else { $ln=l1."\141\144min.php?page\075\154\145afletmaps\155\141\162ker_marker"; } if ($Om == "\154\145afletmapsma\162\153\145r_layer") { $On="#"; } else { $On=l1."admin.php?\160\141\147e=leafletmap\163\155\141rker_layer"; } if ($O4["\141dmin_bar_integ\162\141\164ion"] == "enabled" && current_user_can($O4["\143\141\160abilities_vie\167\137\157thers"])) { global $wp_admin_bar; if ($O4["misc_whitelabe\154\137\142ackend"] == "enabled") { $lo=esc_attr__("\115\141ps","\154\155\155"); $Oo=""; } else { $lo="Maps Mar\153\145\162 Pro"; $Oo=array("title" => "Wordpress-Plu\147\151\156 ".__("by","\154\155m")." www.mapsmarker.com"); } if (version_compare($wp_version,"\063\0568-alpha","\076")) { $lk="\055\167\150ite"; $lp="<span class=\042\141\142-icon\042\076\074\057span><spa\156\040\143lass=\042\141\142-label\042\076".$lo."</span>"; } else { $lp="<img style\075\042float:left;marg\151\156\0723px 5px 0 \060\073\042 src=\042".O1."\151nc/img/icon-\164\151\156ymce.png\042\057\076 ".$lo; $lk=""; } $menu_items=array(array("id" => "lm\155","title" => $lp,"\150\162ef" => "","\155eta" => $Oo),array("\151d" => "lmm-mark\145\162\163","\160arent" => "lmm","title" => "\074\151\155g src=\042".O1."inc/img/icon-\155\145\156u-list".$lk."\056png\042> ".__("List all mark\145\162s","\154\155m"),"\150\162ef" => l1."\141\144min.php?page\075\154\145afletmapsma\162\153\145r_markers"),array("\151\144" => "lmm-add-\155\141\162ker","\160arent" => "lmm","title" => "<img src=\042".O1."inc/img/icon\055\155enu-add".$lk.".png\042\076\040".__("Add new marker","\154\155\155"),"href" => $ln),array("\151d" => "lmm-layers","\160\141rent" => "\154mm","\164\151\164le" => "\074\151mg src=\042".O1."i\156\143\057img/icon-menu\055\154\151st".$lk."\056png\042\076\040".__("\114ist all layers","\154mm"),"\150\162ef" => l1."a\144min.php?page\075\154eafletmapsm\141\162\153er_l\141\171\145rs"),array("i\144" => "lmm-add-l\141\171\145rs","p\141\162\145nt" => "\154mm","title" => "\074\151\155g src=\042".O1."inc/img/\151\143\157n-menu-add".$lk.".pn\147\042\076 ".__("Add new layer","lmm"),"href" => $On),array("\151d" => "\154\155\155-help-credits","pare\156\164" => "\154mm","title" => "<img src=\042".O1."\151\156\143/img/icon-m\145\156\165-help".$lk."\056png\042> ".__("\123upport","lmm"),"\150\162ef" => l1."admin.php?page=le\141\146\154etmapsmarke\162\137help"),array("id" => "lmm-i\155\160\157rt-export","parent" => "\154mm","\164itle" => "<hr style=\042\155\141\162gin:3px 0;\042\040\156oshade siz\145\075\0421\042\057\076\074img src\075\042".O1."\151nc/img/icon-men\165\055\151mport-expo\162\164".$lk.".png\042\076\040".__("Import/Exp\157\162\164","lmm"),"\150ref" => l1."\141dmin.php?page=\154\145\141fletmapsmar\153\145r_import_exp\157\162\164")); if (current_user_can("\141ctivate_plug\151\156\163") && ($O4["\155isc_whitel\141\142\145l_bac\153\145\156d"] == "disabled")) { $menu_items=array_merge($menu_items,array(array("i\144" => "lmm-tools","\160arent" => "\154mm","\164\151\164le" => "\074\151mg src=\042".O1."in\143\057\151mg/icon-men\165\055\164ools".$lk."\056png\042\076\040".__("To\157\154\163","lmm"),"\150ref" => l1."a\144\155\151n.php?page=le\141\146\154etmapsmark\145\162_tools"),array("\151\144" => "\154\155m-settings","pa\162\145\156t" => "\154mm","title" => "\074\151mg src=\042".O1."\151\156\143/img/icon-me\156\165\055settings".$lk."\056\160ng\042> ".__("\123\145\164tings","\154mm"),"\150\162\145f" => l1."admin.php?page=l\145\141fletmapsmar\153\145r_settings"),array("\151d" => "lmm-apis","parent" => "\154mm","\164itle" => "<i\155\147 src=\042".O1."inc/img/icon-men\165\055api".$lk."\056png\042> M\141\160\163 Marker API\163","\150\162ef" => l1."admin.php?page=\154\145\141fletmapsmar\153\145r_apis"))); } if ($O4["misc_\167\150\151telabel_backe\156\144"] == "\144is\141\142\154ed") { $menu_items=array_merge($menu_items,array(array("id" => "\154\155m-license","\160\141rent" => "\154\155m","titl\145" => "<hr style=\042\155\141\162gin:3px \060\073\042 noshade\040\163\151ze=\042\061\042/><img src=\042".O1."\151\156\143/img/icon-me\156\165\055settings".$lk."\056\160\156g\042> ".__("Li\143\145\156se setting\163","lmm"),"href" => l1."\141dmin.php?page\075\154\145afletmapsm\141\162\153er_license"))); } foreach ($menu_items as $menu_item) { $wp_admin_bar->add_menu($menu_item); } } } function lmm_add_contextual_help() { $helptext="\074\160>".__("\104\157 you have qu\145\163\164ions or iss\165\145\163? Please u\163\145\040the fol\154\157\167ing sup\160\157\162t chann\145\154s appropr\151\141\164ely.","lmm")."\074\142r/>"; $helptext.="<st\162\157\156g>".__("Before you p\157\163\164 a new suppo\162\164\040ticket, p\154\145\141se follow\040\164\150e instru\143\164\151ons fro\155\040<a href=\042\150\164tp://ww\167\056mapsmarke\162\056com/readm\145\055first\042\040\164arget=\042\137blank\042\076\150ttp://ww\167\056mapsmar\153\145\162.com/\162\145\141dme-f\151\162\163t</a> \167\150\151ch gi\166\145 you a gu\151\144eline on \150\157w to dea\154\040with the\040\155ost comm\157\156 issues.","\154mm")."\074\057strong></p>"; $helptext.="<ul>"; $helptext.="<li><a href=\042\150\164\164ps://www.m\141\160\163marker.co\155\057faq/\042 \164\141\162get=\042\137\142lank\042>".__("\106AQ","lmm")."\074\057a> (".__("frequen\164\154\171 asked quest\151\157\156s","lmm")."\051\074/li>"; $helptext.="<li><a\040\150\162ef=\042h\164\164\160s://www.map\163\155\141rker.com/\144\157\143s/\042 \164\141\162get=\042\137\142lank\042>".__("\104\157cumentation","lmm")."</a></li>"; $helptext.="<li><a href=\042\150\164tps://www.map\163\155\141rker.com/lo\147\151\156\042 t\141\162\147et=\042_\142\154\141nk\042>\155\141\160smarke\162\056\143om/log\151\156\074/a> (".__("sup\160\157\162t for pro user\163","\154\155m")."\051</li>"; $helptext.="\074\057ul>"; $screen=get_current_screen(); $screen->add_help_tab(array("\151\144" => "\154\155m_help_tab","title" => __("\110\145lp & Support","lmm"),"\143\157\156tent" => $helptext)); } function lmm_admin_selectjs() { $O5=get_option("\154\145\141fletmapsmar\153\145\162_version_pro"); wp_enqueue_script(array("jq\165\145\162y")); wp_enqueue_script("\154eafletmapsmarker-\154\151\163t-markers-l\141\171\145rs",O1."in\143\057\152s/list-marker\163\055\154ayers.js",array("jqu\145\162\171"),$O5); wp_localize_script("leafletm\141\160\163marker-list-\155\141\162kers-layers","lmm_aj\141\170\137vars",array("\154mm_ajax_nonce" => wp_create_nonce("lmm-\141\152\141x-nonce"),"\154\155m_ajax_current_p\141\147\145" => ( isset ($_GET["page"]) ? $_GET["\160age"]: ""),"lmm_ajax_l\145\141\146let_plugin_ur\154" => O1)); wp_enqueue_script("leaflet\155\141\160smarker-selec\164\062",O1."i\156\143\057js/select2/sele\143\164\062.min.js",array("jquery"),$O5); wp_enqueue_style("\154eafletmapsmar\153\145\162-select2",O1."inc/js/select2\057\163elect2.css",array(),$O5); wp_localize_script("\154\145\141fletmapsmark\145\162\055select2","mapsmarkerjsp\162\157\137selectjs",array("settings_search_p\154\141\143eholder" => __("start full-tex\164\040\163earch","lmm"),"sett\151\156\147s_search_no_re\163\165\154ts" => __("\116\157 matches found","lmm"),"lmm_current\137\160\141ge" => ( isset ($_GET["\160\141ge"]) ? $_GET["\160\141ge"]: ""))); } function lmm_admin_ajax_actionsjs_backend() { $O4=get_option("leafletmapsmarke\162\137\157ptions"); if ($O4["defa\165\154\164s_marker_cus\164\157\155_icon_url_\144\151\162"] == "\156o") { $defaults_marker_icon_url=LEAFLET_PLUGIN_ICONS_URL; } else { $defaults_marker_icon_url=esc_url($O4["\144\145faults_marker_ico\156\137\165rl"]); } $O5=get_option("leafletmaps\155\141\162ker_version\137\160\162o"); wp_enqueue_script(array("jquery")); wp_enqueue_script("\154eafletmapsm\141\162\153er-ajax-acti\157\156\163-js-backend",O1."inc/js/ajax-ac\164\151\157ns-backend.\152\163",array("\152query"),$O5); wp_localize_script("\154\145\141fletmapsmark\145\162\055ajax-acti\157\156\163-js-backend","lmm_ajax_var\163",array("\154mm_ajax_nonce" => wp_create_nonce("\154mm-ajax-non\143\145"),"\154mm_ajax_curren\164\137\160age" => ( isset ($_GET["\160ag\145"]) ? $_GET["\160age"]: ""),"lmm_ajax_confirm_\144\145\154ete" => esc_attr__("\104\157 you really wa\156\164\040to delete\040\164his marker?\040\050cannot be un\144\157\156e)","lm\155"),"\154\155m_ajax_shortc\157\144\145" => htmlspecialchars($O4["\163hortcode"]),"lmm_aj\141\170\137site_url" => mmp_rewrite::get_base_url(),"\154\155m_ajax_lmm_slu\147" => mmp_rewrite::get_slug(),"\154mm_ajax_leaflet_p\154\165\147in_url" => O1,"\154\155m_ajax_text_no_r\145\163\165lts_found" => __("\116o matches f\157\165\156d","\154\155m"),"\154mm_ajax_admin_ur\154" => l1,"\154\155m_ajax_url" => admin_url("\141\144min-ajax.php"),"\154mm_ajax_misc_k\155\154" => $O4["\155isc_kml"],"\154mm_get_directi\157\156\163_text" => esc_attr__("Get directions","\154mm"),"lmm_directions_te\170\164" => __("Directio\156\163","\154mm"),"lmm_defa\165\154ts_marker_ico\156\137\165rl" => $defaults_marker_icon_url)); } function lmm_admin_bootstrap_tabs() { global $wp_scripts; if ( isset ($wp_scripts->registered) && is_array($wp_scripts->registered)) { foreach ($wp_scripts->registered as $script) { if ((strpos($script->handle ,"bootstrap") !== FALSE) || (strpos($script->src ,"\142ootstrap") !== FALSE)) { wp_dequeue_script($script->handle); wp_deregister_script($script->handle); } } } $O5=get_option("leaflet\155\141psmarker_ver\163\151\157n_pro"); wp_enqueue_script(array("\152query")); wp_enqueue_script("leafletmaps\155\141rker-boots\164\162\141p-tabs",O1."inc/js/\142\157\157tstrap-tabs.\155\151\156.js",array("\152query"),$O5); } function lmm_frontend_enqueue_scripts() { global $locale; $O4=get_option("\154eafletm\141\160\163marker_option\163"); $O5=get_option("\154eafletmapsmark\145\162\137version_pro"); if ($O4["\147\157\157gle_maps_ap\151\137\163tatus"] == "disabled" || $O4["\147oogle_maps_api_de\146\145\162red_loading"] == "\145\156abled") { if ($O4["\155\151sc_javascript_hea\144\145\162_footer_p\162\157"] == "footer") { wp_register_script("leafletma\160\163\155arker-core",O1."leaflet-dist\057\154eaflet-core.js",array(),$O5,FALSE); wp_register_script("\154eafletmapsmarke\162\055\141ddons",O1."leaflet-di\163\164\057leaflet-add\157\156\163.js",array("l\145\141\146letmapsmarker\055\143\157re"),$O5,FALSE); wp_register_script("\163how_map",O1."inc/js/sho\167\137map.js",array("\152\161uery","leafletm\141\160\163marker-core","\154eafletmapsmarker\055\141\144dons"),$O5,FALSE); } else { wp_enqueue_script("\154\145afletmapsmar\153\145\162-core",O1."leaflet\055\144\151st/leafle\164\055\143ore.js",array(),$O5,FALSE); wp_enqueue_script("le\141\146letmapsmarker\055\141\144dons",O1."\154eaflet-dist/l\145\141\146let-addons.j\163",array("\152\161uery","\154\145afletmapsmarker-\143\157\162e"),$O5,FALSE); } } else { if ( isset ($O4["\147oogle_maps_api_k\145\171"]) && ($O4["goog\154\145\137maps_api_key"] != NULL)) { $google_maps_api_key="\077\153\145y=".esc_js(trim($O4["\147\157ogle_maps_api_ke\171"])); } else { $google_maps_api_key=""; } if ($O4["misc_javascrip\164\137\150eader_foote\162\137\160ro"] == "\146\157oter") { wp_register_script("lea\146\154\145tmapsmarker-go\157\147\154emaps-loade\162","\150ttps://www.g\157\157\147le.com/jsapi".$google_maps_api_key,array(),NULL,TRUE); } else { wp_enqueue_script("\154\145\141fletmapsmarke\162\055\147ooglemaps-\154\157\141der","\150\164\164ps://www.goog\154\145\056com/jsapi".$google_maps_api_key,array(),NULL,TRUE); } if ($O4["misc_javascript\137\150\145ader_footer\137\160\162o"] == "footer") { wp_register_script("leafletmap\163\155\141rker-core",O1."leaf\154\145\164-dist/leafle\164\055\143ore.js",array("lea\146\154\145tmapsmarker-goo\147\154\145maps-loader"),$O5,FALSE); wp_register_script("\154eafletmapsmarker-\141\144\144ons",O1."\154\145aflet-dist/\154\145\141flet-addons.j\163",array("\154\145\141fletmapsmarke\162\055\143ore"),$O5,FALSE); wp_register_script("show_map",O1."inc/js/\163\150\157w_map.js",array("jquer\171","\154\145afletmapsmarker-c\157\162\145","\154eafletmapsmarker\055\141\144dons"),$O5,FALSE); } else { wp_enqueue_script("\154eafletmapsmar\153\145\162-core",O1."leaflet-dist/\154\145\141flet-core.j\163",array("\154eafletmapsmarker-g\157\157\147lemaps-loader"),$O5,FALSE); wp_enqueue_script("leafletmapsma\162\153\145r-addons",O1."\154eaflet-dist/le\141\146\154et-addons.js",array("leafletmap\163\155\141rker-core"),$O5,FALSE); } } if ($O4["\155\141pquest_api_key"] != NULL) { if ($O4["misc_j\141\166\141script_heade\162\137\146ooter_pro"] == "\146ooter") { wp_register_script("\154\145afletmapsmarker\055\155\141pquest","ht\164\160\163://www.mapque\163\164api.com/sdk/\154\145\141flet/v2.2/\155\161-map.js\077\153\145y=".esc_js(trim($O4["mapq\165\145\163t_api_key"])),array("\154eafletmapsmarke\162\055\143ore"),$O5,FALSE); } else { wp_enqueue_script("leafletmapsma\162\153\145r-mapquest","\150\164\164ps://www.mapq\165\145\163tapi.com/sdk\057\154\145aflet/v2.2\057\155\161-map.js?\153\145\171=".esc_js(trim($O4["mapquest_api_\153\145\171"])),array("leafletmapsmar\153\145\162-core"),$O5,FALSE); } } $google_styling_json=($O4["google\137\163\164yling_json"] == NULL) ? "\144\151sabled": str_replace("\042","\047",$O4["google_styli\156\147\137json"]); if ($O4["\142\151ngmaps_culture"] == "automatic") { if ($locale != NULL) { $bing_culture=str_replace("_","-",$locale); } else { $bing_culture="\145\156_us"; } } else { $bing_culture=$O4["bingmaps_c\165\154\164ure"]; } if ($O4["\147oogle_maps_la\156\147\165age_localiza\164\151on"] == "browser_setting") { $google_language=""; } else if ($O4["goo\147\154\145_maps_languag\145\137\154ocalization"] == "wordpress_setting") { if ($locale != NULL) { $google_language="\046language=".substr($locale,0,2); } else { $google_language="\046language=en"; } } else { $google_language="&language=".esc_html($O4["\147oogle_maps_langua\147\145\137localizatio\156"]); } if ($O4["google_m\141\160\163_base_doma\151\156\137custom"] == "") { $gmaps_base_domain="&base_domai\156\075".esc_html($O4["\147\157ogle_maps_base_\144\157\155ain"]); } else { $gmaps_base_domain="&base_do\155\141\151n=".esc_html($O4["g\157\157gle_maps_base_dom\141\151\156_custom"]); } wp_localize_script("\154eafletmapsmarker\055\143\157re","mapsmar\153\145rjspro",array("\172\157om_in" => __("\132\157\157m in","lmm"),"\172oom_out" => __("Zoom out","\154mm"),"\147oogle_maps_api_sta\164\165\163" => esc_js($O4["google_maps_api_\163\164\141tus"]),"go\157\147\154e_maps_plugin" => esc_js($O4["g\157\157\147le_maps_\160\154\165gin"]),"google_defe\162\162\145d_loading" => esc_js($O4["\147\157ogle_maps_api_de\146\145\162red_loading"]),"go\157\147\154emaps_languag\145" => $google_language,"\147\157oglemaps_base_do\155\141\151n" => $gmaps_base_domain,"\147oogle_maps_api_ke\171" => esc_js(trim($O4["google_maps_api_\153\145y"])),"\147oogle_styling_j\163\157\156" => $google_styling_json,"bing\137\143\165lture" => $bing_culture,"\155\151nimap_sh\157\167" => __("\123\150\157w minimap","\154\155\155"),"\155\151nimap_hide" => __("\110\151de minimap","lmm"),"fullscreen_bu\164\164\157n_title" => __("\126\151ew fullscreen","\154mm"),"full\163\143\162een_button_tit\154\145\137exit" => __("Ex\151\164\040fu\154\154\163creen","lmm"),"fullscreen\137\142\165tton_positi\157\156" => esc_js($O4["map_fu\154\154\163creen_butt\157\156\137position"]),"maxzoom" => intval($O4["\147lobal_maxzoom_l\145\166\145l"]),"\155\145ters" => __("meters","\154\155m"),"\146\145\145t" => __("feet","lmm"),"\147\160x_icons_sta\164\165\163" => esc_js($O4["\147\160x_icons_status"]))); wp_localize_script("\154\145\141fletmapsmarke\162\055addons","lmm_ajax_vars",array("lmm_ajax_nonce" => wp_create_nonce("\154mm-ajax-nonce"),"\154mm_ajax_leafle\164\137\160lugin_url" => O1,"\154mm_ajax_text_n\157\137\162esults_found" => __("\116\157\040matches f\157\165\156d","lmm"),"\154\155m_ajax_url" => admin_url("\141\144min-ajax.php"))); } function lmm_admin_enqueue_scripts() { global $wp_version,$locale; $O4=get_option("\154eafletmapsmar\153\145\162_options"); $O5=get_option("\154\145afletmapsmarke\162\137\166ersion_pro"); wp_enqueue_script(array("jquery")); $page=( isset ($_GET["page"]) ? $_GET["page"]: ""); if ($page == "leafletma\160\163\155arker_layer") { if (version_compare($wp_version,"\063\056\065","\076\075")) { wp_enqueue_media(); } else { wp_enqueue_style("thi\143\153\142ox"); wp_enqueue_script("\155\145dia-upload"); wp_enqueue_script("thickbox"); wp_enqueue_script("\155edia-models"); } } wp_enqueue_script("leafl\145\164\155apsmarker-au\164\157\143omplete-lo\141\144\145r",O1."\151nc/js/autocomp\154\145\164e.jquery.mi\156\056\152s",array("jq\165\145\162y"),$O5); wp_enqueue_script("\154eafletmapsmar\153\145\162-geocoding-\154\157\141der",O1."inc/js/geo\143\157\144ing.js",array("jquery"),$O5); if ($O4["google_maps\137\141\160i_status"] == "disa\142\154\145d" || $O4["\147\157ogle_maps_api_def\145\162\162ed_loading"] == "\145\156\141bled") { wp_enqueue_script("leafletmaps\155\141\162ker-core",O1."leafl\145\164\055dist/leafl\145\164\055core.js",array(),$O5,FALSE); wp_enqueue_script("\154eafletmapsm\141\162\153er-addons",O1."\154\145\141flet-dist/l\145\141\146let-addons\056\152\163",array("leafletmapsma\162\153\145r-core"),$O5,FALSE); } else { if ( isset ($O4["google_maps_api_k\145\171"]) && ($O4["goo\147\154\145_maps_api_k\145\171"] != NULL)) { $google_maps_api_key="?key=".esc_js(trim($O4["google_maps_a\160\151_key"])); } else { $google_maps_api_key=""; } wp_enqueue_script("leaflet\155\141\160smarker-goog\154\145\155aps-loader","\150\164tps://www.goog\154\145\056com/jsapi".$google_maps_api_key,array(),NULL,TRUE); wp_enqueue_script("leafletmapsmarke\162\055\143ore",O1."\154eaflet-dist/le\141\146\154et-core.js",array("\154eafletmapsmarke\162\055\147ooglemaps-lo\141\144\145r"),$O5,FALSE); wp_enqueue_script("\154eafletmapsmar\153\145\162-addons",O1."leaflet\055\144ist/leaflet-\141\144\144ons.js",array("\154eafletmapsmarker-c\157\162\145"),$O5,FALSE); } if ($O4["\155a\160\161\165est_api_key"] != NULL) { wp_enqueue_script("\154eafletmap\163\155\141rker-mapquest","\150ttps://www.mapque\163\164\141pi.com/sdk\057\154eaflet/v2\056\062/mq-map.js?k\145\171\075".esc_js(trim($O4["\155apquest_api\137\153\145y"])),array("\154\145afletmapsmark\145\162\055core"),NULL,FALSE); } if ($O4["\147\157\157gle_maps_la\156\147\165age_localiza\164\151on"] == "b\162\157\167ser_setting") { $google_language=""; } else if ($O4["\147\157ogle_maps_lang\165\141\147e_localiza\164\151\157n"] == "wordpress_s\145\164\164ing") { if ($locale != NULL) { $google_language="&langua\147\145\075".substr($locale,0,2); } else { $google_language="&language=en"; } } else { $google_language="\046language=".esc_html($O4["\147oogle_m\141\160\163_language_lo\143\141\154ization"]); } if ($O4["\147\157ogle_maps_base_\144\157\155ain_custom"] != "") { $gmaps_base_domain="\046base_domain=".esc_html($O4["\147oogle_maps\137\142\141se_domain"]); } else { $gmaps_base_domain="&base_domain=".esc_html($O4["\147oogle_maps_base_\144\157\155ain_custom"]); } $google_styling_json=($O4["\147oog\154\145\137styling_jso\156"] == NULL) ? "\144\151\163abled": str_replace("\042","'",$O4["google_styling_j\163\157n"]); if ($O4["\142\151ngmaps_cultur\145"] == "autom\141\164\151c") { if ($locale != NULL) { $bing_culture=str_replace("_","-",$locale); } else { $bing_culture="\145\156_us"; } } else { $bing_culture=$O4["bingmaps_cu\154\164ure"]; } wp_localize_script("\154\145afletmapsm\141\162\153er-core","ma\160\163\155arkerjspro",array("\172oom_in" => __("Zoom in","l\155m"),"zoo\155\137\157ut" => __("Zoom ou\164","\154mm"),"\147\157ogle_maps_ap\151\137\163tatus" => esc_js($O4["\147oogle_ma\160\163\137api_status"]),"\147\157ogle_maps_plugi\156" => esc_js($O4["google_maps_plugi\156"]),"\147oogle_deferre\144\137\154oading" => esc_js($O4["goog\154\145\137maps_api_de\146\145\162red_loadin\147"]),"googlemaps_lan\147\165\141ge" => $google_language,"googl\145\155\141ps_base_domai\156" => $gmaps_base_domain,"\147oogle_maps_api\137\153\145y" => esc_js(trim($O4["google_maps_\141\160\151_key"])),"\147\157ogle_styling_json" => $google_styling_json,"\142\151ng_culture" => $bing_culture,"\155\151nimap_show" => __("Show minimap","\154\155m"),"minimap_hide" => __("Hide minima\160","lmm"),"fullscreen\137\142\165tton_title" => __("\126iew fullscre\145\156","lmm"),"\146\165llscreen_butt\157n_title_exit" => __("\105\170it fullscreen","\154mm"),"\146ullscreen_bu\164\164\157n_position" => esc_js($O4["\155ap_fullscreen_bu\164\164\157n_position"]),"max\172\157\157m" => intval($O4["global_m\141\170\172oom_level"]),"\155\145\164ers" => __("met\145\162\163","lmm"),"feet" => __("fee\164","\154\155m"),"gpx_icons_sta\164\165\163" => esc_js($O4["gpx_icons_sta\164\165\163"]))); } function lmm_frontend_enqueue_stylesheets() { $O4=get_option("leaflet\155\141psmarker_opt\151\157\156\163"); global $wp_query; $posts=$wp_query->posts; $pattern=get_shortcode_regex(); $O5=get_option("leafletmapsmarke\162_version_p\162\157"); if (function_exists("\151s_rtl") && is_rtl()) { $Op="\154eafletmapsmarker-\162\164\154"; $lq="leaflet-rtl.min.\143\163\163"; } else { $Op="leafletmapsmarke\162"; $lq="leaflet.min.css"; } wp_register_style($Op,O1."\154eaflet-dist/".$lq,array(),$O5); if (is_array($posts)) { foreach ($posts as $post) { if (preg_match_all("/".$pattern."\057\163",$post->post_content ,$matches) && array_key_exists(2,$matches) && in_array($O4["s\150\157rtcode"],$matches[2])) { wp_enqueue_style($Op); break; } } $lmm_custom_css=".leaflet-popup-c\157\156tent img \173\040".htmlspecialchars($O4["defaults_ma\162ker_popups_\151\155\141ge_css"])."\040\175 .marker-clust\145\162\055small \173\040\142ackgrou\156\144\055color: ".htmlspecialchars($O4["\143\154\165stering_col\157\162\137small"])."; } .marker-cluste\162\055\163mall div\040\173 background-c\157\154\157r: ".htmlspecialchars($O4["cluster\151\156\147_color_small\137\151\156ner"])."\073\040color: ".htmlspecialchars($O4["clustering_co\154\157\162_small_text"])."; } .marker-clu\163\164\145r-medium \173\040\142ackground-co\154\157\162: ".htmlspecialchars($O4["clusteri\156\147\137color_medium"])."; } .marker-cluste\162\055medium div \173\040\142ackground-c\157\154\157r: ".htmlspecialchars($O4["\143\154\165stering_colo\162\137\155edium_inne\162"])."\073\040 color: ".htmlspecialchars($O4["\143lustering_col\157\162\137medium_text"])."\073 } .marker-\143\154\165ster-large \173\040\142ackgroun\144\055color: ".htmlspecialchars($O4["clustering_color\137\154\141rge"])."; } .marker-clus\164\145\162-large div \173\040\142ackground\055\143\157lor: ".htmlspecialchars($O4["clust\145\162\151ng_color_larg\145\137\151nner"])."\073\040 color: ".htmlspecialchars($O4["clustering\137\143\157lor_large_t\145\170\164"])."\073 }"; wp_add_inline_style($Op,$lmm_custom_css); } } function lmm_template_check_shortcode($template) { $O4=get_option("leafletmapsma\162\153\145r_options"); $searchterm="\133".$O4["sh\157\162\164code"]; $files=array($template,get_stylesheet_directory().DIRECTORY_SEPARATOR."\150eader.php",get_stylesheet_directory().DIRECTORY_SEPARATOR."footer\056\160\150p"); if (function_exists("is_rtl") && is_rtl()) { $Op="leafletmap\163\155\141rker-rtl"; $lq="leaf\154\145\164-rtl.min.css"; } else { $Op="\154eafletmapsmar\153\145\162"; $lq="\154eaflet.min.cs\163"; } foreach ($files as $file) { if (file_exists($file)) { $contents=file_get_contents($file); if (strpos($contents,$searchterm)) { $O5=get_option("\154eafletmap\163\155\141rker_version\137\160\162o"); wp_register_style($Op,O1."\154\145\141flet-dist/".$lq,array(),$O5); wp_enqueue_style($Op); break; } } } return $template; } function lmm_admin_enqueue_stylesheets() { $O5=get_option("\154\145afletmapsmar\153\145\162_version_pr\157"); if (function_exists("\151s_rtl") && is_rtl()) { wp_register_style("\154\145afletmapsmar\153\145\162-admin-rtl",O1."\151\156\143/css/leafletma\160\163\155arker-admin\055rtl.css",array(),$O5); wp_enqueue_style("leafletmapsmarke\162\055\141dmin-rtl"); } else { wp_register_style("\154eafletmaps\155\141\162ker-admin",O1."\151\156c/css/leafletmap\163\155\141rker-admin\056\143ss",array(),$O5); wp_enqueue_style("\154eafletmapsma\162\153\145r-admin"); } } function lmm_admin_enqueue_stylesheets_leaflet() { global $wp_version; $O5=get_option("leafletmapsmar\153\145r_version_pro"); if (function_exists("is_rtl") && is_rtl()) { $Op="\154eafletmapsma\162\153\145r-rtl"; $lq="\154eaflet-rtl.m\151\156\056css"; } else { $Op="leafletmapsmar\153\145\162"; $lq="lea\146\154\145t.min.css"; } wp_register_style($Op,O1."\154\145aflet-dist/".$lq,array(),$O5); wp_enqueue_style($Op); if (version_compare($wp_version,"3.7",">=")) { $O4=get_option("leafletm\141psmark\145\162\137options"); $lmm_custom_css=".\154\145\141flet-popup-con\164\145\156t img \173\040".htmlspecialchars($O4["\144efaults_marke\162\137\160opups_image_c\163\163"])."\040\175 .marker-clu\163\164\145r-small \173\040\142ackground-co\154\157\162: ".htmlspecialchars($O4["clusterin\147\137\143olor_small"])."\073 } .marker\055\143\154uster-smal\154\040\144iv \173\040\142\141ckground-\143\157\154or: ".htmlspecialchars($O4["clustering_color_\163\155\141ll_inner"])."\073\040color: ".htmlspecialchars($O4["\143lustering_color_s\155\141\154l_text"])."\073\040} .marker-cluste\162\055\155edium \173\040\142\141ckground-\143\157\154or: ".htmlspecialchars($O4["clus\164\145\162ing_color_m\145\144\151um"])."\073\040\175 .marker-clu\163\164\145r-medium di\166\040\173 backgrou\156\144\055color: ".htmlspecialchars($O4["\143\154\165stering_colo\162\137\155edium_inner"])."\073 color: ".htmlspecialchars($O4["\143\154\165stering_col\157\162\137medium_text"])."; } .marker-clus\164\145\162-large \173\040\142ackground-co\154\157\162: ".htmlspecialchars($O4["\143\154ustering_col\157\162\137large"])."\073 } .marker-clu\163\164\145r-large di\166\040\173 backgroun\144\055\143olor: ".htmlspecialchars($O4["\143lustering_color_\154\141\162ge_inner"])."\073 color: ".htmlspecialchars($O4["c\154\165\163tering_color_l\141\162\147e_text"])."; }"; wp_add_inline_style($Op,$lmm_custom_css); } } function lmm_admin_enqueue_stylesheets_adminbar() { $O4=get_option("\154eafletmapsma\162\153\145r_options"); if ($O4["admin_ba\162_integration"] == "e\156\141\142led" && current_user_can($O4["capabilities_view\137\157thers"])) { $O5=get_option("\154eafletmapsma\162\153\145r_version_pr\157"); wp_register_style("leafletmapsmarke\162\055\141dmin-admi\156\142\141r",O1."\151\156\143/css/leafletma\160\163\155arker-admin\055\141\144minbar.c\163\163",array(),$O5); wp_enqueue_style("leafletma\160\163\155arker-admi\156\055\141dminbar"); } } function lmm_install_and_updates() { $current_version="\166\160\0631"; $schedule_transient="leaf\154\145\164mapsmarker_in\163\164\141ll_update_c\141\143\150e_".$current_version; $install_update_schedule=get_transient($schedule_transient); if ($install_update_schedule === FALSE) { $schedule_transient="\154\145afletmapsmar\153\145\162_install_u\160\144\141te_cache_".$current_version; set_transient($schedule_transient,"execute ins\164\141\154l and update\055\162\157utine onl\171\040\157nce a day",074*074*030); include ("inc".DIRECTORY_SEPARATOR."install-and-upd\141\164\145s.php"); } } function lmm_plugin_meta_links() { define( "FB_BASENAME" ,plugin_basename( __FILE__)); define( "FB_BASEFOLDER" ,plugin_basename(dirname( __FILE__))); define( "FB_FILENAME" ,str_replace(FB_BASEFOLDER."/","",plugin_basename( __FILE__))); function leafletmapsmarker_filter_plugin_meta($links,$file) { if ($file == FB_BASENAME) { array_unshift($links,"<a href=\042".l1."\141\144\155in.php?page=l\145\141\146letmapsmark\145\162\137markers\042\076".__("Markers","\154mm")."\074/a>","<a h\162\145\146=\042".l1."admin.php\077\160\141ge=leaflet\155\141psmarker_laye\162\163\042>".__("Layers","lm\155")."</a>","\074\141 href=\042".l1."\141dmin.php?page\075\154\145afletmapsmar\153\145\162_settings\042\076".__("Settings","\154\155\155")."\074\057a>","\074a href=\042".l1."\141dmin.php?page=\154\145\141fletmapsmar\153\145\162_license\042\076".__("\114\151cense","\154mm")."</a>"); } return $links; } add_filter("\160\154ugin_action_link\163","\154eafletmapsmarker\137\146\151lter_plugin_m\145\164\141",012,2); } function lmm_add_kml_to_sitemap() { if (class_exists("Google\123\151\164emapGenerato\162")) { global $wpdb; $table_name_markers=$wpdb->prefix."leafle\164\155\141psmarker_mar\153\145\162s"; $Oq=$wpdb->prefix."leafletmaps\155\141\162ker_layers"; $O4=get_option("leafletmapsmar\153\145\162_options"); $sitemap=googlesitemapgenerator::getinstance(); if (($O4["xml_sit\145\155\141ps_include"] == "\142\157th") || ($O4["xml_sitemaps_\151\156\143lude"] == "markers")) { $lr="SELECT m\056\151\144 as mid, m\056\143\162eatedon \141\163\040mcreate\144\157\156, m.updat\145\144\157n as mu\160\144\141tedon F\122\117\115 `".$table_name_markers."` AS m"; if ($O4["xml_sitemap\163\137\145xclude_mar\153\145\162s"] != NULL) { if (preg_match("/^\134d(\077\072\054\134d)*\044\057",str_replace("\054\040","\054",trim($O4["\170ml_sitemaps_exclu\144\145\137markers"]))) == TRUE) { $lr.="\040\127HERE m.id NOT \111\116\040(".str_replace("\054 ",",",trim($O4["\170\155l_sitemaps_e\170\143\154ude_markers"]))."\051"; } } $ls=$wpdb->get_results($lr,ARRAY_A); foreach ($ls as $Os) { if (($Os["\155updatedon"] == NULL) || ($Os["mupdatedon"] == "0000-00-00 00:0\060\07200")) { $lt=strtotime($Os["mcreatedon"]); } else { $lt=strtotime($Os["mupdat\145\144on"]); } $sitemap->addurl(mmp_globals::translate_permalink(mmp_rewrite::get_base_url().mmp_rewrite::get_slug()."\057\153ml/marker/".$Os["\155id"]."/"),$lt,$O4["\170ml_sitemaps_ch\141\156\147e_frequency_m\141\162\153ers"],$O4["\170\155l_sitemaps_p\162\151\157rity_marker\163"]); } } if (($O4["xml_sitema\160\163\137include"] == "both") || ($O4["\170ml_sitemaps_inclu\144\145"] == "layers")) { $Ot="SELECT \154\056id as lid, l.\143\162\145atedon as\040\154createdon, l\056\165pdatedon as \154\165\160datedon\040\106ROM `".$Oq."\140 AS l WHERE l.id \041\075\0400"; if ($O4["\170ml_sitemaps_exc\154\165\144e_layers"] != NULL) { if (preg_match("/^\134\144\050\077:,\134d)*\044\057",str_replace(", ",",",trim($O4["xml_sitem\141\160\163_exclude_la\171\145\162s"]))) == TRUE) { $Ot.="\040AND l.id \116\117\124 IN (".str_replace("\054 ",",",trim($O4["xml_sitemaps_exc\154\165\144e_layers"])).")"; } } $lu=$wpdb->get_results($Ot,ARRAY_A); foreach ($lu as $Ou) { if (($Ou["lupda\164\145don"] == NULL) || ($Ou["\154\165pdatedon"] == "\060\060\060\060-00-00 00\072\060\060:00")) { $lt=strtotime($Ou["\154createdon"]); } else { $lt=strtotime($Ou["\154up\144\141\164edon"]); } $sitemap->addurl(mmp_globals::translate_permalink(mmp_rewrite::get_base_url().mmp_rewrite::get_slug()."/kml/layer/".$Ou["\154id"]."/"),$lt,$O4["\170ml_sitem\141\160\163_change_freq\165\145\156cy_layer\163"],$O4["x\155\154\137sitemaps_pr\151\157\162ity_layers"]); } } } } } if (is_admin()) { $Om= isset ($_GET["page"]) ? $_GET["\160age"]: ""; $lv=array("leafletmapsma\162\153\145r_markers","\154\145\141fletmapsma\162\153\145r_marker","\154\145\141fletmapsmark\145\162\137import_expor\164","leafl\145\164\155apsmarker_layer\163","\154\145afletmapsmar\153\145\162_layer","leafletmapsmar\153\145\162_tools","leafletmap\163\155\141rker_setting\163"); if ((in_array($Om,$lv)) && (O3() === FALSE)) { if (Ov() !== TRUE) { exit (header("\114ocation: ".l1."admin.php?page=l\145\141\146letmapsmark\145\162\137license")); } if (lb($Ob=O0,$lc=FALSE) === FALSE) { $lw=array("leafletmapsmarker_\155\141\162kers","\154eafletmapsmark\145\162\137marker","\154eafletmapsmarker_i\155\160\157rt_export","leafletmapsmarker\137\154\141yers","\154\145afletmapsmark\145\162\137layer","\154\145afletmapsmarker_\164\157\157ls","\154\145afletmapsmarke\162\137\163ettings","leafletmapsmarke\162\137\141pis"); if (in_array($Om,$lw)) { echo "\074script type=\042\164\145xt/javascript\042\076\167indow.loca\164\151\157n.href = \042".l1."admin.php?p\141\147\145=leafletmaps\155\141\162ker_licens\145\046\145rror=le\042\073\074/script>\040\040"; } } } } function Ow($lx,$is_theme=FALSE) { $Ox=""; if ( isset ($_GET["page"])) { $Ox=$_GET["\160\141ge"]; } elseif ( isset ($_POST["\160age"])) { $Ox=$_POST["\160age"]; } $ly=in_array($Ox,$lx); if ($is_theme) { return $ly; } $Oy=in_array(plugin_basename( __FILE__),get_option("activ\145\137\160lugins")); return ($ly && $Oy); } function Ov($lz=FALSE) { $Oz=new l10; $Oz->O10 ="database"; $Oz->l11 =array("\154ocal_key" => get_option("leafletmapsma\162\153\145rpro_licen\163\145\137local_key")); $Oz->O11 =array("\146unction" => "\165\160date_option","key" => "\154eafletmapsmar\153\145\162pro_license_l\157\143\141l_key"); $Oz->l12 ="1,2,3,4,5,6,\067\0548,9,10"; $Oz->O12 =get_option("leafletmaps\155\141\162kerpro_licens\145\137\153ey"); $Oz->l13 ="\067ca99e156b5e30e0\066\064\070f49b811\067\070\143d7e"; $Oz->O13 ="https://w\167\167\056mapsmarker\056\143\157m/store/api\057\151ndex.php"; $Oz->validate(); if ($lz) { return $Oz; } $lx=array("\154eafletmapsmar\153\145\162_markers","leaflet\155\141\160smarker_marker","\154\145\141fletmapsmarke\162\137\151mport_expor\164","leafletmapsmarke\162\137layers","\154eafletmapsmarker\137\154\141yer","\154\145afletmapsmarker\137\164\157ols","\154\145afletmapsmar\153\145\162_settings"); if (is_admin() && Ow($lx,TRUE) && $Oz->l14) { return $Oz->l14; } return TRUE; } function lb($Ob=FALSE,$lc=FALSE) { $Oz=new l10; if ($Ob !== FALSE) { $Oz->Ob =strrev(substr($Ob,1,012)); } $Oz->O10 ="database"; $Oz->l11 =array("\154ocal_k\145\171" => get_option("leafletm\141\160\163markerpro_li\143\145\156se_local_key")); $Oz->O11 =array("f\165\156ction" => "updat\145\137\157ption","key" => "\154eafletmapsmar\153\145\162pro_license\137\154\157cal_key"); $Oz->l12 ="1,2,3,4,5,6\054\067,8,9,10"; $Oz->O12 =get_option("\154\145\141fletmapsmark\145\162\160ro_license_\153\145\171"); $Oz->l13 ="7ca99e156b\065\145\0630e0648f49\142\0701178cd7e"; $Oz->O13 ="https:\057\057\167ww.mapsmar\153\145\162.com/store\057\141\160i/index.\160\150\160"; $Oz->validate(); if ($lc !== FALSE) { if ($Oz->l14) { return FALSE; } else { return TRUE; } } if ($Oz->l14) { return FALSE; } if ($Ob === FALSE) { $O14=$Oz->l15["download_acces\163\137expires"]; $O15=$Oz->l15["\163\165pport_access_exp\151\162\145s"]; $l16=abs(($O14>$O15) ? $O14: $O15); if (!O16()) { if ($Oz->l15["\154icense_ex\160\151\162es"] == "never") { return FALSE; } if (time()>$Oz->l15["\154icense_exp\151\162\145s"]) { return FALSE; } return TRUE; } return ($l16>time()) ? TRUE: FALSE; } else if ($Ob !== FALSE) { $O14=$Oz->l15["\144\157wnload_access_\145\170\160ires"]; $O15=$Oz->l15["support_acce\163\163\137expires"]; $l16=abs(($O14>$O15) ? $O14: $O15); if (!O16()) { if ($Oz->l15["\154icense_expires"] == "\156\145\166er") { return FALSE; } if (time()>$Oz->l15["license_\145\170pires"]) { return FALSE; } return TRUE; } if ($Oz->Ob >$l16) { return FALSE; } else { return TRUE; } } } function lmm_validate_license_info($release_date_info=FALSE,$license_only_info=FALSE) { $spbas_info=new l10; if ($release_date_info !== FALSE) { $spbas_info->release_date_info =strrev(substr($release_date_info,1,012)); } $spbas_info->O10 ="dat\141\142\141se"; $spbas_info->l11 =array("local_\153\145\171" => get_option("\154\145afletmapsmarkerp\162\157\137license_lo\143\141\154_key")); $spbas_info->O11 =array("function" => "upd\141\164\145_option","\153\145y" => "\154\145afletmapsmarke\162\160\162o_license_lo\143\141\154_key"); $spbas_info->l12 ="\061,2,3,4,5,6,7,8,\071\054\0610"; $spbas_info->O12 =get_option("leafletmapsmarke\162pro_license_key"); $spbas_info->l13 ="\067ca99e156b5e30e\060\066\0648f49b811\067\070cd7e"; $spbas_info->O13 ="\150\164\164ps://www.ma\160\163\155arker.com\057\163tore/api/\151\156dex.php"; $spbas_info->validate(); if ($license_only_info !== FALSE) { if ($spbas_info->l14) { return FALSE; } else { return TRUE; } } if ($spbas_info->l14) { return FALSE; } if ($release_date_info === FALSE) { $download_expires_info=$spbas_info->l15["\144ownload_acces\163\137\145xpires"]; $support_expires_info=$spbas_info->l15["\163upport_access\137\145\170pires"]; $expires_info=abs(($download_expires_info>$support_expires_info) ? $download_expires_info: $support_expires_info); if (!O16()) { if ($spbas_info->l15["\154\151cense_expires"] == "never") { return FALSE; } if (time()>$spbas_info->l15["license_expires"]) { return FALSE; } return TRUE; } return ($expires_info>time()) ? TRUE: FALSE; } else if ($release_date_info !== FALSE) { $download_expires_info=$spbas_info->l15["d\157\167nload_access_\145\170\160ires"]; $support_expires_info=$spbas_info->l15["\163upport_access_e\170\160\151res"]; $expires_info=abs(($download_expires_info>$support_expires_info) ? $download_expires_info: $support_expires_info); if (!O16()) { if ($spbas_info->l15["\154icense_exp\151\162\145s"] == "never") { return FALSE; } if (time()>$spbas_info->l15["\154\151cense_expires"]) { return FALSE; } return TRUE; } if ($spbas_info->Ob >$expires_info) { return FALSE; } else { return TRUE; } } } function O16($prefix="\115apsMarkerP\162\157\055") { return substr(get_option("leafletmapsm\141\162kerpro_license\137\153\145y"),0,strlen($prefix)) == $prefix; } function lmm_pro_version_info($prefix="MapsMarkerPr\157\055") { return substr(get_option("\154eafletmapsmarker\160\162\157_license_key"),0,strlen($prefix)) == $prefix; } function l17($prefix="MapsMa\162\153\145rPro-5P-") { return substr(get_option("\154eafletmapsmarke\162\160\162o_license_k\145\171"),0,strlen($prefix)) == $prefix; } function O17($prefix="MapsMar\153\145rPro-25P-") { return substr(get_option("\154eafletmapsmark\145\162\160ro_license_k\145\171"),0,strlen($prefix)) == $prefix; } function l18($prefix="\115apsMarkerPro\055100P-") { return substr(get_option("leafletmap\163\155\141rkerpro_lice\156\163\145_key"),0,strlen($prefix)) == $prefix; } function O18($prefix="MapsMarkerPro\055\06250P-") { return substr(get_option("leafletmap\163\155\141rkerpro_lic\145\156\163e_key"),0,strlen($prefix)) == $prefix; } function l19($prefix="\115\141\160sMarkerPro-\065\0600P-") { return substr(get_option("leaflet\155\141psmarkerpro_li\143\145\156se_key"),0,strlen($prefix)) == $prefix; } function O19($prefix="\115\141\160sMarkerPro-\061\06000P-") { return substr(get_option("leafletmapsmarker\160\162\157_license_ke\171"),0,strlen($prefix)) == $prefix; } function l1a($attribute) { if ( isset ($_POST[$attribute]) && ($_POST[$attribute] == TRUE)) { return $_POST[$attribute]; } global $current_user; wp_get_current_user(); switch ($attribute) { case "\155aps\137\155\141rker_pro_fir\163\164\137name": return $current_user->user_firstname; case "maps_marker_pr\157\137\154ast_name": return $current_user->user_lastname; case "\155aps_marker_p\162\157\137email": return $current_user->user_email; } return ""; } function maps_marker_pro_license_activation_page() { if (!function_exists("w\160_ve\162\151\146y_nonce")) { require_once (ABSPATH."\167\160-includes".DIRECTORY_SEPARATOR."pluggable.php"); } if ( isset ($_POST["maps_marker_pr\157\137\162egister_fr\145\145"])) { if (wp_verify_nonce($_POST["\155\141ps_marker_p\162\157\137register_fre\145\137\146or\155\137\156once"],"maps_mar\153\145\162_pro_registe\162\137\146ree_form_non\143\145")) { $Oz=new l10; $O1a=""; $l1b=array(); if (!$_POST["m\141\160s_marker_pro_\146\151\162st_name"]) { $l1b[]=__("Please enter\040your first na\155\145\040to cont\151\156\165e.","lmm"); } if (!$_POST["\155\141\160s_marker_pro_\154\141\163t_name"]) { $l1b[]=__("\120lease enter \171\157\165r last name t\157\040\143ontinue.","\154mm"); } if (!$_POST["maps_marker\137\160\162o_email"]) { $l1b[]=__("Please ent\145\162\040your email\040\164\157 cont\151\156\165e.","lmm"); } if (sanitize_email($_POST["maps\137\155\141rker_pro_em\141\151\154"]) !== $_POST["\155aps_marker_pro_e\155\141\151l"]) { $l1b[]=__("\120lease enter a v\141\154\151d email to c\157\156\164inue (or g\145\164\040an anon\171\155\157us tri\141\154\040licens\145\040key)","\154\155m"); } if (!$_POST["\155\141ps_marker_pro_t\157\163"]) { $l1b[]=__("Yo\165\040\155ust agree to\040\164\150e TOS to c\157\156tinue.","\154mm"); } if (empty($l1b)) { $qs="mod=\063\162d_party&task=a\160\151\046api_key=\065\060a2094314fbc82\145\06712b3f9b21f\060\060745&email=".urlencode(sanitize_email($_POST["\155aps_marker\137\160\162o_email"]))."&\146\151\162st_name=".urlencode(sanitize_text_field($_POST["\155aps_marker_pr\157\137\146irst_name"]))."&last_name\075".urlencode(sanitize_text_field($_POST["maps_marker_pro_la\163\164\137name"]))."&company_name=".urlencode(sanitize_text_field($_POST["maps\137\155\141rker_pro_fir\163\164\137name"]))."\04520".urlencode(sanitize_text_field($_POST["\155aps_marker_pro_l\141\163\164_name"]))."&username=".strtolower(sanitize_user($_POST["maps_marker_pro_la\163\164\137name"],TRUE).substr(sanitize_user($_POST["\155\141ps_marker_pr\157\137\146irst_name"],TRUE),0,1)); $O1b=$Oz->l1c("https://www.maps\155\141\162ker.com/sto\162\145\057api/inde\170\056php",$qs); if (strtolower(substr($O1b,0,021)) == "\143onnection error:") { $l1b[]=$O1b; } else if (strtolower(substr($O1b,0,5)) == "\145rror") { $l1b[]=$O1b; } else { $O1b=json_decode($O1b); update_option("leafletmaps\155\141\162kerpro_lice\156\163\145_key",$Oz->O12 =$O1b[0]); update_option("leafletmapsmark\145\162\160ro_license\137\154\157cal_key",""); update_option("leafle\164\155\141psmarkerpro_\154\151\143ense_key_tr\151\141\154",$Oz->O12 =$O1b[0]); $O1a=__("\131\157ur new license w\141\163\040registere\144\040\163uccessful\154\171\041","\154\155m"); } } } else { $l1b[]=__("Securit\171\040check failed \055\040\160lease ca\154\154\040this funct\151\157\156 from t\150\145\040accordi\156\147\040admin p\141\147\145!","lmm"); } } else if ( isset ($_POST["\155aps_ma\162\153\145r_pro_registe\162\137\146ree_anonym"])) { if (wp_verify_nonce($_POST["\155aps_ma\162\153\145r_pro_regis\164\145\162_free_a\156\157nym_form_no\156\143e"],"\155aps_marker_pro_re\147\151\163ter_free_ano\156\171\155_form_nonce")) { $Oz=new l10; $O1a=""; $l1b=array(); if (!$_POST["\155aps_marker_p\162\157\137tos"]) { $l1b[]=__("\131ou must agr\145\145\040to the \124\117\123 to cont\151\156\165e.","\154mm"); } if (empty($l1b)) { $qs="\155\157d=3rd_party&tas\153\075\141pi&api_key=\146\070b3782fef25\143\063\14668e809f6\062\061d193063"; $O1b=$Oz->l1c("\150\164tps://www.ma\160\163\155arker.com/\163\164\157re/api/in\144\145\170.php",$qs); if (strtolower(substr($O1b,0,021)) == "connection err\157\162\072") { $l1b[]=$O1b; } else if (strtolower(substr($O1b,0,5)) == "\145rror") { $l1b[]=$O1b; } else { $O1b=json_decode($O1b); update_option("\154eafletmapsma\162\153\145rpro_license\137\153\145y",$Oz->O12 =$O1b[0]); update_option("\154\145afletmapsmarke\162\160\162o_license_l\157\143\141l_key",""); update_option("leafletmapsmark\145\162\160ro_license\137\153\145y_trial",$Oz->O12 =$O1b[0]); $O1a=__("\131our new licen\163\145\040was regist\145\162\145d succes\163\146\165lly!","\154\155\155"); } } } else { $l1b[]=__("Security \143\150\145ck failed - \160\154\145ase call th\151\163\040function\040\146\162om the a\143\143\157rding ad\155\151\156 page!","\154mm"); } } else { $O1c=( isset ($_POST["\155aps_marke\162\137\160ro_license"]) && wp_verify_nonce($_POST["\155\141\160s_marker_pr\157\137\154icense"],"\155aps_marker_pro_l\151\143\145nse")); if ($O1c) { update_option("leafletmapsm\141\162\153erpro_licen\163\145\137local_key",""); update_option("leafletmap\163\155\141rkerpro_licen\163\145\137key",$_POST["\154eafletmapsma\162\153\145rpro_license\137\153\145y"]); } $Oz=Ov(TRUE); } include dirname( __FILE__)."/\154\145\141flet-license\056\160\150p"; return TRUE; } class l10 { public $l14; public $l1d; public $O12; public $O13; public $O1d; public $l1e; public $O10; public $l11; public $O11; public $O1e; public $l1f; public $l12; public $O1f; public $l1g; public $Ob; public $l15; public $O1g; public $l1h; function __construct() { $this->l14 =FALSE; $this->l1d =""; $this->O1d =0120; $this->l1e =012; $this->O1h =array("spbas"); $this->l1i ="\163pbas"; $this->O10 ="file\163\171\163tem"; $this->l12 =0; $this->O1f =0; $this->l11 =FALSE; $this->O11 =FALSE; $this->O1e =""; $this->l1f ="\154\151\143ense.txt"; $this->l1g =FALSE; $this->Ob =FALSE; $this->l1h =FALSE; $this->l15 =array("\143\165stom_fields" => array(),"\144\157\167nload_acces\163\137\145xpires" => 0,"license_e\170\160\151res" => 0,"\154\157cal_key_expire\163" => 0,"s\164\141\164us" => "Inv\141\154\151d",); $this->O1g =array("active" => __("Th\151\163\040license i\163\040\141ctive.","l\155\155"),"sus\160\145\156ded" => sprintf(__("\105\162ror: This lic\145\156\163e has been s\165\163\160ended. Th\151\163\040usually\040\150\141ppens wh\145\156\040someone\040\164ries to re\147\151\163ter a s\145\143\157nd tria\154\040license for\040\164he same do\155\141\151n. <a \150\162\145f=\042\045\061s\042\040\164arget=\042\137\142lank\042\076\120lease \143\154\151ck her\145\040to get a\040\156on-expiri\156\147 license \146\157r this do\155\141in.</a>","lmm"),"h\164\164\160s://www.mapsmar\153\145\162.com/orde\162"),"\145\170\160ired" => sprintf(__("\131our free 30 day t\162\151\141l license ke\171\040\150as expir\145\144\056 <a href=\042\0451s\042 tar\147\145\164=\042\137\142\154ank\042\076\120lease purc\150\141\163e a va\154\151\144 pro li\143\145\156se key\040\164o continue\074\057a>.","\154\155m"),"https://ww\167\056\155apsmarker.\143\157\155/order"),"p\145\156\144ing" => __("\105\162ror: This lic\145\156\163e is pendin\147\040\162eview.","\154\155\155"),"\144ownload_acces\163\137\145xpired" => __("Error\072\040\124his version\040\157\146 the so\146\164\167are was r\145\154eased after \171\157\165r downlo\141\144\040access\040\145xpired. Pl\145\141\163e rene\167\040\171our do\167\156\154oad and\040\163upport acc\145\163\163 or dow\156\147rade to a\040\160revious v\145\162sion.","\154\155\155"),"\155\151\163sing_license_\153\145\171" => __("P\154\145\141se enter a l\151\143\145nse key to \143\157ntinue.","lmm"),"\165nknown_local_key\137\164\171pe" => __("Erro\162\072\040An unknown\040\164\171pe of local\040\153ey validati\157\156\040was req\165\145\163ted.","\154mm"),"could_n\157\164\137obtain_local_\153\145\171" => sprintf(__("Error: a new lo\143\141\154 license ke\171\040\143ould not b\145\040\157btained.\040\120\154ease se\145\040%s for more\040\151nformation","lmm"),"<a href=\042\150\164tps://www.map\163\155\141rker.com/\143\157\156nect-error\163\042 target=\042\137\142lank\042>\155\141\160smarker\056\143om/connec\164\055\145rrors<\057\141\076"),"maximu\155\137\147race_period_\145\170\160ired" => __("Error\072\040The maximum loc\141\154\040license k\145\171\040grace per\151\157\144 has exp\151\162\145d.","\154mm"),"\154ocal_key_tam\160\145\162ing" => __("Error: The lo\143\141\154 license key \150\141\163 been tampe\162\145\144 with or i\163\040\151nvalid.","\154mm"),"\154\157cal_key_inva\154\151\144_for_locat\151\157\156" => __("\105\162\162or: The loc\141\154\040license ke\171\040\151s invali\144\040\146or this \154\157\143ation.","\154mm"),"\155\151ssing_licens\145\137\146ile" => __("\105\162ror: Please c\162\145\141te the follow\151\156\147 file (\141\156\144 directo\162\151\145s if th\145\171\040do no\164\040\145xist \141\154ready):<br\040\057>\134r\134\156\074br />\134\162\134n","lmm"),"\154\151\143ense_file_not_\167\162\151table" => __("\105rror: Please\040\155\141ke the foll\157\167\151ng path wr\151\164\141ble:<br />","lmm"),"\151\156\166alid_local_\153\145\171_storage" => __("\105\162ror: the loc\141\154\040key storage \157\156\040clear co\165\154\144 not deter\155\151\156ed.","\154\155m"),"\143ould_not_save_l\157\143\141l_key" => __("Error: the local l\151\143\145nse key co\165\154\144 not saved\056","lmm"),"license\137\153\145y_string_misma\164\143\150" => __("\105rror: The local k\145\171\040is invalid\040\146or this lic\145\156\163e.","\154\155m"),); $this->localization =array("activ\145" => __("This\040license is act\151\166\145.","\154\155\155"),"suspended" => sprintf(__("\105\162ror: This li\143\145\156se has been \163\165spended. Thi\163\040\165sually h\141\160\160ens when\040\163omeone tri\145\163\040to re\147\151\163ter a s\145\143ond tria\154\040license fo\162\040\164he sam\145\040domain. <a\040\150\162ef=\042\045\061s\042\040target=\042\137\142lank\042\076\120lease c\154\151ck here t\157\040get a non\055\145xpiring l\151\143ense for \164\150is domain\056\074/a>","lmm"),"\150ttps://www.mapsm\141\162\153er.com/orde\162"),"\145\170pired" => sprintf(__("\131our free 30 day\040\164rial license \153\145\171 has expir\145\144\056 <a href\075\042%1s\042 ta\162\147\145t=\042\137\142lank\042>\120\154\145ase pu\162\143\150ase a\040\166\141lid p\162\157\040licens\145\040\153ey to \143\157\156tinue</\141\076.","lmm"),"ht\164\160\163://www.map\163\155\141rker.com/or\144\145\162"),"pending" => __("Error: This lice\156\163\145 is pending\040\162\145view.","\154\155\155"),"downlo\141\144\137access_expir\145\144" => __("Error: This vers\151\157\156 of the so\146\164\167are was re\154\145\141sed afte\162\040\171our dow\156\154\157ad acce\163\163 expired. \120\154\145ase re\156\145\167 your \144\157\167nload a\156\144\040suppo\162\164\040access\040\157\162 downg\162\141\144e to a\040\160revious v\145\162sion.","\154\155m")); } function validate() { if (!$this->O12) { return $this->l14 =$this->O1g["\155issing_license\137\153\145y"]; } if (!in_array(strtolower($this->l1i),$this->O1h)) { return $this->l14 =$this->O1g["unknown_l\157\143\141l_key_type"]; } $this->O1i =$this->O1g["could_not_o\142\164\141in_local_ke\171"]; switch ($this->O10) { case "\144atabase": $l1j=$this->O1j(); break; case "\146ilesystem": $l1j=$this->l1k(); break; default : return $this->l14 =$this->O1g["missing_license_k\145\171"]; } if ($this->l14 == $this->O1i && $this->l12) { $O1k=$this->l1l($this->O1f); if ($O1k["\167\162\151te"]) { if ($this->O10 == "databas\145") { $this->O1l($O1k["\154ocal_key"]); } elseif ($this->O10 == "\146ilesystem") { $this->l1m($O1k["local_key"],"{$this->O1e}{$this->l1f}"); } } if ($O1k["e\162\162\157rs"]) { return $this->l14 =$O1k["\145rrors"]; } $this->l14 =FALSE; return $this; } if ($this->l14) { return $this->l14; } return $this->O1m($l1j); } function l1n($O1n,$O1k) { return (( integer) $O1n+(( integer) $O1k*0250600)); } function l1l($l1j) { $l1o=$this->O1o($l1j); $l1p=$this->O1p($l1o); $l15=unserialize($l1p[0]); $O1n=( integer) $l15["local_ke\171_expires"]; unset ($l1p,$l15); $l1q=FALSE; $l1p=explode("\012\012",$l1j); $l1j=$l1p[0]; foreach ($l12=explode("\054",$this->l12) as $O1q => $O1k) { if (!$O1q) { $l1j.="\012"; } if ($this->l1n($O1n,$O1k)>time()) { continue; } $l1j.= "\012{$O1k}"; $l1q=TRUE; } if (time()>$this->l1n($O1n,array_pop($l12))) { return array("write" => FALSE,"\154\157cal_key" => "","errors" => $this->O1g["\155\141ximum_grace_\160\145\162iod_expire\144"]); } return array("\167\162ite" => $l1q,"\154ocal_key" => $l1j,"errors" => FALSE); } function l1r($l1j,$O1n) { $O1k=$this->O1p($l1j,"\012\012"); if (! isset ($O1k[1])) { return -1; } return ( integer)($this->l1n($O1n,array_pop(explode("\012",$O1k[1])))-time()); } function O1o($l1j) { return base64_decode(str_replace("\012","",urldecode($l1j))); } function O1p($l1j,$O1r="\173spbas}") { return explode($O1r,$l1j); } function l1s($O1q,$O1s) { return in_array($O1q,(array) $O1s); } function wildcard_ip($O1q) { $octets=explode("\056",$O1q); array_pop($octets); $ip_range[]=implode(".",$octets)."\056\052"; array_pop($octets); $ip_range[]=implode("\056",$octets)."\056*"; array_pop($octets); $ip_range[]=implode("\056",$octets).".*"; return $ip_range; } function wildcard_domain($O1q) { return "*.".str_replace("\167ww\056","",$O1q); } function wildcard_server_hostname($O1q) { $hostname=explode(".",$O1q); unset ($hostname[0]); $hostname=(! isset ($hostname[1])) ? array($O1q): $hostname; return "\052\056".implode(".",$hostname); } function extract_access_set($instances,$enforce) { foreach ($instances as $O1q => $instance) { if ($O1q != $enforce) { continue; } return $instance; } return array(); } function O1m($l1j) { $l1o=$this->O1o($l1j); $l1p=$this->O1p($l1o); if (! isset ($l1p[1])) { return $this->l14 =$this->O1g["local_key\137\164\141mpering"]; } if (md5($this->l13.$l1p[0]) != $l1p[1]) { return $this->l14 =$this->O1g["lo\143\141\154_key_tamperi\156\147"]; } $l15=unserialize($l1p[0]); $instance=$l15["\151\156stance"]; unset ($l15["\151nstance"]); $enforce=$l15["\145nforce"]; unset ($l15["enforce"]); $this->l15 =$l15; if (( string) $l15["license_key_s\164\162ing"] != ( string) $this->O12) { return $this->l14 =$this->O1g["\154icense_key_s\164\162\151ng_mismatch"]; } if (( string) $l15["status"] != "\141ctive") { return $this->l14 =$this->O1g[$l15["\163tatus"]]; } if (( string) $l15["licens\145\137\145xpires"] != "never" && ( integer) $l15["license_expi\162\145\163"]<time()) { return $this->l14 =$this->O1g["\145\170pired"]; } if (( string) $l15["lo\143\141\154_key_expires"] != "\156\145\166er" && ( integer) $l15["\154\157cal_key_expires"]<time()) { if ($this->l1r($l1j,$l15["local_key_expires"])<0) { $this->l1t(TRUE); return $this->validate(); } } if ($this->l1g && ( integer) $l15["\144ownload_acc\145\163\163_expires"]<strtotime($this->Ob)) { return $this->l14 =$this->O1g["\144ownload_acce\163\163\137expired"]; } $conflicts=array(); $O1t=$this->l1u(); foreach ((array) $enforce as $O1q) { $O1s=$this->extract_access_set($instance,$O1q); if (!$this->l1s($O1t[$O1q],$O1s)) { $conflicts[$O1q]=TRUE; if (in_array($O1q,array("\151p","\163\145rver_ip"))) { foreach ($this->wildcard_ip($O1t[$O1q]) as $ip) { if ($this->l1s($ip,$O1s)) { unset ($conflicts[$O1q]); break; } } } elseif (in_array($O1q,array("\144omain"))) { if ($this->l1s($this->wildcard_domain($O1t[$O1q]),$O1s)) { unset ($conflicts[$O1q]); } } elseif (in_array($O1q,array("s\145\162\166er_hostname"))) { if ($this->l1s($this->wildcard_server_hostname($O1t[$O1q]),$O1s)) { unset ($conflicts[$O1q]); } } } } if (!empty($conflicts)) { return $this->l14 =$this->O1g["\154ocal_key_inva\154\151\144_for_locati\157\156"]; } } function O1j() { $Of=array(); if (is_array($this->l11)) { $Of=$this->l11; } else { $query=@mysqli_query($this->l11); if ($mysql_error=mysqli_error()) { return $this->l14 = "Error: {$mysql_error}"; } $Of=@mysqli_fetch_assoc($query); if ($mysql_error=mysqli_error()) { return $this->l14 = "Erro\162\072 {$mysql_error}"; } } if (!$Of["local_key"]) { $Of["\154\157cal_key"]=$this->O1u(); if ($this->l14) { return $this->l14; } $this->O1l($Of["l\157\143\141l_key"]); } return $this->O1f =$Of["local_key"]; } function O1l($l1j) { if (is_array($this->O11)) { $l1v=$this->O11["fun\143tion"]; return $l1v($this->O11["ke\171"],$l1j); }@mysqli_query(str_replace("\173local_key}",$l1j,$this->O11)); if ($mysql_error=mysqli_error()) { return $this->l14 = "Error: {$mysql_error}"; } return TRUE; } function l1k() { if (!file_exists($path= "{$this->O1e}{$this->l1f}")) { return $this->l14 =$this->O1g["\155issing_licens\145\137\146ile"].$path; } if (!is_writable($path)) { return $this->l14 =$this->O1g["lice\156\163\145_file_not_wr\151\164\141ble"].$path; } if (!$l1j=@file_get_contents($path)) { $l1j=$this->O1u(); if ($this->l14) { return $this->l14; } $this->l1m(urldecode($l1j),$path); } return $this->O1f =$l1j; } function l1t($clear=FALSE) { switch (strtolower($this->O10)) { case "\144\141tabase": $this->O1l(""); break; case "filesystem": $this->l1m("","{$this->O1e}{$this->l1f}"); break; default : return $this->l14 =$this->O1g["invalid_lo\143\141\154_key_stora\147\145"]; } } function l1m($l1j,$path) { $fp=@fopen($path,"w"); if (!$fp) { return $this->l14 =$this->O1g["could_not_save_loc\141\154\137key"]; }@fwrite($fp,$l1j); @fclose($fp); return TRUE; } function O1u() { $querystring= "\155od=license&\164\141\163k=SPBAS_val\151\144\141te_lic\145\156\163e&license\137\153\145y={$this->O12}&"; $querystring.=$this->build_querystring($this->l1u()); if ($this->l14) { return FALSE; } $Of=$this->l1c($this->O13 ,$querystring); if (strtolower(substr($Of,0,021)) == "connecti\157\156\040error\072") { $this->l1d =$Of; return FALSE; } if (!$Of) { $this->l14 =$this->O1g["could_not_obta\151\156\137local_\153\145\171"]; return FALSE; } if (substr($Of,0,7) == "Invalid") { $this->l14 =str_replace("Invalid","\105rror",$Of); return FALSE; } if (substr($Of,0,5) == "\105rror") { $this->l14 =$Of; return FALSE; } return $Of; } function build_querystring($array) { $buffer=""; foreach ((array) $array as $O1q => $value) { if ($buffer) { $buffer.="\046"; } $buffer.= "{$O1q}\075{$value}"; } return $buffer; } function l1u() { $O1t=array(); $O1t["\144omain"]=""; $O1t["ip"]="\151\160-not-transmit\164\145\144"; $O1t["directory"]="\144\151rectory-not\055\164\162ansmitte\144"; $O1t["server_hostname"]="s\145\162\166er_hostname-\156\157\164-transmitted"; $O1t["\163erver_ip"]="server_ip\055\156\157t-transmit\164\145\144"; $O1t["\166\141lid_for_produ\143\164\137tiers"]=""; if (!defined( "HHVM_VERSION")) { if (!extension_loaded("suho\163\151\156")) { if (!defined( "SUHOSIN_PATCH")) { if (function_exists("phpinfo")) { ob_start(); phpinfo(INFO_GENERAL); phpinfo(INFO_ENVIRONMENT); $phpinfo=ob_get_contents(); ob_end_clean(); $list=strip_tags($phpinfo); $O1t["domain"]=$this->scrape_phpinfo($list,"HTTP_HOST"); } } } } $O1t["\144omain"]=($O1t["domain"]) ? $O1t["d\157\155\141in"]: $_SERVER["HTTP_H\117\123\124"]; foreach ($O1t as $O1q => $value) { if ($O1q == "valid_for\137\160\162oduct_tier\163") { continue; } $O1t[$O1q]=($O1t[$O1q]) ? $O1t[$O1q]: "Unknow\156"; } if ($this->l1h) { $O1t["valid_for\137\160\162oduct_tiers"]=$this->l1h; } if ( isset ($_POST["\154eafletmapsmarker\160\162\157_domain_to_\141\143\164ivate"])) { if (parse_url($_POST["\154eafletmapsma\162\153\145rpro_domain_t\157\137\141ctivate"],PHP_URL_HOST) != NULL) { $O1t["\144omain"]=parse_url($_POST["leafl\145\164\155apsmarkerpr\157\137domain_to_activ\141\164\145"],PHP_URL_HOST); } else { $O1v="\057^(([0-9]|[1-9][0\055\071\135|1[0-9]\173\062\175|2[0-4][0-9\135\174\0625[0-5]\051\134.)\1733}([\060\0559]|[1-9][\060\0559]|1[0-9]\173\062}|2[0-4][\060\0559]|25[0-5\135\051\044/"; $l1w="\057\136\050([a-zA-Z0-9\135\174\133a-zA-Z0-9][\141\055\172A-Z0-9\134\055\135*[a-zA-Z0-9]\051\134\056)*([A-Z\141\055z0-9]|[A-Za\055\1720-9][A-Za-\172\060\0559\134\055\135*[A-Za-z\060\0559])\044/"; $O1w=trim($_POST["\154eafletmapsma\162\153\145rpro_domai\156\137\164o_activat\145"]); if ((preg_match($O1v,$O1w) == TRUE) || (preg_match($l1w,$O1w) == TRUE)) { $O1t["domain"]=trim($_POST["\154eaflet\155\141\160smarkerpro_\144\157\155ain_to_act\151\166\141te"]); } else if (trim($_POST["\154eafletmapsmark\145\162\160ro_domain_to\137\141\143tivate"]) == "localhost") { $O1t["\144omain"]="\154\157\143alhost"; } } } return $O1t; } function path_translated() { $option=array("\120ATH_TRANSL\101\124\105D","\174|IG_PATH_TRANS\114\101\124ED","\123CRIPT_FILENAME","\104OCUMENT_ROOT","\101\120PL_PHYSICAL_P\101\124\110"); foreach ($option as $O1q) { if (! isset ($_SERVER[$O1q]) || strlen(trim($_SERVER[$O1q]))<=0) { continue; } if ($this->is_windows() && strpos($_SERVER[$O1q],"\134")) { return @substr($_SERVER[$O1q],0,@strrpos($_SERVER[$O1q],"\134")); } return @substr($_SERVER[$O1q],0,@strrpos($_SERVER[$O1q],"/")); } return FALSE; } function server_addr() { $options=array("SERVER_ADDR","\114OCAL_ADDR"); foreach ($options as $O1q) { if ( isset ($_SERVER[$O1q])) { return $_SERVER[$O1q]; } } return FALSE; } function scrape_phpinfo($all,$target) { $all=explode($target,$all); if (count($all)<2) { return FALSE; } $all=explode("\012",$all[1]); $all=trim($all[0]); if ($target == "\123ystem") { $all=explode(" ",$all); $all=trim($all[(strtolower($all[0]) == "\167indows" && strtolower($all[1]) == "nt") ? 2: 1]); } if ($target == "SCRIPT_FILENAME") { $slash=($this->is_windows() ? "\134": "\057"); $all=explode($slash,$all); array_pop($all); $all=implode($slash,$all); } if (substr($all,1,1) == "\135") { return FALSE; } return $all; } function l1c($url,$querystring) { $Of=wp_remote_get($url."\077".$querystring,array("sslverify" => TRUE,"timeout" => 031)); if (is_wp_error($Of) || ( isset ($Of["\162esponse"]["code"]) && ( integer) $Of["response"]["code"] != 0310)) { $Of=wp_remote_get($url."\077".$querystring,array("ssl\166\145rify" => FALSE,"timeout" => 031)); } if (is_wp_error($Of) || ( isset ($Of["r\145\163\160onse"]["\143ode"]) && ( integer) $Of["r\145\163\160onse"]["\143ode"] != 0310)) { $url="\150\164tps://www.m\141\160\163markerpro.co\155\057\160roxy.php?".$querystring; $Of=wp_remote_get($url."?".$querystring,array("\163slverif\171" => FALSE,"\164\151meout" => 031)); } if (is_wp_error($Of)) { $l1x="\103\157nnection error\072\040".$Of->get_error_message()."<br/>".sprintf(__("\105\162\162or: a new lo\143\141\154 license ke\171\040\143ould not\040\142\145 obtaine\144\056\040Please \163\145\145 %s for\040\155ore inf\157\162\155ation","\154mm"),"<a href\075\042\150ttps://www\056\155\141psmarker\056\143\157m/conne\143\164\055errors\042\040\164arget=\042\137\142lan\153\042>mapsmarker\056\143om/connec\164\055errors</a>"); return $l1x; } else { if (( integer) $Of["respons\145"]["\143\157\144e"] == 0310) { return $Of["\142\157dy"]; } else { $l1x="\103\157\156nection err\157\162\072 HTTP stat\165\163\040code ".$Of["response"]["\143\157\144e"]." - ".$Of["\142\157\144y"]; return $l1x; } } } function is_windows() { $O1x=explode(",",ini_get("\144isable_functio\156\163")); foreach ($O1x as $l1y) { $O1y[]=trim($l1y); } if (!in_array("\160\150\160_uname",$O1y)) { return (strtolower(substr(php_uname(),0,7)) == "windows"); } else { return (stristr( PHP_OS ,"WIN")); } } function pr($stack,$l1z=TRUE) { $formatted="<pre>".var_export((array) $stack,1)."\074/pre>"; if ($l1z) { exit ($formatted); } return $formatted; } } $O1z=new l4(); if (is_admin()) { if (lb()) { $l20="\167\167\167.mapsmarke\162\056com/updates_pro\057\077action=get_m\145\164\141data&slug=\154\145\141flet-map\163\055\155arker-p\162\157"; $O4=get_option("\154eafletmapsmar\153\145\162_options"); if (( isset ($O4["misc_betatest"])) && ($O4["mis\143\137\142etatest"] == "enabl\145\144")) { $l20=$l20."\055\142eta"; } $O20=mmppuc_v4_factory::buildupdatechecker($l20,plugin_dir_path( __FILE__)."\154\145aflet-maps-marke\162\056\160hp","leaf\154\145\164-maps-marker-p\162\157","\062\064","leafletm\141\160\163markerpro_plu\147\151\156updatechecke\162"); unset ($O20); } } if (defined( "WPCF7_VERSION")) { add_action("wpcf7_form_action_\165\162\154","\154mm_make_cf7_fo\162\155\137action_empty"); function lmm_make_cf7_form_action_empty($url) { return "\043"; } } unset ($O1z);