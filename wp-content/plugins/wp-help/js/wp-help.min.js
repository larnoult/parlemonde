(function(){var a=[].slice;jQuery(function(b){var c,d,e;return e=void 0,function(){var f,g;g=[],f=void 0,void 0,e={start:function(a){var c;return null==a&&(a=0),c=b.Deferred(),d.loading.show(),setTimeout(function(){return c.resolve()},a),c.promise()},stop:function(){return f&&f.reject(),f=null,g=[],d.loading.hide()},until:function(){var d,e,h;return h=arguments[0],e=2<=arguments.length?a.call(arguments,1):[],null==h&&(h=0),f=f||b.Deferred().always(c.load.stop),d=g.push(!1)-1,e.push(c.load.start(h)),b.when.apply(b,e).always(function(){if(g[d]=!0,-1===b.inArray(!1,g))return f.resolve()}),f.promise()}}}(),c={p:function(a){return b("#cws-wp-help-"+a)},load:e,bindH2Updates:function(){return d.menu=b("#adminmenu a.current .wp-menu-name"),d.menu.length||(d.menu=b("#adminmenu a.current")),d.menu.text(d.h2.edit.input.val()),d.h2.edit.input.bind("keyup",function(){return d.menu.text(b(this).val())})},sortable:function(){return b(this).sortable({opacity:.8,placeholder:"cws-wp-help-placeholder",axis:"y",cursor:"move",cursorAt:{left:0,top:0},distance:10,delay:50,handle:".sort-handle",items:"> li.cws-wp-help-local, > div#cws-wp-help-remote-docs-block",start:function(a,c){var d,e,f;return d=b(c.item),f=b(".cws-wp-help-placeholder"),e=void 0,e="cws-wp-help-remote-docs-block"===d.attr("id")?4:-2,f.height(d.height()+e)},update:function(a,e){var f;return f=b.post(ajaxurl,{action:"cws_wp_help_reorder",_ajax_nonce:d.ul.data("nonce"),order:b(this).sortable("toArray")}),c.load.until(200,f)}}),b(this).find("> li:not(.cws-wp-help-is-slurped) > ul > li:nth-child(2)").parent("ul").each(c.sortable)},sortableInit:function(){return d.ul.find("> #cws-wp-help-remote-docs-block > li").unwrap(),d.ul.find("> li.cws-wp-help-is-slurped:first").before('<div id="cws-wp-help-remote-docs-block"></div>'),d.ul.find("> li.cws-wp-help-is-slurped").detach().appendTo("#cws-wp-help-remote-docs-block"),d.ulSortable.each(c.sortable)},init:function(){return c.sortableInit(),d.ul.find("li.page_item").each(function(){return b(this).attr("id","page-"+b(this).attr("class").match(/page-item-([0-9]+)/)[1])}),d.apiURL.click(function(){return this.select()}),d.saveButton.click(function(){return c.saveSettings()}),d.cancelLink.click(function(a){return a.preventDefault(),c.restoreSettings(),c.hideSettings()}),d.settingsButton.click(function(a){return a.preventDefault(),c.revealSettings(!0)}),d.h2.display.text.dblclick(function(){return c.revealSettings(),d.h2.edit.input.focus().select()}),d.h3.display.text.dblclick(function(){return c.revealSettings(),d.h3.edit.input.focus().select()}),d.returnMonitor.bind("keydown",function(a){if(13===a.which)return b(this).blur(),c.saveSettings()}),c.bindH2Updates(),d.menuLocation.change(function(){var a,e,f;return e=String(window.location),e=-1===d.menuLocation.val().indexOf("submenu")?e.replace("/index.php","/admin.php"):e.replace("/admin.php","/index.php"),f=String(e)+"&wp-help-preview-menu-location="+d.menuLocation.val(),a=String(e).replace(/\/wp-admin\/.*$/,"/wp-admin/js/common.js"),b("#adminmenu").load(f+" #adminmenu",function(){return window.history.replaceState&&window.history.replaceState(null,null,e),b.getScript(a),c.bindH2Updates()})})},fadeOutIn:function(a,b){return a.fadeOut(150,function(){return b.fadeIn(150)})},hideShow:function(a,b){return a.hide(),b.show()},revealSettings:function(a){var b,e,f,g;for(g=[d.h2,d.h3],e=0,f=g.length;e<f;e++)b=g[e],c.hideShow(b.display.wrap,b.edit.wrap);if(d.actions.fadeTo(200,.3),d.ul.fadeTo(200,.3),c.fadeOutIn(d.doc,d.settings),a)return d.h2.edit.input.focus().select()},restoreSettings:function(){return b("input, select",d.settings).each(function(){var a;if(a=b(this),a.data("original-value"))return a.val(a.data("original-value")).change()})},saveSettings:function(){var a;return c.clearError(),b([d.h2,d.h3]).each(function(){return this.display.text.text(this.edit.input.val())}),a=b.post(ajaxurl,{action:"cws_wp_help_settings",_ajax_nonce:b("#_cws_wp_help_nonce").val(),h2:d.h2.edit.input.val(),h3:d.h3.edit.input.val(),menu_location:d.menuLocation.val(),slurp_url:d.slurp.val()}),a.success(function(a){if(a=b.parseJSON(a),d.slurp.val(a.slurp_url),a.error?(c.error(a.error),d.slurp.focus()):c.hideSettings(),a.topics)return c.p("nodocs").remove(),d.ul.html(a.topics),c.sortableInit()}),c.load.until(200,a)},hideSettings:function(){var a,b,e,f;for(f=[d.h2,d.h3],b=0,e=f.length;b<e;b++)a=f[b],c.hideShow(a.edit.wrap,a.display.wrap);return d.actions.fadeTo(200,1),d.ul.fadeTo(200,1),c.fadeOutIn(d.settings,d.doc)},clearError:function(){return d.slurpError.html("").hide()},error:function(a){return d.slurpError.html("<p>"+a+"</p>").fadeIn(150)}},d={menu:function(){return b("#adminmenu a.current")},h2:{edit:{input:c.p("h2-label"),wrap:c.p("h2-label-wrap")},display:{text:b(".wrap h1:first"),wrap:b(".wrap h1:first")}},h3:{edit:{input:c.p("listing-label"),wrap:c.p("listing-labels")},display:{text:c.p("listing h3"),wrap:c.p("listing h3")}},settingsButton:c.p("settings-on"),doc:c.p("document"),ul:c.p("listing-wrap > ul"),ulSortable:c.p("listing-wrap > ul.can-sort"),actions:c.p("actions"),settings:c.p("settings"),listing:c.p("listing"),apiURL:c.p("api-url"),slurp:c.p("slurp-url"),slurpError:c.p("slurp-error"),saveButton:c.p("settings-save"),cancelLink:c.p("settings-cancel"),menuLocation:c.p("menu-location"),loading:c.p("loading"),returnMonitor:b('.wrap input[type="text"]')},c.init()})}).call(this);
//# sourceMappingURL=wp-help.min.js.map