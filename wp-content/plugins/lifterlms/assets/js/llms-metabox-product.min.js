!function(c){window.llms=window.llms||{},window.llms.metabox_product=function(){this.temp_id=Math.floor(7777*Math.random()+777),this.init=function(){this.bind_visibility();var e=c("#lifterlms-product #llms-product-options-access-plans");if(e.length){LLMS.Spinner.start(e);var l,t=this,a=0;l=setInterval(function(){if(300<=a)e.html(LLMS.l10n.translate("There was an error loading the necessary resources. Please try again."));else{if("undefined"==typeof tinyMCE)return void a++;t.bind()}clearInterval(l),LLMS.Spinner.stop(e)},100)}},this.bind=function(){var t=this;c("#llms-save-access-plans").on("click",function(){c("#publish").trigger("click")}),c("#llms-access-plans").on("change","[data-controller-id]",function(){t.controller_change(c(this))}),c("#llms-access-plans .llms-access-plan-datepicker").datepicker({dateFormat:"mm/dd/yy"}),c("#llms-access-plans [data-controller-id]").trigger("change"),c("#llms-new-access-plan").on("click",function(){var e=c(this);t.init_plan(),e.attr("disabled","disabled"),setTimeout(function(){e.removeAttr("disabled")},500)}),c("#llms-access-plans").sortable({handle:".llms-drag-handle",items:".llms-access-plan",start:function(e,l){c("#llms-access-plans").addClass("dragging")},stop:function(e,l){c("#llms-access-plans").removeClass("dragging"),t.update_plan_orders()}}),c("#llms-access-plans").on("keyup","input.llms-plan-title",function(){var e=c(this),l=e.closest(".llms-access-plan").find("span.llms-plan-title"),t=e.val(),a=t||l.attr("data-default");l.text(a)}),c("#llms-access-plans").on("click",".llms-plan-delete",function(e){e.stopPropagation(),t.delete_plan(c(this))}),window.llms.metaboxes.post_select(c("#llms-access-plans .llms-availability-restrictions")),c("#_llms_plans_content_llms-new-access-plan-model").attr("disabled","disabled"),tinyMCE.EditorManager.execCommand("mceRemoveEditor",!0,"_llms_plans_content_llms-new-access-plan-model"),c("#publish").on("click",function(e){c("#llms-access-plans input").each(function(){if(c(this).is(":invalid")){var e=c(this).closest(".llms-access-plan");return e.hasClass("opened")||e.find(".llms-collapsible-header").trigger("click"),!1}})})},this.bind_visibility=function(){var l=c("#llms-catalog-visibility-select"),t=c("a.llms-edit-catalog-visibility"),e=c("a.llms-save-catalog-visibility"),a=c("a.llms-cancel-catalog-visibility");t.on("click",function(e){e.preventDefault(),l.slideDown("fast"),t.hide()}),e.on("click",function(e){e.preventDefault(),l.slideUp("fast"),t.show(),c("#llms-catalog-visibility-display").text(c('input[name="_llms_visibility"]:checked').attr("data-label"))}),a.on("click",function(e){e.preventDefault(),l.slideUp("fast"),t.show()})},this.delete_plan=function(e){var l=this,t=e.closest(".llms-access-plan"),a=t.attr("data-id");a?c("#llms-delete-plan-modal").topModal({open:function(){c("#llms-confirm-delete-plan").on("click",function(){LLMS.Spinner.start(t,"small"),c("#llms-delete-plan-modal .topModalClose").trigger("click"),window.LLMS.Ajax.call({data:{action:"delete_access_plan",plan_id:a},success:function(e){LLMS.Spinner.stop(t),e.success?l.remove_plan_el(t):e.message&&alert(e.message)}})})},closed:function(){c("#llms-delete-plan-modal").attr("data-plan-id",""),c("#llms-confirm-delete-plan").off("click")}}).attr("data-plan-id",a):l.remove_plan_el(t)},this.controller_change=function(e){var l=e.attr("data-controller-id"),i=e.val(),t=e.closest(".llms-access-plan").find('[data-controller="'+l+'"]');"checkbox"===e.attr("type")&&(i=e.is(":checked")?i:"no"),t.each(function(){var e,l,t=c(this),a="SELECT"===t[0].nodeName||"INPUT"===t[0].nodeName||"TEXTAREA"===t[0].nodeName?t:t.find("input, select, textarea"),s=t.attr("data-value-is"),n=t.attr("data-value-is-not");switch(void 0!==s&&!1!==s?l="==":void 0!==n&&!1!==n&&(l="!="),l){case"==":e=i==s?"show":"hide";break;case"!=":e=i!=n?"show":"hide"}"show"===e?(t.show(),a.removeAttr("disabled").trigger("change")):"hide"===e&&(t.hide(),a.attr("disabled","disabled"))})},this.has_plan_limit_been_reached=function(){return window.llms.product.access_plan_limit<=c("#llms-access-plans .llms-access-plan").length},this.init_plan=function(){if(!this.has_plan_limit_been_reached()){var e=c("#llms-new-access-plan-model").clone();$existing_plans=c("#llms-access-plans .llms-access-plan"),$editor=e.find("#_llms_plans_content_llms-new-access-plan-model"),e.removeAttr("id"),$editor.removeAttr("id").attr("id","_llms_plans_content_"+this.temp_id),this.temp_id++,e.find("select, input, textarea").each(function(){c(this).removeAttr("disabled")}),e.find(".llms-access-plan-datepicker").datepicker({dateFormat:"mm/dd/yy"}),e.appendTo("#llms-access-plans"),this.update_plan_orders(),e.find(".llms-collapsible-header").trigger("click"),this.has_plan_limit_been_reached()&&this.toggle_create_button("disable"),window.llms.metaboxes.post_select(e.find(".llms-availability-restrictions")),e.find("[data-controller-id]").trigger("change"),c(document).trigger("llms-plan-init",e)}},this.toggle_create_button=function(e){var l=c("#llms-new-access-plan"),t=l.next("p");"disable"===e?(l.attr("disabled","disabled"),t.show()):(l.removeAttr("disabled"),t.hide())},this.remove_plan_el=function(e){var l=this;e.fadeOut(400),setTimeout(function(){e.remove(),l.has_plan_limit_been_reached()||l.toggle_create_button("enable")},450)},this.update_plan_orders=function(){c("#llms-access-plans .llms-access-plan").each(function(){var e=c(this),l=e.find(".plan-order"),t=e.find('textarea[id^="_llms_plans_content_"]').attr("id"),a=1*l.val(),s=e.index();tinyMCE.EditorManager.execCommand("mceRemoveEditor",!0,t),e.find("select, input, textarea").each(function(){var e=c(this).attr("name");e&&c(this).attr("name",e.replace(a,s))}),tinyMCE.EditorManager.execCommand("mceAddEditor",!0,t),l.val(s)})},this.init()};new window.llms.metabox_product}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxsbXMtbWV0YWJveC1wcm9kdWN0LmpzIl0sIm5hbWVzIjpbIiQiLCJ3aW5kb3ciLCJsbG1zIiwibWV0YWJveF9wcm9kdWN0IiwidGhpcyIsInRlbXBfaWQiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJpbml0IiwiYmluZF92aXNpYmlsaXR5IiwiJG1iIiwibGVuZ3RoIiwiTExNUyIsIlNwaW5uZXIiLCJzdGFydCIsImludGVydmFsIiwic2VsZiIsImNvdW50ZXIiLCJzZXRJbnRlcnZhbCIsImh0bWwiLCJsMTBuIiwidHJhbnNsYXRlIiwidGlueU1DRSIsImJpbmQiLCJjbGVhckludGVydmFsIiwic3RvcCIsIm9uIiwidHJpZ2dlciIsImNvbnRyb2xsZXJfY2hhbmdlIiwiZGF0ZXBpY2tlciIsImRhdGVGb3JtYXQiLCIkZWwiLCJpbml0X3BsYW4iLCJhdHRyIiwic2V0VGltZW91dCIsInJlbW92ZUF0dHIiLCJzb3J0YWJsZSIsImhhbmRsZSIsIml0ZW1zIiwiZXZlbnQiLCJ1aSIsImFkZENsYXNzIiwicmVtb3ZlQ2xhc3MiLCJ1cGRhdGVfcGxhbl9vcmRlcnMiLCIkaW5wdXQiLCIkZGlzcGxheSIsImNsb3Nlc3QiLCJmaW5kIiwidmFsIiwidGl0bGUiLCJ0ZXh0IiwiZSIsInN0b3BQcm9wYWdhdGlvbiIsImRlbGV0ZV9wbGFuIiwibWV0YWJveGVzIiwicG9zdF9zZWxlY3QiLCJFZGl0b3JNYW5hZ2VyIiwiZXhlY0NvbW1hbmQiLCJlYWNoIiwiaXMiLCIkcGxhbiIsImhhc0NsYXNzIiwiJHJhZGlvcyIsIiR0b2dnbGUiLCIkc2F2ZSIsIiRjYW5jZWwiLCJwcmV2ZW50RGVmYXVsdCIsInNsaWRlRG93biIsImhpZGUiLCJzbGlkZVVwIiwic2hvdyIsIiRidG4iLCJwbGFuX2lkIiwidG9wTW9kYWwiLCJvcGVuIiwiQWpheCIsImNhbGwiLCJkYXRhIiwiYWN0aW9uIiwic3VjY2VzcyIsInIiLCJyZW1vdmVfcGxhbl9lbCIsIm1lc3NhZ2UiLCJhbGVydCIsImNsb3NlZCIsIm9mZiIsImlkIiwiJGNvbnRyb2xzIiwib3BlcmF0b3IiLCIkYyIsIiRlbHMiLCJub2RlTmFtZSIsImVxdWFscyIsIm5vdF9lcXVhbHMiLCJoYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQiLCJwcm9kdWN0IiwiYWNjZXNzX3BsYW5fbGltaXQiLCIkY2xvbmUiLCJjbG9uZSIsIiRleGlzdGluZ19wbGFucyIsIiRlZGl0b3IiLCJhcHBlbmRUbyIsInRvZ2dsZV9jcmVhdGVfYnV0dG9uIiwiZG9jdW1lbnQiLCJzdGF0dXMiLCIkbXNnIiwibmV4dCIsImZhZGVPdXQiLCJyZW1vdmUiLCIkcCIsIiRvcmRlciIsImVkaXRvcl9pZCIsIm9yaWciLCJjdXJyIiwiaW5kZXgiLCJuYW1lIiwicmVwbGFjZSIsImpRdWVyeSJdLCJtYXBwaW5ncyI6IkNBTUEsU0FBWUEsR0FFWEMsT0FBT0MsS0FBT0QsT0FBT0MsTUFBUSxHQUU3QkQsT0FBT0MsS0FBS0MsZ0JBQWtCLFdBTzdCQyxLQUFLQyxRQUFVQyxLQUFLQyxNQUF5QixLQUFoQkQsS0FBS0UsU0FBb0IsS0FTdERKLEtBQUtLLEtBQU8sV0FFWEwsS0FBS00sa0JBRUwsSUFBSUMsRUFBTVgsRUFBRyx5REFFYixHQUFPVyxFQUFJQyxPQUFYLENBSUFDLEtBQUtDLFFBQVFDLE1BQU9KLEdBSXBCLElBRUNLLEVBRkdDLEVBQU9iLEtBQ1ZjLEVBQVUsRUFHWEYsRUFBV0csWUFBYSxXQUd2QixHQUFnQixLQUFYRCxFQUVKUCxFQUFJUyxLQUFNUCxLQUFLUSxLQUFLQyxVQUFXLDhFQUkzQixDQUFBLEdBQUssb0JBQXVCQyxRQUdoQyxZQURBTCxJQU9BRCxFQUFLTyxPQUlOQyxjQUFlVCxHQUNmSCxLQUFLQyxRQUFRWSxLQUFNZixJQUVqQixPQVdKUCxLQUFLb0IsS0FBTyxXQUVYLElBQUlQLEVBQU9iLEtBSVhKLEVBQUcsMkJBQTRCMkIsR0FBSSxRQUFTLFdBQzNDM0IsRUFBRyxZQUFhNEIsUUFBUyxXQUkxQjVCLEVBQUcsc0JBQXVCMkIsR0FBSSxTQUFVLHVC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QXNCLEVBQWZGLEVBQU85RCxNQUNkaUUsRUFBT0osRUFBR0ssUUFHWDVGLFFBQVFrQyxjQUFjQyxZQUFhLG1CQUFtQixFQUFNc0QsR0FHNURGLEVBQUc5RCxLQUFNLDJCQUE0QlcsS0FBTSxXQUUxQyxJQUFJeUQsRUFBT3BILEVBQUdJLE1BQU84QixLQUFNLFFBQ3RCa0YsR0FDSnBILEVBQUdJLE1BQU84QixLQUFNLE9BQVFrRixFQUFLQyxRQUFTSixFQUFNQyxNQU05QzNGLFFBQVFrQyxjQUFjQyxZQUFhLGdCQUFnQixFQUFNc0QsR0FFekRELEVBQU85RCxJQUFLaUUsTUFPZDlHLEtBQUtLLFFBSUUsSUFBSVIsT0FBT0MsS0FBS0MsZ0JBMWdCekIsQ0E0Z0JLbUgiLCJmaWxlIjoibGxtcy1tZXRhYm94LXByb2R1Y3QubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQcm9kdWN0IE9wdGlvbnMgTWV0YUJveFxuICogRGlzcGxheXMgb24gQ291cnNlICYgTWVtYmVyc2hpcCBQb3N0IFR5cGVzXG4gKiBAc2luY2UgICAgMy4wLjBcbiAqIEB2ZXJzaW9uICAzLjIzLjBcbiAqL1xuKCBmdW5jdGlvbiggJCApIHtcblxuXHR3aW5kb3cubGxtcyA9IHdpbmRvdy5sbG1zIHx8IHt9O1xuXG5cdHdpbmRvdy5sbG1zLm1ldGFib3hfcHJvZHVjdCA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0LyoqXG5cdFx0ICogQSByYW5kb21seSBnZW5lcmF0ZWQgdGVtcG9yYXJ5IElEIHVzZWQgZm9yIHRoZSB0aW55TUNFIGVkaXRvcidzIGlkXG5cdFx0ICogd2hlbiBhIG5ldyBwbGFuIGlzIGFkZGVkXG5cdFx0ICogQHR5cGUgaW50XG5cdFx0ICovXG5cdFx0dGhpcy50ZW1wX2lkID0gTWF0aC5mbG9vciggKCBNYXRoLnJhbmRvbSgpICogNzc3NyApICsgNzc3ICk7XG5cblx0XHQvKipcblx0XHQgKiBJbml0aWFsaXplXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuICB2b2lkXG5cdFx0ICogQHNpbmNlICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAzLjYuMFxuXHRcdCAqL1xuXHRcdHRoaXMuaW5pdCA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR0aGlzLmJpbmRfdmlzaWJpbGl0eSgpO1xuXG5cdFx0XHR2YXIgJG1iID0gJCggJyNsaWZ0ZXJsbXMtcHJvZHVjdCAjbGxtcy1wcm9kdWN0LW9wdGlvbnMtYWNjZXNzLXBsYW5zJyApO1xuXG5cdFx0XHRpZiAoICEgJG1iLmxlbmd0aCApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHRMTE1TLlNwaW5uZXIuc3RhcnQoICRtYiApO1xuXG5cdFx0XHQvLyB3ZSByZWx5IG9uIFRpbnlNQ0UgYnV0IFdvcmRQcmVzcyBkb2Vzbid0IHJlZ2lzdGVyIFRpbnlNQ0Vcblx0XHRcdC8vIGxpa2UgZXZlcnkgb3RoZXIgYWRtaW4gc2NyaXB0IHNvIHdlJ2xsIGRvIGEgbGl0dGxlIGRlcGVuZGVuY3kgY2hlY2sgaGVyZS4uLlxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRjb3VudGVyID0gMCxcblx0XHRcdFx0aW50ZXJ2YWw7XG5cblx0XHRcdGludGVydmFsID0gc2V0SW50ZXJ2YWwoIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdC8vIGlmIHdlIGdldCB0byAzMCBzZWNvbmRzIGRpc3BsYXkgYW4gZXJyb3IgbWVzc2FnZVxuXHRcdFx0XHRpZiAoIGNvdW50ZXIgPj0gMzAwICkge1xuXG5cdFx0XHRcdFx0JG1iLmh0bWwoIExMTVMubDEwbi50cmFuc2xhdGUoICdUaGVyZSB3YXMgYW4gZXJyb3IgbG9hZGluZyB0aGUgbmVjZXNzYXJ5IHJlc291cmNlcy4gUGxlYXNlIHRyeSBhZ2Fpbi4nICkgKTtcblxuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIGlmIHdlIGNhbid0IGFjY2VzcyB0aW55TUNFLCBpbmNyZW1lbnQgYW5kIHdhaXQuLi5cblx0XHRcdFx0ZWxzZSBpZiAoICd1bmRlZmluZWQnID09PSB0eXBlb2YgdGlueU1DRSApIHtcblxuXHRcdFx0XHRcdGNvdW50ZXIrKztcblx0XHRcdFx0XHRyZXR1cm47XG5cblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBiaW5kIHRoZSBldmVudHMsIHdlJ3JlIGdvb2QhXG5cdFx0XHRcdGVsc2Uge1xuXG5cdFx0XHRcdFx0c2VsZi5iaW5kKCk7XG5cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGNsZWFySW50ZXJ2YWwoIGludGVydmFsICk7XG5cdFx0XHRcdExMTVMuU3Bpbm5lci5zdG9wKCAkbWIgKTtcblxuXHRcdFx0fSwgMTAwICk7XG5cblx0XHR9O1xuXG5cblx0XHQvKipcblx0XHQgKiBCaW5kIERPTSBFdmVudHNcblx0XHQgKlxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqIEBzaW5jZSAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmJpbmQgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHQvLyBzYXZlIGFjY2VzcyBwbGFucyBidXR0b25cblx0XHRcdC8vIEB0b2RvIGNvbnZlcnQgdG8gYWpheCBtZXRob2QgdGhhdCBkb2Vzbid0IHJlbG9hZCB0aGUgd2hvbGUgZGVhbGllXG5cdFx0XHQkKCAnI2xsbXMtc2F2ZS1hY2Nlc3MtcGxhbnMnICkub24oICdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKCAnI3B1Ymxpc2gnICkudHJpZ2dlciggJ2NsaWNrJyApO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQvLyBiaW5kIGNoYW5nZSBldmVudHMgdG8gZm9ybSBlbGVtZW50IHRoYXQgY29udHJvbHMgYW5vdGhlciBmb3JtIGVsZW1lbnRcblx0XHRcdCQoICcjbGxtcy1hY2Nlc3MtcGxhbnMnICkub24oICdjaGFuZ2UnLCAnW2RhdGEtY29udHJvbGxlci1pZF0nLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0c2VsZi5jb250cm9sbGVyX2NoYW5nZSggJCggdGhpcyApICk7XG5cdFx0XHR9IClcblxuXHRcdFx0JCggJyNsbG1zLWFjY2Vzcy1wbGFucyAubGxtcy1hY2Nlc3MtcGxhbi1kYXRlcGlja2VyJyApLmRhdGVwaWNrZXIoIHtcblx0XHRcdFx0ZGF0ZUZvcm1hdDogXCJtbS9kZC95eVwiXG5cdFx0XHR9ICk7XG5cblx0XHRcdC8vIHRyaWdnZXIgY2hhbmdlcyBvbiBsb2FkIGZvciBhbGwgZXhpc3RpbmcgcGxhbnNcblx0XHRcdCQoICcjbGxtcy1hY2Nlc3MtcGxhbnMgW2RhdGEtY29udHJvbGxlci1pZF0nICkudHJpZ2dlciggJ2NoYW5nZScgKTtcblxuXHRcdFx0Ly8gYWRkIGEgbmV3IGVtcHR5IHBsYW4gaW50ZXJmYWNlIG9uIG5ldyBwbGFuIGJ1dHRvbiBjbGlja1xuXHRcdFx0JCggJyNsbG1zLW5ldy1hY2Nlc3MtcGxhbicgKS5vbiggJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciAkZWwgPSAkKCB0aGlzICk7XG5cdFx0XHRcdHNlbGYuaW5pdF9wbGFuKCk7XG5cdFx0XHRcdCRlbC5hdHRyKCAnZGlzYWJsZWQnLCAnZGlzYWJsZWQnICk7XG5cdFx0XHRcdHNldFRpbWVvdXQoIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdCRlbC5yZW1vdmVBdHRyKCAnZGlzYWJsZWQnICk7XG5cdFx0XHRcdH0sIDUwMCApO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQkKCAnI2xsbXMtYWNjZXNzLXBsYW5zJyApLnNvcnRhYmxlKCB7XG5cdFx0XHRcdGhhbmRsZTogJy5sbG1zLWRyYWctaGFuZGxlJyxcblx0XHRcdFx0aXRlbXM6ICcubGxtcy1hY2Nlc3MtcGxhbicsXG5cdFx0XHRcdHN0YXJ0OiBmdW5jdGlvbiggZXZlbnQsIHVpICkge1xuXHRcdFx0XHRcdCQoICcjbGxtcy1hY2Nlc3MtcGxhbnMnICkuYWRkQ2xhc3MoICdkcmFnZ2luZycgKTtcblx0XHRcdFx0fSxcblx0XHRcdFx0c3RvcDogZnVuY3Rpb24oIGV2ZW50LCB1aSApIHtcblx0XHRcdFx0XHQkKCAnI2xsbXMtYWNjZXNzLXBsYW5zJyApLnJlbW92ZUNsYXNzKCAnZHJhZ2dpbmcnICk7XG5cdFx0XHRcdFx0c2VsZi51cGRhdGVfcGxhbl9vcmRlcnMoKTtcblx0XHRcdFx0fSxcblx0XHRcdH0gKTtcblxuXHRcdFx0Ly8gYmluZCB0ZXh0IGVudGVyZWQgaW50byB0aGUgdGl0bGUgdG8gdGhlIGRpc3BsYXllZCB0aXRsZSBmb3IgZmFuY3kgZnVuXG5cdFx0XHQkKCAnI2xsbXMtYWNjZXNzLXBsYW5zJyApLm9uKCAna2V5dXAnLCAnaW5wdXQubGxtcy1wbGFuLXRpdGxlJywgZnVuY3Rpb24oICkge1xuXG5cdFx0XHRcdHZhciAkaW5wdXQgPSAkKCB0aGlzICksXG5cdFx0XHRcdFx0JHBsYW4gPSAkaW5wdXQuY2xvc2VzdCggJy5sbG1zLWFjY2Vzcy1wbGFuJyApLFxuXHRcdFx0XHRcdCRkaXNwbGF5ID0gJHBsYW4uZmluZCggJ3NwYW4ubGxtcy1wbGFuLXRpdGxlJyApLFxuXHRcdFx0XHRcdHZhbCA9ICRpbnB1dC52YWwoKSxcblx0XHRcdFx0XHR0aXRsZSA9ICggdmFsICkgPyB2YWwgOiAkZGlzcGxheS5hdHRyKCAnZGF0YS1kZWZhdWx0JyApO1xuXG5cdFx0XHRcdCRkaXNwbGF5LnRleHQoIHRpdGxlICk7XG5cblx0XHRcdH0gKTtcblxuXG5cdFx0XHQkKCAnI2xsbXMtYWNjZXNzLXBsYW5zJyApLm9uKCAnY2xpY2snLCAnLmxsbXMtcGxhbi1kZWxldGUnLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0c2VsZi5kZWxldGVfcGxhbiggJCggdGhpcyApICk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdC8vIHNlbGVjdDJpZnkgbWVtYmVyc2hpcCBhdmFpbGFiaWxpdHkgZmllbGRzXG5cdFx0XHR3aW5kb3cubGxtcy5tZXRhYm94ZXMucG9zdF9zZWxlY3QoICQoICcjbGxtcy1hY2Nlc3MtcGxhbnMgLmxsbXMtYXZhaWxhYmlsaXR5LXJlc3RyaWN0aW9ucycgKSApO1xuXG5cdFx0XHQvLyBkaXNhYmxlIHRoZSB0ZXh0YXJlYSBnZW5lcmF0ZWQgYnkgdGhlIHdwX2VkaXRvciBmdW5jdGlvblxuXHRcdFx0Ly8gY2FuJ3QgZmlndXJlIG91dCBob3cgdG8gZG8gdGhpcyBkdXJpbmcgaW5pdGlhbGl6YXRpb25cblx0XHRcdCQoICcjX2xsbXNfcGxhbnNfY29udGVudF9sbG1zLW5ldy1hY2Nlc3MtcGxhbi1tb2RlbCcgKS5hdHRyKCAnZGlzYWJsZWQnLCAnZGlzYWJsZWQnICk7XG5cdFx0XHR0aW55TUNFLkVkaXRvck1hbmFnZXIuZXhlY0NvbW1hbmQoICdtY2VSZW1vdmVFZGl0b3InLCB0cnVlLCAnX2xsbXNfcGxhbnNfY29udGVudF9sbG1zLW5ldy1hY2Nlc3MtcGxhbi1tb2RlbCcgKTtcblxuXHRcdFx0Ly8gd2hlbiB0aGUgcHVibGlzaCBidXR0b24gaXMgY2xpY2tlZCBsb29wIHRocm91Z2ggYWxsIHBsYW4gaW5wdXRzXG5cdFx0XHQvLyB3aGljaCBtaWdodCBoYXZlIHZhbGlkYXRpb24gZXJyb3JzIHVudGlsIHdlIGZpbmQgYW4gZXJyb3IsIGlmIHdlIGRvbid0IGZpbmQgb25lLCBpdCBnZXQncyBwdWJsaXNoZWRcblx0XHRcdCQoICcjcHVibGlzaCcgKS5vbiggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7XG5cblx0XHRcdFx0Ly8gbG9vcFxuXHRcdFx0XHQkKCAnI2xsbXMtYWNjZXNzLXBsYW5zIGlucHV0JyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdFx0Ly8gaWYgdGhlIGZpZWxkIGlzIGludmFsaWRcblx0XHRcdFx0XHRpZiAoICQoIHRoaXMgKS5pcyggJzppbnZhbGlkJyApICkge1xuXHRcdFx0XHRcdFx0dmFyICRwbGFuID0gJCggdGhpcyApLmNsb3Nlc3QoICcubGxtcy1hY2Nlc3MtcGxhbicgKTtcblx0XHRcdFx0XHRcdC8vIGNoZWNrIGlmIHRoZSBwbGFuIGlzIG9wZW4sIG9wZW4gaWYgaXQncyBub3Rcblx0XHRcdFx0XHRcdGlmICggISAkcGxhbi5oYXNDbGFzcyggJ29wZW5lZCcgKSApIHtcblx0XHRcdFx0XHRcdFx0JHBsYW4uZmluZCggJy5sbG1zLWNvbGxhcHNpYmxlLWhlYWRlcicgKS50cmlnZ2VyKCAnY2xpY2snICk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHQvLyBleGl0IHRoZSBsb29wIHJlZ2FyZGxlc3MgYmMgdGhlIGVycm9yIG1zZyB3aWxsIG5vdyBiZSB2aXNpYmxlXG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH0gKTtcblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEJpbmQgRE9NIGV2ZW50cyBmb3IgZWRpdGluZyBwcm9kdWN0IHZpc2liaWxpdHlcblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjYuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjYuMFxuXHRcdCAqL1xuXHRcdHRoaXMuYmluZF92aXNpYmlsaXR5ID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciAkcmFkaW9zID0gJCggJyNsbG1zLWNhdGFsb2ctdmlzaWJpbGl0eS1zZWxlY3QnICksXG5cdFx0XHRcdCR0b2dnbGUgPSAkKCAnYS5sbG1zLWVkaXQtY2F0YWxvZy12aXNpYmlsaXR5JyApLFxuXHRcdFx0XHQkc2F2ZSA9ICQoICdhLmxsbXMtc2F2ZS1jYXRhbG9nLXZpc2liaWxpdHknICksXG5cdFx0XHRcdCRjYW5jZWwgPSAgJCggJ2EubGxtcy1jYW5jZWwtY2F0YWxvZy12aXNpYmlsaXR5JyApO1xuXG5cdFx0XHQkdG9nZ2xlLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHQkcmFkaW9zLnNsaWRlRG93biggJ2Zhc3QnICk7XG5cdFx0XHRcdCR0b2dnbGUuaGlkZSgpO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQkc2F2ZS5vbiggJ2NsaWNrJywgZnVuY3Rpb24oIGUgKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0JHJhZGlvcy5zbGlkZVVwKCAnZmFzdCcgKTtcblx0XHRcdFx0JHRvZ2dsZS5zaG93KCk7XG5cdFx0XHRcdCQoICcjbGxtcy1jYXRhbG9nLXZpc2liaWxpdHktZGlzcGxheScgKS50ZXh0KCAkKCAnaW5wdXRbbmFtZT1cIl9sbG1zX3Zpc2liaWxpdHlcIl06Y2hlY2tlZCcgKS5hdHRyKCAnZGF0YS1sYWJlbCcgKSApO1xuXHRcdFx0fSApO1xuXG5cdFx0XHQkY2FuY2VsLm9uKCAnY2xpY2snLCBmdW5jdGlvbiggZSApIHtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHQkcmFkaW9zLnNsaWRlVXAoICdmYXN0JyApO1xuXHRcdFx0XHQkdG9nZ2xlLnNob3coKTtcblx0XHRcdH0gKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBIYW5kbGUgcGh5c2ljYWwgZGVsZXRpb24gb2YgYSBwbGFuIGVsZW1lbnRcblx0XHQgKiBJZiB0aGUgcGxhbiBoYXNuJ3QgYmUgcGVyc2lzdGVkIHRvIHRoZSBkYXRhYnNlIGl0J3MgcmVtb3ZlZCBmcm9tIHRoZSBkb21cblx0XHQgKiBpZiBpdCBhbHJlYWR5IGV4aXN0cyBpbiB0aGUgZGF0YWJhc2UgYSBjb25maXJtIG1vZGFsIGlzIGRpc3BsYXllZFxuXHRcdCAqIHVwb24gY29uZmlybWF0aW9uIEFKQVggY2FsbCB3aWxsIGJlIG1hZGUgdG8gbW92ZSB0aGUgcGxhbiB0byB0aGUgdHJhc2hcblx0XHQgKiBhbmQgdXBvbiBzdWNjZXNzIHRoZSBlbGVtZW50IHdpbGwgYmUgcmVtb3ZlZCBmcm9tIHRoZSBkb21cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSAgb2JqICRidG4galF1ZXJ5IHNlbGVjdG9yIG9mIHRoZSBcIlhcIiBidXR0b24gY2xpY2tlZCB0byBpbml0aWF0ZSBkZWxldGlvblxuXHRcdCAqIEByZXR1cm4gdm9pZFxuXHRcdCAqIEBzaW5jZSAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmRlbGV0ZV9wbGFuID0gZnVuY3Rpb24oICRidG4gKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0JHBsYW4gPSAkYnRuLmNsb3Nlc3QoICcubGxtcy1hY2Nlc3MtcGxhbicgKSxcblx0XHRcdFx0cGxhbl9pZCA9ICRwbGFuLmF0dHIoICdkYXRhLWlkJyApO1xuXG5cdFx0XHQvLyBpZiB0aGVyZSdzIG5vIElEIGp1c3QgcmVtb3ZlIHRoZSBlbGVtZW50IGZyb20gdGhlIERPTVxuXHRcdFx0aWYgKCAhIHBsYW5faWQgKSB7XG5cdFx0XHRcdHNlbGYucmVtb3ZlX3BsYW5fZWwoICRwbGFuICk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIHRyaWdnZXIgYSB0b3BNb2RhbCBzbyB3ZSBjYW4gd2FybiBhbmQgY29uZmlybSBkZWxldGlvbiBvZiB0aGUgcGxhblxuXHRcdFx0ZWxzZSB7XG5cblx0XHRcdFx0JCggJyNsbG1zLWRlbGV0ZS1wbGFuLW1vZGFsJyApLnRvcE1vZGFsKCB7XG5cdFx0XHRcdFx0b3BlbjogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHQvLyBhdHRhY2ggYW4gZXZlbnQgaGFuZGxlciB0byB0aGUgZGVsIGJ1dHRvbiB0byBhY3R1YWxseSBkZWxldGUgdGhlIHRoaW5nXG5cdFx0XHRcdFx0XHQkKCAnI2xsbXMtY29uZmlybS1kZWxldGUtcGxhbicgKS5vbiggJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0XHRcdFx0TExNUy5TcGlubmVyLnN0YXJ0KCAkcGxhbiwgJ3NtYWxsJyApO1xuXG5cdFx0XHRcdFx0XHRcdCQoICcjbGxtcy1kZWxldGUtcGxhbi1tb2RhbCAudG9wTW9kYWxDbG9zZScgKS50cmlnZ2VyKCAnY2xpY2snICk7XG5cblx0XHRcdFx0XHRcdFx0d2luZG93LkxMTVMuQWpheC5jYWxsKCB7XG5cdFx0XHRcdFx0XHRcdFx0ZGF0YToge1xuXHRcdFx0XHRcdFx0XHRcdFx0YWN0aW9uOiAnZGVsZXRlX2FjY2Vzc19wbGFuJyxcblx0XHRcdFx0XHRcdFx0XHRcdHBsYW5faWQ6IHBsYW5faWQsXG5cdFx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbiggciApIHtcblxuXHRcdFx0XHRcdFx0XHRcdFx0TExNUy5TcGlubmVyLnN0b3AoICRwbGFuICk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdGlmICggci5zdWNjZXNzICkge1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRcdHNlbGYucmVtb3ZlX3BsYW5fZWwoICRwbGFuICk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdH0gZWxzZSBpZiAoIHIubWVzc2FnZSApIHtcblxuXHRcdFx0XHRcdFx0XHRcdFx0XHRhbGVydCggci5tZXNzYWdlICk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHR9ICk7XG5cblxuXG5cdFx0XHRcdFx0XHR9ICk7XG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRjbG9zZWQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0Ly8gcmVtb3ZlIHRoZSBpZFxuXHRcdFx0XHRcdFx0JCggJyNsbG1zLWRlbGV0ZS1wbGFuLW1vZGFsJyApLmF0dHIoICdkYXRhLXBsYW4taWQnLCAnJyApO1xuXG5cdFx0XHRcdFx0XHQvLyByZW1vdmUgY2xpY2sgaGFuZGxlcnNcblx0XHRcdFx0XHRcdCQoICcjbGxtcy1jb25maXJtLWRlbGV0ZS1wbGFuJyApLm9mZiggJ2NsaWNrJyApO1xuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdH0gKS5hdHRyKCAnZGF0YS1wbGFuLWlkJywgcGxhbl9pZCApO1xuXHRcdFx0fVxuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEhhbmRsZSBoaWRpbmcgJiBzaG93aW5nIHZhcmlvcyBwaWVjZXMgb2YgYW4gYWNjZXNzIHBsYW4gZm9ybVxuXHRcdCAqIFRoaXMgaXMgYm91bmQgdG8gYW55IGZvcm0gZWxlbWVudCB3aXRoIGEgXCJkYXRhLWNvbnRyb2xsZXItaWRcIiBwcm9wZXJ0eVxuXHRcdCAqXG5cdFx0ICogQHBhcmFtICBvYmogICRlbCAgIGpRdWVyeSBzZWxlY3RvciBmb3IgdGhlIGNoYW5nZWQgZm9ybSBlbGVtZW50XG5cdFx0ICogQHJldHVybiB2b2lkXG5cdFx0ICogQHNpbmNlICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuY29udHJvbGxlcl9jaGFuZ2UgPSBmdW5jdGlvbiggJGVsICkge1xuXG5cdFx0XHR2YXIgaWQgPSAkZWwuYXR0ciggJ2RhdGEtY29udHJvbGxlci1pZCcgKSxcblx0XHRcdFx0dmFsID0gJGVsLnZhbCgpLFxuXHRcdFx0XHQkZm9ybSA9ICRlbC5jbG9zZXN0KCAnLmxsbXMtYWNjZXNzLXBsYW4nICksXG5cdFx0XHRcdCRjb250cm9scyA9ICRmb3JtLmZpbmQoICdbZGF0YS1jb250cm9sbGVyPVwiJyArIGlkICsgJ1wiXScpO1xuXG5cdFx0XHRpZiAoICdjaGVja2JveCcgPT09ICRlbC5hdHRyKCAndHlwZScgKSApICB7XG5cdFx0XHRcdHZhbCA9ICggJGVsLmlzKCAnOmNoZWNrZWQnICkgKSA/IHZhbCA6ICdubyc7XG5cdFx0XHR9XG5cblx0XHRcdCRjb250cm9scy5lYWNoKCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHR2YXIgJGMgPSAkKCB0aGlzICksXG5cdFx0XHRcdFx0JGVscyA9ICggJ1NFTEVDVCcgPT09ICRjWzBdLm5vZGVOYW1lIHx8ICdJTlBVVCcgID09PSAkY1swXS5ub2RlTmFtZSB8fCAnVEVYVEFSRUEnICA9PT0gJGNbMF0ubm9kZU5hbWUgKSA/ICRjIDogJGMuZmluZCggJ2lucHV0LCBzZWxlY3QsIHRleHRhcmVhJyApLFxuXHRcdFx0XHRcdGVxdWFscyA9ICRjLmF0dHIoICdkYXRhLXZhbHVlLWlzJyApLFxuXHRcdFx0XHRcdG5vdF9lcXVhbHMgPSAkYy5hdHRyKCAnZGF0YS12YWx1ZS1pcy1ub3QnICksXG5cdFx0XHRcdFx0YWN0aW9uLCBvcGVyYXRvcjtcblxuXHRcdFx0XHRpZiAoIHR5cGVvZiBlcXVhbHMgIT09IHR5cGVvZiB1bmRlZmluZWQgJiYgZXF1YWxzICE9PSBmYWxzZSApIHtcblxuXHRcdFx0XHRcdG9wZXJhdG9yID0gJz09JztcblxuXHRcdFx0XHR9IGVsc2UgaWYgKCB0eXBlb2Ygbm90X2VxdWFscyAhPT0gdHlwZW9mIHVuZGVmaW5lZCAmJiBub3RfZXF1YWxzICE9PSBmYWxzZSApIHtcblxuXHRcdFx0XHRcdG9wZXJhdG9yID0gJyE9JztcblxuXHRcdFx0XHR9XG5cblx0XHRcdFx0c3dpdGNoICggb3BlcmF0b3IgKSB7XG5cblx0XHRcdFx0XHRjYXNlICc9PSc6XG5cblx0XHRcdFx0XHRcdGlmICggdmFsID09IGVxdWFscyApIHtcblx0XHRcdFx0XHRcdFx0YWN0aW9uID0gJ3Nob3cnO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0YWN0aW9uID0gJ2hpZGUnO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0YnJlYWs7XG5cblx0XHRcdFx0XHRjYXNlICchPSc6XG5cblx0XHRcdFx0XHRcdGlmICggdmFsICE9IG5vdF9lcXVhbHMgKSB7XG5cdFx0XHRcdFx0XHRcdGFjdGlvbiA9ICdzaG93Jztcblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdGFjdGlvbiA9ICdoaWRlJztcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGJyZWFrO1xuXG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoICdzaG93JyA9PT0gYWN0aW9uICkge1xuXHRcdFx0XHRcdCRjLnNob3coKTtcblx0XHRcdFx0XHQkZWxzLnJlbW92ZUF0dHIoICdkaXNhYmxlZCcgKS50cmlnZ2VyKCAnY2hhbmdlJyApO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCAnaGlkZScgPT09IGFjdGlvbiApIHtcblx0XHRcdFx0XHQkYy5oaWRlKCk7XG5cdFx0XHRcdFx0JGVscy5hdHRyKCAnZGlzYWJsZWQnLCAnZGlzYWJsZWQnICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIERldGVybWluZSBpZiB0aGUgYWNjZXNzIHBsYW4gbGltaXQgaGFzIGJlZW4gcmVhY2hlZFxuXHRcdCAqXG5cdFx0ICogQHJldHVybiBCb29sZWFuICAgICB0cnVlIGlmIGl0J3MgYmVlbiByZWFjaGVkLCBmYWxzZSBvdGhlcndpc2Vcblx0XHQgKiBAc2luY2UgIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5oYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIGxpbWl0ID0gd2luZG93LmxsbXMucHJvZHVjdC5hY2Nlc3NfcGxhbl9saW1pdCxcblx0XHRcdFx0Y3VyciA9ICQoICcjbGxtcy1hY2Nlc3MtcGxhbnMgLmxsbXMtYWNjZXNzLXBsYW4nICkubGVuZ3RoO1xuXG5cdFx0XHRyZXR1cm4gY3VyciA+PSBsaW1pdDtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBJbml0YWxpemVzIGEgbmV3IHBsYW4gYW5kIGFkZHMgaXQgdG8gdGhlIGxpc3Qgb2YgcGxhbnMgaW4gdGhlIERPTVxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMjMuMFxuXHRcdCAqL1xuXHRcdHRoaXMuaW5pdF9wbGFuID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdC8vIGRvbid0IGRvIGFueXRoaW5nIGlmIHdlJ3ZlIHJlYWNoZWQgdGhlIHBsYW4gbGltaXRcblx0XHRcdGlmICggdGhpcy5oYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQoKSApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgJGNsb25lID0gJCggJyNsbG1zLW5ldy1hY2Nlc3MtcGxhbi1tb2RlbCcgKS5jbG9uZSgpXG5cdFx0XHRcdCRleGlzdGluZ19wbGFucyA9ICQoICcjbGxtcy1hY2Nlc3MtcGxhbnMgLmxsbXMtYWNjZXNzLXBsYW4nICksXG5cdFx0XHRcdCRlZGl0b3IgPSAkY2xvbmUuZmluZCggJyNfbGxtc19wbGFuc19jb250ZW50X2xsbXMtbmV3LWFjY2Vzcy1wbGFuLW1vZGVsJyApO1xuXG5cdFx0XHQvLyByZW1vdmUgSUQgZnJvbSB0aGUgaXRlbVxuXHRcdFx0JGNsb25lLnJlbW92ZUF0dHIoICdpZCcgKTtcblxuXHRcdFx0Ly8gZ2l2ZSBhIHRlbXBvcmFyeSBpZCB0byB0aGUgZWRpdG9yIGVsZW1lbnRcblx0XHRcdCRlZGl0b3IucmVtb3ZlQXR0ciggJ2lkJyApLmF0dHIoICdpZCcsICdfbGxtc19wbGFuc19jb250ZW50XycgKyB0aGlzLnRlbXBfaWQgKTtcblx0XHRcdHRoaXMudGVtcF9pZCsrOyAvLyBpbmNyZW1lbnQgdGhlIHRlbXBfaWQgSUQgc28gd2UgZG9uJ3QgdXNlIGl0IGFnYWluXG5cblxuXHRcdFx0Ly8gYWN0aXZhdGUgYWxsIGVsZW1lbnRzXG5cdFx0XHQkY2xvbmUuZmluZCggJ3NlbGVjdCwgaW5wdXQsIHRleHRhcmVhJyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKCB0aGlzICkucmVtb3ZlQXR0ciggJ2Rpc2FibGVkJyApOyAvLyBlbmFibGVkIHRoZSBmaWVsZFxuXHRcdFx0fSApO1xuXG5cblx0XHRcdCRjbG9uZS5maW5kKCAnLmxsbXMtYWNjZXNzLXBsYW4tZGF0ZXBpY2tlcicgKS5kYXRlcGlja2VyKCB7XG5cdFx0XHRcdGRhdGVGb3JtYXQ6IFwibW0vZGQveXlcIlxuXHRcdFx0fSApO1xuXG5cdFx0XHQkY2xvbmUuYXBwZW5kVG8oICcjbGxtcy1hY2Nlc3MtcGxhbnMnICk7XG5cblx0XHRcdC8vIHJld3JpdGUgdGhlIG9yZGVyIG9mIGFsbCBlbGVtZW50c1xuXHRcdFx0dGhpcy51cGRhdGVfcGxhbl9vcmRlcnMoKTtcblxuXHRcdFx0JGNsb25lLmZpbmQoICcubGxtcy1jb2xsYXBzaWJsZS1oZWFkZXInICkudHJpZ2dlciggJ2NsaWNrJyApO1xuXG5cdFx0XHQvLyBjaGVjayBpZiB0aGUgbGltaXQgaGFzIGJlZW4gcmVhY2hlZCBhbmQgdG9nZ2xlIHRoZSBidXR0b24gaWYgaXQgaGFzXG5cdFx0XHRpZiAoIHRoaXMuaGFzX3BsYW5fbGltaXRfYmVlbl9yZWFjaGVkKCkgKSB7XG5cdFx0XHRcdHRoaXMudG9nZ2xlX2NyZWF0ZV9idXR0b24oICdkaXNhYmxlJyApO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBzZWxlY3QyaWZ5IG1lbWJlcnNoaXAgYXZhaWxhYmlsaXR5IGZpZWxkXG5cdFx0XHR3aW5kb3cubGxtcy5tZXRhYm94ZXMucG9zdF9zZWxlY3QoICRjbG9uZS5maW5kKCAnLmxsbXMtYXZhaWxhYmlsaXR5LXJlc3RyaWN0aW9ucycgKSApO1xuXG5cdFx0XHQkY2xvbmUuZmluZCggJ1tkYXRhLWNvbnRyb2xsZXItaWRdJyApLnRyaWdnZXIoICdjaGFuZ2UnICk7XG5cdFx0XHQkKCBkb2N1bWVudCApLnRyaWdnZXIoICdsbG1zLXBsYW4taW5pdCcsICRjbG9uZSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENvbnRyb2wgdGhlIHN0YXR1cyBvZiB0aGUgXCJOZXcgQWNjZXNzIFBsYW5cIiBCdXR0b25cblx0XHQgKiBFbmFibGVzIC8gRGlzYWJsZXMgdGhlIGJ1dHRvbiBhbmQgc2hvd3MgLyBoaWRlcyB0aGUgYXNzb2NpYXRlZCBtZXNzYWdlXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gIHN0cmluZyBzdGF0dXMgICAgZW5hYmxlIG9yIGRpc2FibGVcblx0XHQgKiBAcmV0dXJuIHZvaWRcblx0XHQgKiBAc2luY2UgIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy50b2dnbGVfY3JlYXRlX2J1dHRvbiA9IGZ1bmN0aW9uKCBzdGF0dXMgKSB7XG5cblx0XHRcdHZhciAkYnRuID0gJCggJyNsbG1zLW5ldy1hY2Nlc3MtcGxhbicgKSxcblx0XHRcdFx0JG1zZyA9ICRidG4ubmV4dCggJ3AnICk7XG5cblx0XHRcdGlmICggJ2Rpc2FibGUnID09PSBzdGF0dXMgKSB7XG5cblx0XHRcdFx0JGJ0bi5hdHRyKCAnZGlzYWJsZWQnLCAnZGlzYWJsZWQnICk7XG5cdFx0XHRcdCRtc2cuc2hvdygpO1xuXG5cdFx0XHR9IGVsc2Uge1xuXG5cdFx0XHRcdCRidG4ucmVtb3ZlQXR0ciggJ2Rpc2FibGVkJyApO1xuXHRcdFx0XHQkbXNnLmhpZGUoKTtcblxuXHRcdFx0fVxuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFZpc3VhbGx5IGhpZGUgYW5kIHRoZW4gcGh5c2ljYWxseSByZW1vdmUgYSBwbGFuIGVsZW1lbnQgZnJvbSB0aGUgRE9NXG5cdFx0ICogQWRkaXRpb25hbGx5IGRldGVybWluZXMgaWYgdGhlIE5ldyBQbGFuIEJ1dHRvbiBzaG91bGQgYmUgcmUtZW5hYmxlZFxuXHRcdCAqIGFmdGVyIGRlbGV0aW9uXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gIG9iaiAgICRwbGFuIGpRdWVyeSBzZWxlY3RvciBvZiB0aGUgcGxhbiBlbGVtZW50XG5cdFx0ICogQHJldHVybiB2b2lkXG5cdFx0ICogQHNpbmNlIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5yZW1vdmVfcGxhbl9lbCA9IGZ1bmN0aW9uKCAkcGxhbiApIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzO1xuXG5cdFx0XHQvLyBmYWRlIG91dCBuaWNlbHlcblx0XHRcdCRwbGFuLmZhZGVPdXQoIDQwMCApO1xuXG5cdFx0XHQvLyByZW1vdmUgZnJvbSBkb20gYWZ0ZXIgaXQncyBoaWRkZW4gdmlzdWFsbHlcblx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cblx0XHRcdFx0JHBsYW4ucmVtb3ZlKCk7XG5cblx0XHRcdFx0Ly8gY2hlY2sgaWYgd2UgbmVlZCB0byByZWVuYWJsZSB0aGUgY3JlYXRlIGJ1dHRvbiBhbmQgaGlkZSB0aGUgbWVzc2FnZVxuXHRcdFx0XHRpZiAoICEgc2VsZi5oYXNfcGxhbl9saW1pdF9iZWVuX3JlYWNoZWQoKSApIHtcblx0XHRcdFx0XHRzZWxmLnRvZ2dsZV9jcmVhdGVfYnV0dG9uKCAnZW5hYmxlJyApO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCA0NTAgKTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZW9yZGVyIHRoZSBhcnJheSBpbmRleGVzIGFuZCB0aGUgbWVudSBvcmRlciBoaWRkZW4gaW5wdXRzXG5cdFx0ICogQ2FsbGVkIGJ5IGpRdWVyeSBVSSBTb3J0YWJsZSBvbiBzb3J0IGNvbXBsZXRpb25cblx0XHQgKiBBbHNvIGNhbGxlZCBhZnRlciBhZGRpbmcgYSBuZXcgcGxhbiB0byB0aGUgRE9NIHNvIHRoZSBuZXdlc3QgaXRlbSBpcyBhbHdheXNcblx0XHQgKiBwZXJzaXN0ZWQgYXMgdGhlIGxhc3QgaW4gdGhlIGRhdGFiYXNlIGlmIG5vIFVYIHJlb3JkZXJzIHRoZSBpdGVtXG5cdFx0ICpcblx0XHQgKiBAcmV0dXJuIHZvaWRcblx0XHQgKiBAc2luY2UgIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy51cGRhdGVfcGxhbl9vcmRlcnMgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0JCggJyNsbG1zLWFjY2Vzcy1wbGFucyAubGxtcy1hY2Nlc3MtcGxhbicgKS5lYWNoKCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHR2YXIgJHAgPSAkKCB0aGlzICksXG5cdFx0XHRcdFx0JG9yZGVyID0gJHAuZmluZCggJy5wbGFuLW9yZGVyJyApLFxuXHRcdFx0XHRcdCRlZGl0b3IgPSAkcC5maW5kKCAndGV4dGFyZWFbaWRePVwiX2xsbXNfcGxhbnNfY29udGVudF9cIl0nICksXG5cdFx0XHRcdFx0ZWRpdG9yX2lkID0gJGVkaXRvci5hdHRyKCAnaWQnICksXG5cdFx0XHRcdFx0b3JpZyA9ICRvcmRlci52YWwoKSAqIDEsXG5cdFx0XHRcdFx0Y3VyciA9ICRwLmluZGV4KCk7XG5cblx0XHRcdFx0Ly8gZGUtaW5pdCB0aW55TUNFIGZyb20gdGhlIGVkaXRvclxuXHRcdFx0XHR0aW55TUNFLkVkaXRvck1hbmFnZXIuZXhlY0NvbW1hbmQoICdtY2VSZW1vdmVFZGl0b3InLCB0cnVlLCBlZGl0b3JfaWQgKTtcblxuXHRcdFx0XHQvLyB1cGRhdGUgdGhlIG9yZGVyIG9mIGVhY2ggZmllbGQgaW4gdGhlIHBsYW5cblx0XHRcdFx0JHAuZmluZCggJ3NlbGVjdCwgaW5wdXQsIHRleHRhcmVhJyApLmVhY2goIGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRcdFx0dmFyIG5hbWUgPSAkKCB0aGlzICkuYXR0ciggJ25hbWUnICk7XG5cdFx0XHRcdFx0aWYgKCBuYW1lICkge1xuXHRcdFx0XHRcdFx0JCggdGhpcyApLmF0dHIoICduYW1lJywgbmFtZS5yZXBsYWNlKCBvcmlnLCBjdXJyICkgKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSApO1xuXG5cdFx0XHRcdC8vIHJlLWluaXQgdGlueU1DRSBvbiB0aGUgZWRpdG9yXG5cdFx0XHRcdHRpbnlNQ0UuRWRpdG9yTWFuYWdlci5leGVjQ29tbWFuZCggJ21jZUFkZEVkaXRvcicsIHRydWUsIGVkaXRvcl9pZCApO1xuXG5cdFx0XHRcdCRvcmRlci52YWwoIGN1cnIgKTtcblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8vIGdvXG5cdFx0dGhpcy5pbml0KCk7XG5cblx0fTtcblxuXHR2YXIgYSA9IG5ldyB3aW5kb3cubGxtcy5tZXRhYm94X3Byb2R1Y3QoKTtcblxufSApKCBqUXVlcnkgKTtcbiJdfQ==
