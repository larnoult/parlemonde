!function(l,t){window.llms=window.llms||{};window.llms.analytics=new function(){return this.charts_loaded=!1,this.data={},this.query=l.parseJSON(l("#llms-analytics-json").text()),this.timeout=8e3,this.$widgets=l(".llms-widget[data-method]"),this.init=function(){google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(this.charts_ready),this.bind(),this.load_widgets()},this.bind=function(){l(".llms-datepicker").datepicker({dateFormat:"yy-mm-dd",maxDate:0}),l("#llms-students-ids-filter").llmsStudentsSelect2({multiple:!0,placeholder:LLMS.l10n.translate("Filter by Student(s)")}),l('a[href="#llms-toggle-filters"]').on("click",function(t){t.preventDefault(),l(".llms-analytics-filters").slideToggle(100)}),l("#llms-custom-date-submit").on("click",function(){l('input[name="range"]').val("custom")}),l("#llms-date-quick-filters a.llms-nav-link[data-range]").on("click",function(t){t.preventDefault(),l('input[name="range"]').val(l(this).attr("data-range")),l("form.llms-reporting-nav").submit()})},this.charts_ready=function(){window.llms.analytics.charts_loaded=!0,window.llms.analytics.draw_chart()},this.draw_chart=function(){if(this.charts_loaded&&this.is_loading_finished()){var t=document.getElementById("llms-charts-wrapper");if(t){var a=new google.visualization.ComboChart(t),e=this.get_chart_data(),i={chartArea:{height:"75%",width:"85%"},colors:["#606C38","#E85D75","#EF8354","#C64191","#731963"],height:560,lineWidth:4,seriesType:"bars",series:this.get_chart_series_options(),vAxes:{0:{format:"currency"},1:{format:""}}};e.length&&((e=google.visualization.arrayToDataTable(e)).sort([{column:0}]),a.draw(e,i))}}},this.is_loading_finished=function(){return!l(".llms-widget.is-loading").length},this.load_widgets=function(){var t=this;this.$widgets.each(function(){t.load_widget(l(this))})},this.load_widget=function(a){var e,i=this,s=a.attr("data-method"),r=a.find("h1"),n=a.find(".llms-reload-widget"),d=LLMS.l10n.translate("Error");a.addClass("is-loading"),l.ajax({data:{action:"llms_widget_"+s,dates:i.query.dates,courses:i.query.current_courses,memberships:i.query.current_memberships,students:i.query.current_students},method:"POST",timeout:i.timeout,url:window.ajaxurl,success:function(t){e="success",void 0!==t.response&&(d=t.response,i.data[s]={chart_data:t.chart_data,response:t.response,results:t.results},n.remove())},error:function(t){e="error"},complete:function(t){"error"===e&&(d="timeout"===t.statusText?LLMS.l10n.translate("Request timed out"):LLMS.l10n.translate("Error"),n.length||((n=l('<a class="llms-reload-widget" href="#">'+LLMS.l10n.translate("Retry")+"</a>")).on("click",function(t){t.preventDefault(),i.load_widget(a)}),a.append(n))),a.removeClass("is-loading"),r.html(d),i.widget_finished(a)}})},this.get_date_diff=function(){var t=new Date(this.query.dates.end),a=new Date(this.query.dates.start);return Math.abs(t.getTime()-a.getTime())},this.get_chart_data_object=function(){var t,a,e,i,s=this,r=this.get_date_diff(),n={};for(var d in s.data)if(s.data.hasOwnProperty(d)&&"object"==typeof s.data[d].chart_data&&"object"==typeof s.data[d].results&&(t=s.data[d].results))for(a=0;a<t.length;a++)switch(e=this.init_date(t[a].date),n[i=r<=10368e6?new Date(e.getFullYear(),e.getMonth(),e.getDate()):new Date(e.getFullYear(),e.getMonth(),1)]||(n[i]=this.get_empty_data_object(i)),s.data[d].chart_data.type){case"amount":n[i][d]=n[i][d]+1*t[a][s.data[d].chart_data.key];break;case"count":default:n[i][d]++}return n},this.get_chart_data=function(){var t=this.get_chart_data_object(),a=this.get_chart_headers();for(var e in t)if(t.hasOwnProperty(e)){var i=[t[e]._date];for(var s in t[e])t[e].hasOwnProperty(s)&&0!==s.indexOf("_")&&i.push(t[e][s]);a.push(i)}return a},this.get_empty_data_object=function(t){var a=this,e={_date:t};for(var i in a.data)a.data.hasOwnProperty(i)&&a.data[i].chart_data&&(e[i]=0);return e},this.get_chart_headers=function(){var t=this,a=[];for(var e in a.push({label:LLMS.l10n.translate("Date"),id:"date",type:"date"}),t.data)t.data.hasOwnProperty(e)&&t.data[e].chart_data&&a.push(t.data[e].chart_data.header);return[a]},this.get_chart_series_options=function(){var t=this,a={};for(var e in i=0,t.data)if(t.data.hasOwnProperty(e)){if(t.data[e].chart_data){var s=t.data[e].chart_data.type;a[i]={type:"count"===s?"bars":"line",targetAxisIndex:"count"===s?1:0}}i++}return a},this.init_date=function(t){var a,e,i;return e=(a=t.split(" "))[0].split("-"),i=a[1].split(":"),new Date(e[0],e[1]-1,e[2],i[0],i[1],i[2])},this.widget_finished=function(t){this.is_loading_finished()&&this.draw_chart()},this.init(),this}}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxsbXMtYW5hbHl0aWNzLmpzIl0sIm5hbWVzIjpbIiQiLCJ1bmRlZmluZWQiLCJ3aW5kb3ciLCJsbG1zIiwiYW5hbHl0aWNzIiwidGhpcyIsImNoYXJ0c19sb2FkZWQiLCJkYXRhIiwicXVlcnkiLCJwYXJzZUpTT04iLCJ0ZXh0IiwidGltZW91dCIsIiR3aWRnZXRzIiwiaW5pdCIsImdvb2dsZSIsImNoYXJ0cyIsImxvYWQiLCJwYWNrYWdlcyIsInNldE9uTG9hZENhbGxiYWNrIiwiY2hhcnRzX3JlYWR5IiwiYmluZCIsImxvYWRfd2lkZ2V0cyIsImRhdGVwaWNrZXIiLCJkYXRlRm9ybWF0IiwibWF4RGF0ZSIsImxsbXNTdHVkZW50c1NlbGVjdDIiLCJtdWx0aXBsZSIsInBsYWNlaG9sZGVyIiwiTExNUyIsImwxMG4iLCJ0cmFuc2xhdGUiLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsInNsaWRlVG9nZ2xlIiwidmFsIiwiYXR0ciIsInN1Ym1pdCIsImRyYXdfY2hhcnQiLCJpc19sb2FkaW5nX2ZpbmlzaGVkIiwiZWwiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY2hhcnQiLCJ2aXN1YWxpemF0aW9uIiwiQ29tYm9DaGFydCIsImdldF9jaGFydF9kYXRhIiwib3B0aW9ucyIsImNoYXJ0QXJlYSIsImhlaWdodCIsIndpZHRoIiwiY29sb3JzIiwibGluZVdpZHRoIiwic2VyaWVzVHlwZSIsInNlcmllcyIsImdldF9jaGFydF9zZXJpZXNfb3B0aW9ucyIsInZBeGVzIiwiMCIsImZvcm1hdCIsIjEiLCJsZW5ndGgiLCJhcnJheVRvRGF0YVRhYmxlIiwic29ydCIsImNvbHVtbiIsImRyYXciLCJzZWxmIiwiZWFjaCIsImxvYWRfd2lkZ2V0IiwiJHdpZGdldCIsInN0YXR1cyIsIm1ldGhvZCIsIiRjb250ZW50IiwiZmluZCIsIiRyZXRyeSIsImNvbnRlbnRfdGV4dCIsImFkZENsYXNzIiwiYWpheCIsImFjdGlvbiIsImRhdGVzIiwiY291cnNlcyIsImN1cnJlbnRfY291cnNlcyIsIm1lbWJlcnNoaXBzIiwiY3VycmVudF9tZW1iZXJzaGlwcyIsInN0dWRlbnRzIiwiY3VycmVudF9zdHVkZW50cyIsInVybCIsImFqYXh1cmwiLCJzdWNjZXNzIiwiciIsInJlc3BvbnNlIiwiY2hhcnRfZGF0YSIsInJlc3VsdHMiLCJyZW1vdmUiLCJlcnJvciIsImNvbXBsZXRlIiwic3RhdHVzVGV4dCIsImFwcGVuZCIsInJlbW92ZUNsYXNzIiwiaHRtbCIsIndpZGdldF9maW5pc2hlZCIsImdldF9kYXRlX2RpZmYiLCJlbmQiLCJEYXRlIiwic3RhcnQiLCJNYXRoIiwiYWJzIiwiZ2V0VGltZSIsImdldF9jaGFydF9kYXRhX29iamVjdCIsInJlcyIsImkiLCJkIiwiZGF0ZSIsImRpZmYiLCJoYXNPd25Qcm9wZXJ0eSIsImluaXRfZGF0ZSIsImdldEZ1bGxZZWFyIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZ2V0X2VtcHR5X2RhdGFfb2JqZWN0IiwidHlwZSIsImtleSIsIm9iaiIsImdldF9jaGFydF9oZWFkZXJzIiwicm93IiwiX2RhdGUiLCJpdGVtIiwiaW5kZXhPZiIsInB1c2giLCJoIiwibGFiZWwiLCJpZCIsImhlYWRlciIsInRhcmdldEF4aXNJbmRleCIsInN0cmluZyIsInBhcnRzIiwidGltZSIsInNwbGl0IiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiQ0FLQyxTQUFZQSxFQUFHQyxHQUVmQyxPQUFPQyxLQUFPRCxPQUFPQyxNQUFRLEdBbWlCN0JELE9BQU9DLEtBQUtDLFVBQVksSUE1aEJSLFdBd2hCZixPQXRoQkFDLEtBQUtDLGVBQWdCLEVBQ3JCRCxLQUFLRSxLQUFPLEdBQ1pGLEtBQUtHLE1BQVFSLEVBQUVTLFVBQVdULEVBQUcsd0JBQXlCVSxRQUN0REwsS0FBS00sUUFBVSxJQUVmTixLQUFLTyxTQUFXWixFQUFHLDZCQVFuQkssS0FBS1EsS0FBTyxXQUVYQyxPQUFPQyxPQUFPQyxLQUFNLFVBQVcsQ0FDOUJDLFNBQVUsQ0FDVCxlQUdHSCxPQUFPQyxPQUFPRyxr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QUFNOUQsRUFBSzFELEtBQU0rRCxHQUFTb0IsV0FBV3lDLFFBS3pDLE1BQU8sQ0FBRUgsSUFVVjNILEtBQUtrRCx5QkFBMkIsV0FFL0IsSUFBSVUsRUFBTzVELEtBQ1YwQyxFQUFVLEdBR1gsSUFBTSxJQUFJdUIsS0FGVHVDLEVBQUksRUFFZTVDLEVBQUsxRCxLQUN4QixHQUFPMEQsRUFBSzFELEtBQUswRyxlQUFnQjNDLEdBQWpDLENBSUEsR0FBS0wsRUFBSzFELEtBQU0rRCxHQUFTb0IsV0FBYSxDQUVyQyxJQUFJNkIsRUFBT3RELEVBQUsxRCxLQUFNK0QsR0FBU29CLFdBQVc2QixLQUUxQ3hFLEVBQVM4RCxHQUFNLENBQ2RVLEtBQVEsVUFBWUEsRUFBUyxPQUFTLE9BQ3RDYSxnQkFBbUIsVUFBWWIsRUFBUyxFQUFJLEdBSzlDVixJQUlELE9BQU85RCxHQVdSMUMsS0FBSzZHLFVBQVksU0FBVW1CLEdBRTFCLElBQUlDLEVBQU92QixFQUFNd0IsRUFPakIsT0FIQXhCLEdBRkF1QixFQUFRRCxFQUFPRyxNQUFPLE1BRVQsR0FBR0EsTUFBTyxLQUN2QkQsRUFBT0QsRUFBTSxHQUFHRSxNQUFPLEtBRWhCLElBQUlsQyxLQUFNUyxFQUFLLEdBQUlBLEVBQUssR0FBSyxFQUFHQSxFQUFLLEdBQUl3QixFQUFLLEdBQUlBLEVBQUssR0FBSUEsRUFBSyxLQVl4RWxJLEtBQUs4RixnQkFBa0IsU0FBVS9CLEdBRTNCL0QsS0FBS2tDLHVCQUNUbEMsS0FBS2lDLGNBTVBqQyxLQUFLUSxPQUdFUixNQWppQlIsQ0F1aUJJb0kiLCJmaWxlIjoibGxtcy1hbmFseXRpY3MubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWZ0ZXJMTVMgQWRtaW4gUmVwb3J0aW5nIFdpZGdldHMgJiBDaGFydHNcbiAqIEBzaW5jZSAgICAzLjAuMFxuICogQHZlcnNpb24gIDMuMTcuNlxuICovXG47KCBmdW5jdGlvbiggJCwgdW5kZWZpbmVkICkge1xuXG5cdHdpbmRvdy5sbG1zID0gd2luZG93LmxsbXMgfHwge307XG5cblx0LyoqXG5cdCAqIExpZnRlckxNUyBBZG1pbiBBbmFseXRpY3Ncblx0ICogQHNpbmNlICAgIDMuMC4wXG5cdCAqIEB2ZXJzaW9uICAzLjUuMFxuXHQgKi9cblx0dmFyIEFuYWx5dGljcyA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0dGhpcy5jaGFydHNfbG9hZGVkID0gZmFsc2U7XG5cdFx0dGhpcy5kYXRhID0ge307XG5cdFx0dGhpcy5xdWVyeSA9ICQucGFyc2VKU09OKCAkKCAnI2xsbXMtYW5hbHl0aWNzLWpzb24nICkudGV4dCgpICk7XG5cdFx0dGhpcy50aW1lb3V0ID0gODAwMDtcblxuXHRcdHRoaXMuJHdpZGdldHMgPSAkKCAnLmxsbXMtd2lkZ2V0W2RhdGEtbWV0aG9kXScgKTtcblxuXHRcdC8qKlxuXHRcdCAqIEluaXRpYWxpemVyXG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmluaXQgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0Z29vZ2xlLmNoYXJ0cy5sb2FkKCAnY3VycmVudCcsIHtcblx0XHRcdFx0cGFja2FnZXM6IFtcblx0XHRcdFx0XHQnY29yZWNoYXJ0J1xuXHRcdFx0XHRdXG5cdFx0XHR9ICk7XG4gICAgICBcdFx0Z29vZ2xlLmNoYXJ0cy5zZXRPbkxvYWRDYWxsYmFjayggdGhpcy5jaGFydHNfcmVhZHkgKTtcblxuXHRcdFx0dGhpcy5iaW5kKCk7XG5cdFx0XHR0aGlzLmxvYWRfd2lkZ2V0cygpO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEJpbmQgRE9NIGV2ZW50c1xuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5iaW5kID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdCQoICcubGxtcy1kYXRlcGlja2VyJyApLmRhdGVwaWNrZXIoIHtcblx0XHRcdFx0ZGF0ZUZvcm1hdDogJ3l5LW1tLWRkJyxcblx0XHRcdFx0bWF4RGF0ZTogMCxcblx0XHRcdH0gKTtcblxuXG5cdFx0XHQkKCAnI2xsbXMtc3R1ZGVudHMtaWRzLWZpbHRlcicgKS5sbG1zU3R1ZGVudHNTZWxlY3QyKCB7XG5cdFx0XHRcdG11bHRpcGxlOiB0cnVlLFxuXHRcdFx0XHRwbGFjZWhvbGRlcjogTExNUy5sMTBuLnRyYW5zbGF0ZSggJ0ZpbHRlciBieSBTdHVkZW50KHMpJyApLFxuXHRcdFx0fSApO1xuXG5cdFx0XHQkKCAnYVtocmVmPVwiI2xsbXMtdG9nZ2xlLWZpbHRlcnNcIl0nICkub24oICdjbGljaycsIGZ1bmN0aW9uKCBlICkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdCQoICcubGxtcy1hbmFseXRpY3MtZmlsdGVycycgKS5zbGlkZVRvZ2dsZSggMTAwICk7XG5cdFx0XHR9ICk7XG5cblx0XHRcdCQoICcjbGxtcy1jdXN0b20tZGF0ZS1zdWJtaXQnICkub24oICdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkKCAnaW5wdXRbbmFtZT1cInJhbmdlXCJdJyApLnZhbCggJ2N1c3RvbScgKTtcblx0XHRcdH0gKTtcblxuXHRcdFx0JCggJyNsbG1zLWRhdGUtcXVpY2stZmlsdGVycyBhLmxsbXMtbmF2LWxpbmtbZGF0YS1yYW5nZV0nICkub24oICdjbGljaycsIGZ1bmN0aW9uKCBlICkge1xuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0JCggJ2lucHV0W25hbWU9XCJyYW5nZVwiXScgKS52YWwoICQoIHRoaXMgKS5hdHRyKCAnZGF0YS1yYW5nZScgKSApO1xuXG5cdFx0XHRcdCQoICdmb3JtLmxsbXMtcmVwb3J0aW5nLW5hdicgKS5zdWJtaXQoKTtcblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENhbGxlZCAgYnkgR29vZ2xlIENoYXJ0cyB3aGVuIHRoZSBsaWJyYXJ5IGlzIGxvYWRlZCBhbmQgcmVhZHlcblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuY2hhcnRzX3JlYWR5ID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHdpbmRvdy5sbG1zLmFuYWx5dGljcy5jaGFydHNfbG9hZGVkID0gdHJ1ZTtcblx0XHRcdHdpbmRvdy5sbG1zLmFuYWx5dGljcy5kcmF3X2NoYXJ0KCk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmVuZGVyIHRoZSBjaGFydFxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMTcuNlxuXHRcdCAqL1xuXHRcdHRoaXMuZHJhd19jaGFydCA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHRpZiAoICEgdGhpcy5jaGFydHNfbG9hZGVkIHx8ICEgdGhpcy5pc19sb2FkaW5nX2ZpbmlzaGVkKCkgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dmFyIGVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoICdsbG1zLWNoYXJ0cy13cmFwcGVyJyApO1xuXG5cdFx0XHRpZiAoICEgZWwgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRjaGFydCA9IG5ldyBnb29nbGUudmlzdWFsaXphdGlvbi5Db21ib0NoYXJ0KCBlbCApLFxuXHRcdFx0XHRkYXRhID0gc2VsZi5nZXRfY2hhcnRfZGF0YSgpLFxuXHRcdFx0XHRvcHRpb25zID0ge1xuXHRcdFx0XHRcdGNoYXJ0QXJlYToge1xuXHRcdFx0XHRcdFx0aGVpZ2h0OiAnNzUlJyxcblx0XHRcdFx0XHRcdHdpZHRoOiAnODUlJyxcblx0XHRcdFx0XHRcdC8vIGJvdHRvbTogMjAsXG5cdFx0XHRcdFx0XHQvLyBsZWZ0OiAyMCxcblx0XHRcdFx0XHRcdC8vIHJpZ2h0OiAyMCxcblx0XHRcdFx0XHRcdC8vIHRvcDogMjAsXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRjb2xvcnM6IFsnIzYwNkMzOCcsJyNFODVENzUnLCcjRUY4MzU0JywnI0M2NDE5MScsJyM3MzE5NjMnXSxcblx0XHRcdFx0XHRoZWlnaHQ6IDU2MCxcblx0XHRcdFx0XHRsaW5lV2lkdGg6IDQsXG5cdFx0XHRcdFx0c2VyaWVzVHlwZTogJ2JhcnMnLFxuXHRcdFx0XHRcdHNlcmllczogc2VsZi5nZXRfY2hhcnRfc2VyaWVzX29wdGlvbnMoKSxcblx0XHRcdFx0XHR2QXhlczoge1xuXHRcdFx0XHRcdFx0MDoge1xuXHRcdFx0XHRcdFx0XHRmb3JtYXQ6ICdjdXJyZW5jeScsXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0MToge1xuXHRcdFx0XHRcdFx0XHRmb3JtYXQ6ICcnLFxuXHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHR9O1xuXHRcdFx0XHQvLyBkYXRhID0gZ29vZ2xlLnZpc3VhbGl6YXRpb24uYXJyYXlUb0RhdGFUYWJsZSggW1xuXHRcdFx0XHQvLyBcdC8vIFsnTW9udGgnLCAnQm9saXZpYScsICdFY3VhZG9yJywgJ01hZGFnYXNjYXInLCAnUGFwdWEgTmV3IEd1aW5lYScsICdSd2FuZGEnLCAnQXZlcmFnZSddLFxuXHRcdFx0XHQvLyBcdC8vIFsnMjAwNC8wNScsICAxNjUsICAgICAgOTM4LCAgICAgICAgIDUyMiwgICAgICAgICAgICAgOTk4LCAgICAgICAgICAgNDUwLCAgICAgIDYxNC42XSxcblx0XHRcdFx0Ly8gXHQvLyBbJzIwMDUvMDYnLCAgMTM1LCAgICAgIDExMjAsICAgICAgICA1OTksICAgICAgICAgICAgIDEyNjgsICAgICAgICAgIDI4OCwgICAgICA2ODJdLFxuXHRcdFx0XHQvLyBcdC8vIFsnMjAwNi8wNycsICAxNTcsICAgICAgMTE2NywgICAgICAgIDU4NywgICAgICAgICAgICAgODA3LCAgICAgICAgICAgMzk3LCAgICAgIDYyM10sXG5cdFx0XHRcdC8vIFx0Ly8gWycyMDA3LzA4JywgIDEzOSwgICAgICAxMTEwLCAgICAgICAgNjE1LCAgICAgICAgICAgICA5NjgsICAgICAgICAgICAyMTUsICAgICAgNjA5LjRdLFxuXHRcdFx0XHQvLyBcdC8vIFsnMjAwOC8wOScsICAxMzYsICAgICAgNjkxLCAgICAgICAgIDYyOSwgICAgICAgICAgICAgMTAyNiwgICAgICAgICAgMzY2LCAgICAgIDU2OS42XVxuXHRcdFx0XHQvLyBdIClcblxuXHRcdFx0aWYgKCBkYXRhLmxlbmd0aCApIHtcblxuXHRcdFx0XHRkYXRhID0gZ29vZ2xlLnZpc3VhbGl6YXRpb24uYXJyYXlUb0RhdGFUYWJsZSggZGF0YSApO1xuXHRcdFx0XHRkYXRhLnNvcnQoW3tjb2x1bW46IDB9XSlcblx0XHRcdFx0Y2hhcnQuZHJhdyggZGF0YSwgb3B0aW9ucyApO1xuXG5cdFx0XHR9XG5cblxuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENoZWNrIGlmIGEgd2lkZ2V0IGlzIHN0aWxsIGxvYWRpbmdcblx0XHQgKiBAcmV0dXJuICAgYm9vbFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMuaXNfbG9hZGluZ19maW5pc2hlZCA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCAkKCAnLmxsbXMtd2lkZ2V0LmlzLWxvYWRpbmcnICkubGVuZ3RoICkge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogU3RhcnQgbG9hZGluZyBhbGwgd2lkZ2V0cyBvbiB0aGUgY3VycmVudCBzY3JlZW5cblx0XHQgKiBAcmV0dXJuICAgdm9pZFxuXHRcdCAqIEBzaW5jZSAgICAzLjAuMFxuXHRcdCAqIEB2ZXJzaW9uICAzLjAuMFxuXHRcdCAqL1xuXHRcdHRoaXMubG9hZF93aWRnZXRzID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0dGhpcy4kd2lkZ2V0cy5lYWNoKCBmdW5jdGlvbigpIHtcblxuXHRcdFx0XHRzZWxmLmxvYWRfd2lkZ2V0KCAkKCB0aGlzICkgKTtcblxuXHRcdFx0fSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIExvYWQgYSBzcGVjaWZpYyB3aWRnZXRcblx0XHQgKiBAcGFyYW0gICAgb2JqICAgJHdpZGdldCAgalF1ZXJ5IHNlbGVjdG9yIG9mIHRoZSB3aWRnZXQgZWxlbWVudFxuXHRcdCAqIEByZXR1cm4gICB2b2lkXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMTYuOFxuXHRcdCAqL1xuXHRcdHRoaXMubG9hZF93aWRnZXQgPSBmdW5jdGlvbiggJHdpZGdldCApIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRtZXRob2QgPSAkd2lkZ2V0LmF0dHIoICdkYXRhLW1ldGhvZCcgKSxcblx0XHRcdFx0JGNvbnRlbnQgPSAkd2lkZ2V0LmZpbmQoICdoMScgKSxcblx0XHRcdFx0JHJldHJ5ID0gJHdpZGdldC5maW5kKCAnLmxsbXMtcmVsb2FkLXdpZGdldCcgKSxcblx0XHRcdFx0Y29udGVudF90ZXh0ID0gTExNUy5sMTBuLnRyYW5zbGF0ZSggJ0Vycm9yJyApLFxuXHRcdFx0XHRzdGF0dXM7XG5cblx0XHRcdCR3aWRnZXQuYWRkQ2xhc3MoICdpcy1sb2FkaW5nJyApO1xuXG5cdFx0XHQkLmFqYXgoIHtcblxuXHRcdFx0XHRkYXRhOiB7XG5cdFx0XHRcdFx0YWN0aW9uOiAnbGxtc193aWRnZXRfJyArIG1ldGhvZCxcblx0XHRcdFx0XHRkYXRlczogc2VsZi5xdWVyeS5kYXRlcyxcblx0XHRcdFx0XHRjb3Vyc2VzOiBzZWxmLnF1ZXJ5LmN1cnJlbnRfY291cnNlcyxcblx0XHRcdFx0XHRtZW1iZXJzaGlwczogc2VsZi5xdWVyeS5jdXJyZW50X21lbWJlcnNoaXBzLFxuXHRcdFx0XHRcdHN0dWRlbnRzOiBzZWxmLnF1ZXJ5LmN1cnJlbnRfc3R1ZGVudHMsXG5cdFx0XHRcdH0sXG5cdFx0XHRcdG1ldGhvZDogJ1BPU1QnLFxuXHRcdFx0XHR0aW1lb3V0OiBzZWxmLnRpbWVvdXQsXG5cdFx0XHRcdHVybDogd2luZG93LmFqYXh1cmwsXG5cdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKCByICkge1xuXG5cdFx0XHRcdFx0c3RhdHVzID0gJ3N1Y2Nlc3MnO1xuXG5cdFx0XHRcdFx0aWYoICd1bmRlZmluZWQnICE9PSB0eXBlb2Ygci5yZXNwb25zZSApIHtcblxuXHRcdFx0XHRcdFx0Y29udGVudF90ZXh0ID0gci5yZXNwb25zZTtcblxuXHRcdFx0XHRcdFx0c2VsZi5kYXRhW21ldGhvZF0gPSB7XG5cdFx0XHRcdFx0XHRcdGNoYXJ0X2RhdGE6IHIuY2hhcnRfZGF0YSxcblx0XHRcdFx0XHRcdFx0cmVzcG9uc2U6IHIucmVzcG9uc2UsXG5cdFx0XHRcdFx0XHRcdHJlc3VsdHM6IHIucmVzdWx0cyxcblx0XHRcdFx0XHRcdH07XG5cblx0XHRcdFx0XHRcdCRyZXRyeS5yZW1vdmUoKTtcblxuXHRcdFx0XHRcdH1cblxuXG5cdFx0XHRcdH0sXG5cdFx0XHRcdGVycm9yOiBmdW5jdGlvbiggciApIHtcblxuXHRcdFx0XHRcdHN0YXR1cyA9ICdlcnJvcic7XG5cblx0XHRcdFx0fSxcblx0XHRcdFx0Y29tcGxldGU6IGZ1bmN0aW9uKCByICkge1xuXG5cdFx0XHRcdFx0aWYgKCAnZXJyb3InID09PSBzdGF0dXMgKSB7XG5cblx0XHRcdFx0XHRcdGlmKCAndGltZW91dCcgPT09IHIuc3RhdHVzVGV4dCApIHtcblxuXHRcdFx0XHRcdFx0XHRjb250ZW50X3RleHQgPSBMTE1TLmwxMG4udHJhbnNsYXRlKCAnUmVxdWVzdCB0aW1lZCBvdXQnICk7XG5cblx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cblx0XHRcdFx0XHRcdFx0Y29udGVudF90ZXh0ID0gTExNUy5sMTBuLnRyYW5zbGF0ZSggJ0Vycm9yJyApO1xuXG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdGlmICggISAkcmV0cnkubGVuZ3RoICkge1xuXG5cdFx0XHRcdFx0XHRcdCRyZXRyeSA9ICQoICc8YSBjbGFzcz1cImxsbXMtcmVsb2FkLXdpZGdldFwiIGhyZWY9XCIjXCI+JyArIExMTVMubDEwbi50cmFuc2xhdGUoICdSZXRyeScgKSArICc8L2E+JyApO1xuXHRcdFx0XHRcdFx0XHQkcmV0cnkub24oICdjbGljaycsIGZ1bmN0aW9uKCBlICkge1xuXG5cdFx0XHRcdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdFx0XHRcdHNlbGYubG9hZF93aWRnZXQoICR3aWRnZXQgKTtcblxuXHRcdFx0XHRcdFx0XHR9ICk7XG5cblx0XHRcdFx0XHRcdFx0JHdpZGdldC5hcHBlbmQoICRyZXRyeSApO1xuXG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQkd2lkZ2V0LnJlbW92ZUNsYXNzKCAnaXMtbG9hZGluZycgKTtcblx0XHRcdFx0XHQkY29udGVudC5odG1sKCBjb250ZW50X3RleHQgKTtcblxuXHRcdFx0XHRcdHNlbGYud2lkZ2V0X2ZpbmlzaGVkKCAkd2lkZ2V0ICk7XG5cblx0XHRcdFx0fVxuXG5cdFx0XHR9ICk7XG5cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogR2V0IHRoZSB0aW1lIGluIHNlY29uZHMgYmV0d2VlbiB0aGUgcXVlcmllZCBkYXRlc1xuXHRcdCAqIEByZXR1cm4gICBpbnRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmdldF9kYXRlX2RpZmYgPSBmdW5jdGlvbigpIHtcblxuXHRcdFx0dmFyIGVuZCA9IG5ldyBEYXRlKCB0aGlzLnF1ZXJ5LmRhdGVzLmVuZCApLFxuXHRcdFx0XHRzdGFydCA9IG5ldyBEYXRlKCB0aGlzLnF1ZXJ5LmRhdGVzLnN0YXJ0ICk7XG5cblx0XHRcdHJldHVybiBNYXRoLmFicyggZW5kLmdldFRpbWUoKSAtIHN0YXJ0LmdldFRpbWUoKSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEJ1aWxkcyBhbiBvYmplY3Qgb2YgZGF0YSB0aGF0IGNhbiBiZSB1c2VkIHRvLCB1bHRpbWF0ZWx5LCBkcmF3IHRoZSBzY3JlZW4ncyBjaGFydFxuXHRcdCAqIEByZXR1cm4gICBvYmpcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4xLjZcblx0XHQgKi9cblx0XHR0aGlzLmdldF9jaGFydF9kYXRhX29iamVjdCA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdG1heF9mb3JfZGF5cyA9ICggKCAxMDAwICogMzYwMCAqIDI0ICkgKiAzMCApICogNCwgLy8gNCBtb250aHMgaW4gc2Vjb25kc1xuXHRcdFx0XHRkaWZmID0gdGhpcy5nZXRfZGF0ZV9kaWZmKCksXG5cdFx0XHRcdGRhdGEgPSB7fSxcblx0XHRcdFx0cmVzLCBpLCBkLCBkYXRlO1xuXG5cdFx0XHRmb3IgKCB2YXIgbWV0aG9kIGluIHNlbGYuZGF0YSApIHtcblxuXHRcdFx0XHRpZiAoICEgc2VsZi5kYXRhLmhhc093blByb3BlcnR5KCBtZXRob2QgKSApIHtcblx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggJ29iamVjdCcgIT09IHR5cGVvZiBzZWxmLmRhdGFbIG1ldGhvZCBdLmNoYXJ0X2RhdGEgfHwgJ29iamVjdCcgIT09IHR5cGVvZiBzZWxmLmRhdGFbIG1ldGhvZCBdLnJlc3VsdHMgKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRyZXMgPSBzZWxmLmRhdGFbIG1ldGhvZCBdLnJlc3VsdHM7XG5cblx0XHRcdFx0aWYgKCByZXMgKSB7XG5cblx0XHRcdFx0XHRmb3IgKCBpID0gMDsgaSA8IHJlcy5sZW5ndGg7IGkrKyApIHtcblxuXHRcdFx0XHRcdFx0ZCA9IHRoaXMuaW5pdF9kYXRlKCByZXNbaV0uZGF0ZSApO1xuXG5cdFx0XHRcdFx0XHQvLyBncm91cCBieSBkYXlzXG5cdFx0XHRcdFx0XHRpZiAoIGRpZmYgPD0gbWF4X2Zvcl9kYXlzICkge1xuXHRcdFx0XHRcdFx0XHRkYXRlID0gbmV3IERhdGUoIGQuZ2V0RnVsbFllYXIoKSwgZC5nZXRNb250aCgpLCBkLmdldERhdGUoKSApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0Ly8gZ3JvdXAgYnkgbW9udGhzXG5cdFx0XHRcdFx0XHRlbHNlIHtcblx0XHRcdFx0XHRcdFx0ZGF0ZSA9IG5ldyBEYXRlKCBkLmdldEZ1bGxZZWFyKCksIGQuZ2V0TW9udGgoKSwgMSApO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRpZiAoICEgZGF0YVsgZGF0ZSBdICkge1xuXHRcdFx0XHRcdFx0XHRkYXRhWyBkYXRlIF0gPSB0aGlzLmdldF9lbXB0eV9kYXRhX29iamVjdCggZGF0ZSApXG5cdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdHN3aXRjaCAoIHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YS50eXBlICkge1xuXG5cdFx0XHRcdFx0XHRcdGNhc2UgJ2Ftb3VudCc6XG5cdFx0XHRcdFx0XHRcdFx0ZGF0YVsgZGF0ZSBdWyBtZXRob2QgXSA9IGRhdGFbIGRhdGUgXVsgbWV0aG9kIF0gKyAoIHJlc1tpXVsgc2VsZi5kYXRhWyBtZXRob2QgXS5jaGFydF9kYXRhLmtleSBdICogMSApO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0XHRjYXNlICdjb3VudCc6XG5cdFx0XHRcdFx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdFx0XHRcdFx0ZGF0YVsgZGF0ZSBdWyBtZXRob2QgXSsrO1xuXHRcdFx0XHRcdFx0XHRicmVhaztcblxuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdH1cblxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZGF0YTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBHZXQgdGhlIGRhdGEgZ29vZ2xlIGNoYXJ0cyBuZWVkcyB0byBpbml0aWF0ZSB0aGUgY3VycmVudCBjaGFydFxuXHRcdCAqIEByZXR1cm4gICBvYmpcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmdldF9jaGFydF9kYXRhID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0b2JqID0gc2VsZi5nZXRfY2hhcnRfZGF0YV9vYmplY3QoKSxcblx0XHRcdFx0ZGF0YSA9IHNlbGYuZ2V0X2NoYXJ0X2hlYWRlcnMoKTtcblxuXHRcdFx0Zm9yICggdmFyIGRhdGUgaW4gb2JqICkge1xuXG5cdFx0XHRcdGlmICggISBvYmouaGFzT3duUHJvcGVydHkoIGRhdGUgKSApIHtcblx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHZhciByb3cgPSBbIG9ialsgZGF0ZSBdLl9kYXRlIF07XG5cblx0XHRcdFx0Zm9yICggdmFyIGl0ZW0gaW4gb2JqWyBkYXRlIF0gKSB7XG5cdFx0XHRcdFx0aWYgKCAhIG9ialsgZGF0ZSBdLmhhc093blByb3BlcnR5KCBpdGVtICkgKSB7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBza2lwIG1ldGEgaXRlbXNcblx0XHRcdFx0XHRpZiAoIDAgPT09IGl0ZW0uaW5kZXhPZiggJ18nICkgKSB7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRyb3cucHVzaCggb2JqWyBkYXRlIF1bIGl0ZW0gXSApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZGF0YS5wdXNoKCByb3cgKTtcblxuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gZGF0YTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBHZXQgYSBzdHViIG9mIHRoZSBkYXRhIG9iamVjdCB1c2VkIGJ5IHRoaXMuZ2V0X2RhdGFfb2JqZWN0XG5cdFx0ICogQHBhcmFtICAgIHN0cmluZyAgIGRhdGUgIGRhdGUgdG8gaW50YXRuaWF0ZSB0aGUgb2JqZWN0IHdpdGhcblx0XHQgKiBAcmV0dXJuICAgb2JqXG5cdFx0ICogQHNpbmNlICAgIDMuMC4wXG5cdFx0ICogQHZlcnNpb24gIDMuMC4wXG5cdFx0ICovXG5cdFx0dGhpcy5nZXRfZW1wdHlfZGF0YV9vYmplY3QgPSBmdW5jdGlvbiggZGF0ZSApIHtcblxuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLFxuXHRcdFx0XHRvYmogPSB7XG5cdFx0XHRcdFx0X2RhdGU6IGRhdGUsXG5cdFx0XHRcdH07XG5cblx0XHRcdGZvciAoIHZhciBtZXRob2QgaW4gc2VsZi5kYXRhICkge1xuXHRcdFx0XHRpZiAoICEgc2VsZi5kYXRhLmhhc093blByb3BlcnR5KCBtZXRob2QgKSApIHtcblx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICggc2VsZi5kYXRhWyBtZXRob2QgXS5jaGFydF9kYXRhICkge1xuXHRcdFx0XHRcdG9ialsgbWV0aG9kIF0gPSAwO1xuXHRcdFx0XHR9XG5cblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuIG9iajtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBCdWlsZHMgYW4gYXJyYXkgb2YgY2hhcnQgaGVhZGVyIGRhdGFcblx0XHQgKiBAcmV0dXJuICAgYXJyYXlcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmdldF9jaGFydF9oZWFkZXJzID0gZnVuY3Rpb24oKSB7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcyxcblx0XHRcdFx0aCA9IFtdO1xuXG5cdFx0XHQvLyBkYXRlIGhlYWRlcnMgZ28gZmlyc3Rcblx0XHRcdGgucHVzaCgge1xuXHRcdFx0XHRsYWJlbDogTExNUy5sMTBuLnRyYW5zbGF0ZSggJ0RhdGUnICksXG5cdFx0XHRcdGlkOiAnZGF0ZScsXG5cdFx0XHRcdHR5cGU6ICdkYXRlJyxcblx0XHRcdH0gKTtcblxuXG5cdFx0XHRmb3IgKCB2YXIgbWV0aG9kIGluIHNlbGYuZGF0YSApIHtcblx0XHRcdFx0aWYgKCAhIHNlbGYuZGF0YS5oYXNPd25Qcm9wZXJ0eSggbWV0aG9kICkgKSB7XG5cdFx0XHRcdFx0Y29udGludWU7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoIHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YSApIHtcblx0XHRcdFx0XHRoLnB1c2goIHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YS5oZWFkZXIgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBbIGggXTtcblxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBHZXQgYSBvYmplY3Qgb2Ygc2VyaWVzIG9wdGlvbnMgbmVlZGVkIHRvIGRyYXcgdGhlIGNoYXJ0XG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLmdldF9jaGFydF9zZXJpZXNfb3B0aW9ucyA9IGZ1bmN0aW9uKCkge1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsXG5cdFx0XHRcdG9wdGlvbnMgPSB7fVxuXHRcdFx0XHRpID0gMDtcblxuXHRcdFx0Zm9yICggdmFyIG1ldGhvZCBpbiBzZWxmLmRhdGEgKSB7XG5cdFx0XHRcdGlmICggISBzZWxmLmRhdGEuaGFzT3duUHJvcGVydHkoIG1ldGhvZCApICkge1xuXHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKCBzZWxmLmRhdGFbIG1ldGhvZCBdLmNoYXJ0X2RhdGEgKSB7XG5cblx0XHRcdFx0XHR2YXIgdHlwZSA9IHNlbGYuZGF0YVsgbWV0aG9kIF0uY2hhcnRfZGF0YS50eXBlO1xuXG5cdFx0XHRcdFx0b3B0aW9uc1sgaSBdID0ge1xuXHRcdFx0XHRcdFx0dHlwZTogKCAnY291bnQnID09PSB0eXBlICkgPyAnYmFycycgOiAnbGluZScsXG5cdFx0XHRcdFx0XHR0YXJnZXRBeGlzSW5kZXg6ICggJ2NvdW50JyA9PT0gdHlwZSApID8gMSA6IDAsXG5cdFx0XHRcdFx0fTtcblxuXHRcdFx0XHR9XG5cblx0XHRcdFx0aSsrO1xuXG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBvcHRpb25zO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEluc3RhbnRpYXRlIGEgRGF0ZSBpbnN0YW5jZSB2aWEgYSBkYXRlIHN0cmluZ1xuXHRcdCAqIEBwYXJhbSAgICBzdHJpbmcgICBzdHJpbmcgIGRhdGUgc3RyaW5nLCBleHBlY3RlZCBmb3JtYXQgc2hvdWxkIGJlIGZyb20gcGhwIGRhdGUoICdZLW0tZCBIOmk6cycgKVxuXHRcdCAqIEByZXR1cm4gICBvYmpcblx0XHQgKiBAc2luY2UgICAgMy4xLjRcblx0XHQgKiBAdmVyc2lvbiAgMy4xLjVcblx0XHQgKi9cblx0XHR0aGlzLmluaXRfZGF0ZSA9IGZ1bmN0aW9uKCBzdHJpbmcgKSB7XG5cblx0XHRcdHZhciBwYXJ0cywgZGF0ZSwgdGltZTtcblxuXHRcdFx0cGFydHMgPSBzdHJpbmcuc3BsaXQoICcgJyApO1xuXG5cdFx0XHRkYXRlID0gcGFydHNbMF0uc3BsaXQoICctJyApO1xuXHRcdFx0dGltZSA9IHBhcnRzWzFdLnNwbGl0KCAnOicgKTtcblxuXHRcdFx0cmV0dXJuIG5ldyBEYXRlKCBkYXRlWzBdLCBkYXRlWzFdIC0gMSwgZGF0ZVsyXSwgdGltZVswXSwgdGltZVsxXSwgdGltZVsyXSApO1xuXG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENhbGxlZCB3aGVuIGEgd2lkZ2V0IGlzIGZpbmlzaGVkIGxvYWRpbmdcblx0XHQgKiBVcGRhdGVzIHRoZSBjdXJyZW50IGNoYXJ0IHdpdGggdGhlIG5ldyBkYXRhIGZyb20gdGhlIHdpZGdldFxuXHRcdCAqIEBwYXJhbSAgICBvYmogICAkd2lkZ2V0ICBqUXVlcnkgc2VsZWN0b3Igb2YgdGhlIHdpZGdldCBlbGVtZW50XG5cdFx0ICogQHJldHVybiAgIHZvaWRcblx0XHQgKiBAc2luY2UgICAgMy4wLjBcblx0XHQgKiBAdmVyc2lvbiAgMy4wLjBcblx0XHQgKi9cblx0XHR0aGlzLndpZGdldF9maW5pc2hlZCA9IGZ1bmN0aW9uKCAkd2lkZ2V0ICkge1xuXG5cdFx0XHRpZiAoIHRoaXMuaXNfbG9hZGluZ19maW5pc2hlZCgpICkge1xuXHRcdFx0XHR0aGlzLmRyYXdfY2hhcnQoKTtcblx0XHRcdH1cblxuXHRcdH07XG5cblx0XHQvLyBnb1xuXHRcdHRoaXMuaW5pdCgpO1xuXG5cdFx0Ly8gcmV0dXJuXG5cdFx0cmV0dXJuIHRoaXM7XG5cblx0fTtcblxuXHR3aW5kb3cubGxtcy5hbmFseXRpY3MgPSBuZXcgQW5hbHl0aWNzKCk7XG5cbn0gKSggalF1ZXJ5ICk7XG4iXX0=
