!function($){var e=fieldmaster.field_group.field_object.extend({type:"repeater",actions:{render_settings:"render"},events:{"change .fm-field-setting-layout input":"_change_layout","focus .fm-field-setting-collapsed select":"_focus_collapsed"},focus:function(){this.$fields=this.$field.find(".fm-field-list:first")},render:function(){this.render_layout(),this.render_collapsed()},render_layout:function(){var e=this.setting("layout input:checked").val();this.$fields.attr("data-layout",e)},render_collapsed:function(){var e=this.setting("collapsed select"),t=[];t.push({label:e.find('option[value=""]').text(),value:""}),this.$fields.children(".fm-field-object").each(function(){var e=$(this);t.push({label:e.find(".field-label:first").val(),value:e.attr("data-key")})}),fieldmaster.render_select(e,t)},_change_layout:function(e){this.render_layout()},_focus_collapsed:function(e){this.render_collapsed()}}),t=fieldmaster.field_group.field_object.extend({type:"flexible_content",actions:{render_settings:"render"},render:function(){var e=this,t=this.$field;this.$settings.hasClass("ui-sortable")||this.$settings.sortable({items:"> .fm-field-setting-fc_layout",handle:'[data-name="fieldmaster-fc-reorder"]',forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0,start:function(e,t){fieldmaster.do_action("sortstart",t.item,t.placeholder)},stop:function(e,a){fieldmaster.do_action("sortstop",a.item,a.placeholder),fieldmaster.field_group.save_field(t)}}),this.$settings.children(".fm-field-setting-fc_layout").each(function(){e.layout.render($(this))})},layout:null});t.layout=fieldmaster.model.extend({actions:{update_field_parent:"update_field_parent"},events:{"change .fieldmaster-fc-meta-display select":"_change_display","blur .fieldmaster-fc-meta-label input":"_blur_label",'click a[data-name="fieldmaster-fc-add"]':"_add",'click a[data-name="fieldmaster-fc-duplicate"]':"_duplicate",'click a[data-name="fieldmaster-fc-delete"]':"_delete"},event:function(e){return e.$el.closest(".fm-field-setting-fc_layout")},update_meta:function(e,t){fieldmaster.field_group.update_field_meta(e,"parent_layout",t.attr("data-id"))},delete_meta:function(e){fieldmaster.field_group.delete_field_meta(e,"parent_layout")},update_field_parent:function(e,t){var a=e.closest(".fm-field-setting-fc_layout");return a.exists()?(this.update_meta(e,a),void fieldmaster.field_group.save_field(e)):this.delete_meta(e)},render:function(e){var t=this,a=e.find(".fieldmaster-fc-meta-key:first input"),i=e.find(".fm-field-list:first"),l=e.find(".fieldmaster-fc-meta-display:first select").val();a.val(e.attr("data-id")),i.attr("data-layout",l),i.children(".fm-field-object").each(function(){t.update_meta($(this),e)})},_change_display:function(e){this.render(e)},_blur_label:function(e){var t=e.find(".fieldmaster-fc-meta-label:first input"),a=e.find(".fieldmaster-fc-meta-name:first input");if(""==a.val()){var i=t.val();i=fieldmaster.str_sanitize(i),a.val(i).trigger("change")}},_add:function(e){var t=fieldmaster.duplicate({$el:e,after:function(e,t){t.find(".fm-field-object").remove(),t.find(".no-fields-message").show(),t.find(".fieldmaster-fc-meta input").val("")}});this.render(t),fieldmaster.field_group.save_field(e.closest(".fm-field-object"))},_duplicate:function(e){$el2=fieldmaster.duplicate(e),fieldmaster.do_action("duplicate_field",$el2),this.render($el2),fieldmaster.field_group.save_field(e.closest(".fm-field-object"))},_delete:function(e){return 0==e.siblings(".fm-field-setting-fc_layout").length?(alert(fieldmaster._e("flexible_content","layout_warning")),!1):(e.find(".fm-field-object").each(function(){fieldmaster.field_group.delete_field($(this),!1)}),fieldmaster.remove_tr(e),void fieldmaster.field_group.save_field(e.closest(".fm-field-object")))}});var a=fieldmaster.field_group.field_object.extend({type:"clone",actions:{render_settings:"render"},events:{"change .fm-field-setting-display select":"render_display","change .fm-field-setting-prefix_label input":"render_prefix_label","change .fm-field-setting-prefix_name input":"render_prefix_name"},render:function(){this.render_display(),this.render_prefix_label(),this.render_prefix_name()},render_display:function(){var e=this.setting("display select").val();this.$field.attr("data-display",e)},render_prefix_label:function(){var e="%field_label%";this.setting('prefix_label input[type="checkbox"]').prop("checked")&&(e=this.setting('label input[type="text"]').val()+" "+e),this.setting("prefix_label code").html(e)},render_prefix_name:function(){var e="%field_name%";this.setting('prefix_name input[type="checkbox"]').prop("checked")&&(e=this.setting('name input[type="text"]').val()+"_"+e),this.setting("prefix_name code").html(e)},select2:null});a.select2=fieldmaster.model.extend({filters:{select2_args:"select2_args",select2_ajax_data:"select2_ajax_data"},select2_args:function(e,t,a){return"fieldmaster/fields/clone/query"!==a.ajax_action?e:(e.closeOnSelect=!1,e)},select2_ajax_data:function(e,t,a){if("fieldmaster/fields/clone/query"!==t.ajax_action)return e;var i={};return $(".fm-field-object").each(function(){var e=$(this),t=e.data("key"),a=e.data("type"),l=e.find(".field-label:first").val(),n=e.parents(".fm-field-object");i[t]={key:t,type:a,label:l,ancestors:n.length}}),e.fields=i,e.title=$("#title").val(),e}})}(jQuery);