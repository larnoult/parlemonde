jQuery(function(a){function b(){jQuery(".downloadable_files .downloadable_file").each(function(a,b){jQuery(".file_menu_order",b).val(parseInt(jQuery(b).index(".downloadable_files .downloadable_file")))})}jQuery(".expand_all").click(function(){return jQuery(this).closest(".dlm-metaboxes-wrapper").find(".dlm-metabox table").show(),!1}),jQuery(".close_all").click(function(){return jQuery(this).closest(".dlm-metaboxes-wrapper").find(".dlm-metabox table").hide(),!1}),jQuery(".dlm-metaboxes-wrapper").on("click",".dlm-metabox h3",function(a){jQuery(a.target).filter(":input, option").length||jQuery(this).next(".dlm-metabox-content").toggle()}),jQuery(".dlm-metabox.closed").each(function(){jQuery(this).find(".dlm-metabox-content").hide()}),jQuery(".date-picker-field").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0}),jQuery(".downloadable_files").sortable({items:".downloadable_file",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"dlm-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,c){c.item.removeAttr("style"),b()}}),jQuery(".download_monitor_files").on("click","a.add_file",function(){jQuery(".download_monitor_files").block({message:null,overlayCSS:{background:"#fff url("+a("#dlm-plugin-url").val()+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}});var c=jQuery(".downloadable_files .downloadable_file").size(),d={action:"download_monitor_add_file",post_id:a("#dlm-post-id").val(),size:c,security:a("#dlm-ajax-nonce-add-file").val()};return jQuery.post(ajaxurl,d,function(a){jQuery(".downloadable_files").prepend(a),b(),jQuery(".download_monitor_files").unblock(),jQuery(".date-picker-field").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0})}),!1}),jQuery(".download_monitor_files").on("click","button.remove_file",function(b){if(b.preventDefault(),confirm(dlm_ed_strings.confirm_delete)){var c=jQuery(this).closest(".downloadable_file"),d=c.attr("data-file");if(d>0){jQuery(c).block({message:null,overlayCSS:{background:"#fff url("+a("#dlm-plugin-url").val()+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}});var e={action:"download_monitor_remove_file",file_id:d,download_id:a("#dlm-post-id").val(),security:a("#dlm-ajax-nonce-remove-file").val()};jQuery.post(ajaxurl,e,function(a){jQuery(c).fadeOut("300").remove()})}else jQuery(c).fadeOut("300").remove()}return!1}),jQuery(".download_monitor_files").on("click","a.dlm_browse_for_file",function(b){return downloadable_files_field=jQuery(this).closest(".downloadable_file").find('textarea[name^="downloadable_file_urls"]'),window.send_to_editor=window.send_to_browse_file_url,tb_show(dlm_ed_strings.browse_file,"media-upload.php?post_id="+a("#dlm-post-id").val()+"&amp;type=downloadable_file_browser&amp;from=wpdlm01&amp;TB_iframe=true"),!1}),window.send_to_browse_file_url=function(a){a&&(old=jQuery.trim(jQuery(downloadable_files_field).val()),old&&(old+="\n"),jQuery(downloadable_files_field).val(old+a)),tb_remove(),window.send_to_editor=window.send_to_editor_default};var c;jQuery(document).on("click",".dlm_upload_file",function(b){var d=a(this),e=d.parent().parent().find(".downloadable_file_urls"),f=e.val();b.preventDefault(),c&&c.close();var g=[new wp.media.controller.Library({library:wp.media.query(),multiple:!0,title:d.data("choose"),priority:20,filterable:"uploaded"})];c=wp.media.frames.downloadable_file=wp.media({title:d.data("choose"),library:{type:""},button:{text:d.data("update")},multiple:!0,states:g}),c.on("select",function(){c.state().get("selection").map(function(a){a=a.toJSON(),a.url&&(f=f?f+"\n"+a.url:a.url)}),e.val(f)}),c.on("ready",function(){c.uploader.options.uploader.params={type:"dlm_download"}}),c.open()})});